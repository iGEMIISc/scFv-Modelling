function addSettingsPopover(){$("a[id^=options_]").css("visibility","visible").each(function(){$(this).popover({html:!0,placement:$(this).attr("pop-placement")?$(this).attr("pop-placement"):"auto",content:$("#alignmentOptions"),container:1==$(this).closest("#viewerWrapper").length?"#right-panel":"body"})}).on("show.bs.popover",function(e){let t=$(this).attr("id").substring(8);$("#currentAlignmentIndex").val(t),1==$("#exportOptions").length?($("#alignmentOptions").show(),""==t?$("#exportOptions").hide():$("#exportOptions").show()):$("a[id^=options_]").each(function(){$(this).data("bs.popover")&&$(this).data("bs.popover").$tip&&1==$(this).data("bs.popover").$tip.find("#exportOptions").length&&(""==t?$(this).data("bs.popover").$tip.find("#exportOptions").hide():$(this).data("bs.popover").$tip.find("#exportOptions").show())})})}function resetChainMappingColours(){for(var e in chainMapping.structures)for(var t in chainMapping.structures[e])for(var n in chainMapping.structures[e][t])delete chainMapping.structures[e][t][n].rgb}!function(N){var _={gapChar:"-"},e=!1,w=!1,k=null,d=!1,x=0,C=0,M=[[136,221,204],[213,178,64],[187,187,221],[255,136,119],[136,187,221],[255,187,102],[187,221,102],[255,204,238],[166,206,227],[187,136,187],[204,238,204],[166,206,227]],l={init:function(t){return e||(e=!0,N(document).keydown(function(e){if(w&&N(".fancybox-desktop:visible").length<1){var t=e;if(d)t.preventDefault();else{var n=N("span.cursor").closest(".alignTbl");if(32==t.keyCode)t.preventDefault(),g();else if(8==t.keyCode||46==t.keyCode)t.preventDefault(),f(8==t.keyCode);else{if(27==t.keyCode)return void(n.data("startEditRegion",null),n.data("endEditRegion",null),N(".shadowCursor").removeClass("shadowCursor"));if((t.ctrlKey||t.metaKey)&&90==t.keyCode)return void function(e){var t,n=N("body").data("editHistory");null==n||n.length<1||(n=n.pop(),i(e,n,!0,!0),0<(t=N(".alignTbl").not(e)).length&&(i(t,n,!0,!1),N(".cursor").removeClass("cursor"),e.find("tr[seqno="+k.seqno+"]").find("span").eq(k.seqidx).addClass("cursor")))}(n)}A(null,t)}}else 27==e.keyCode&&(N(".hoverResidue").removeClass("hoverResidue"),N(".selectResidue").removeClass("selectResidue"))})),this.each(function(){var e=N.extend({},{type:"target-template",chaingroups:[],keyseq_sequence:t.keyseq_sequence,keyseq_chain_name:t.keyseq_chain_name||["A"],keyseq_annotation:t.keyseq_annotation},t.templateData);t.nowrap&&(e.nowrap=!0),t.charts&&(e.qmLength=0,e.charts=t.charts,e.pageResidueCount=t.pageResidueCount),t.resetColourCycle&&(x=0),t.firstDraw=!0,N(this).data("templateData",e),q(N(this),null,t),l.toggleIdenticalSeqs.call(this,{chaingroups:e.chaingroups},!1),l.resizeToParent.call(N(this),{redrawAnnotation:!1}),F(N(this)),n(N(this))})},toggleIdenticalSeqs:function(h,c){return N(this).each(function(){for(var e=N(this),t=R(e),n=0;n<h.chaingroups.length;n++){var i=h.chaingroups[n].filter(function(){return!0});if(!(i.length<2)){for(var a=i[0],s=t.find('tr[chain="'+a+'"]').first().text(),r=s.substring(0,s.lastIndexOf(".")+1)+"("+i.join("")+")",s=s.substring(0,s.lastIndexOf("."))+"."+a.charAt(0),o="",l=1;l<i.length;l++)o+="[chain="+i[l]+"]",l<i.length-1&&(o+=",");e.find("tr"+o).toggle(),t.find("tr"+o).toggle(),"none"==t.find("tr[chain="+i[1]+"]").css("display")?t.find("tr[chain="+a+"]").find("td").html(r):t.find("tr[chain="+a+"]").find("td").html(s)}}void 0!==c&&!c||F(e)})},drawAlignment:function(e){return this.each(function(){q(N(this),e?e.seqs:null,e||null),n(N(this))})},getFormattedAlignment:function(e){return t(N(this).attr("id").substring(8),e.format)},exportAlignment:function(e){return this.each(function(){N("#formattedAlignment").show(),N("#alignmentFormatSelect").val(e.format),a(),N("<a href='#formattedAlignment' title='Copy & Paste Alignment'/>'").fancybox({helpers:{title:{type:"inside"}}}).trigger("click"),N("#formattedAlignmentTextarea").focus(),N("#formattedAlignmentTextarea").select()})},html2image:function(e){N.fancybox.close(),N(".popover").hide();var t=N("#currentAlignmentIndex").val();$alTbl=N("#alignTbl"+t),t=$alTbl,$alignNameTbl=R(t),n=t.closest(".alignTblContainer").outerWidth(),c=t.closest(".alignTblContainer").outerHeight(),o='<svg xmlns="http://www.w3.org/2000/svg"  width="'+(n+=10)+'" height="'+c+'"><rect x="0" y="0" fill="white" width="'+n+'" height="'+c+'"/>',i=$alignNameTbl.outerWidth()+10,l=$alignNameTbl.offset().left-10,h=t.find("td:visible:eq(0)"),n=h.outerWidth(),u=N("<div>").append(N("#"+t.attr("id")+"_features svg").first().clone()).html().replace(/name="[\d_]+" /g,"").replace(/r="4" /g,""),o=(o=o+'<defs><clipPath id="cp2"><rect x="0" y="0" width="'+n+'" height="'+c+'"/></clipPath></defs><g transform="translate('+i+',0)" clip-path="url(#cp2)">')+u.substring(u.indexOf("</defs>")+7,u.indexOf("</svg>"))+"</g>",(n=t.find("tr:visible")).each(function(e,n){N(this).find("span.ligandContact").each(function(e,t){a=n.offsetTop+t.offsetTop,s||(s=N(t).outerWidth(),r=N(t).outerHeight()),o+='<rect style="fill:#CC4444;fill-opacity:0.8;" width="'+s+'" height="'+r+'" x="'+(N(t).offset().left-l)+'" y="'+a+'" />'})}),o+='<text text-anchor="end" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'>",(n=$alignNameTbl.find("tr:visible")).each(function(e,t){var n=N(this).find("td").css("padding-top"),n=parseInt(n.substring(0,n.length-2));a=t.offsetTop+12+n,o+='<tspan x="'+(i-2)+'" y="'+a+'">'+t.textContent.replace("QMEAN","")+"</tspan>"}),o+="</text>",(n=t.find("tr:visible")).each(function(e,i){o+='<text text-anchor="middle" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'>",N(this).find("span").each(function(e,t){var n;s||(s=N(t).outerWidth(),r=N(t).outerHeight()),"relative"!=t.style.position&&(n="fill:"+(n=N(t).css("color"))+";","bold"==t.style.fontWeight&&(n+="font-weight:bold;"),0<n.length&&(n=' style="'+n+'" '),a=i.offsetTop+t.offsetTop+12,o+='<tspan x="'+(N(t).offset().left-l+s/2)+'" y="'+a+'"'+n+">"+t.textContent+"</tspan>")}),o+="</text>",(td=N(this).find("td")[1])&&(o+='<text text-anchor="start" font-size="'+h.css("font-size")+"\" font-family='"+h.css("font-family")+"'><tspan x=\""+(N(td).offset().left-l+10)+'" y="'+a+'">'+td.textContent+"</tspan></text>")}),n.each(function(e,i){N(this).find("span").not(".ligandContact").each(function(e,t){a=i.offsetTop+t.offsetTop;var n=N(t).css("backgroundColor");n&&"transparent"!=n&&"rgb(255, 255, 255)"!=n&&(o+='<rect x="'+(N(t).offset().left-l)+'" y="'+a+'" width="'+s+'" height="'+r+'" style="fill:'+n+';"/>')})});var a,s,r,n,o,i,l,h,c=new Blob([o+"</svg>"],{type:"image/svg+xml;charset=utf-8"}),u=(window.URL||window.webkitURL||window).createObjectURL(c),t=new Image,d=document.createElement("canvas"),p=d.getContext("2d");t.onload=function(){d.width=this.naturalWidth,d.height=this.naturalHeight,p.drawImage(this,0,0),d.toBlob(function(e){saveAs(e,"alignment.png")},"image/png")},t.src=u},colourAllAlignments:function(t){resetChainMappingColours(),t.features?N(".alignTbl").each(function(){let n=[];N(this).find("tr[struc_id]").each(function(e,t){t=t.getAttribute("struc_id");-1==n.indexOf(t)&&n.push(t)});var e={};for(struc_id in t.features)-1<n.indexOf(struc_id)&&(e[struc_id]=t.features[struc_id]);0==Object.keys(e).length?N(this).removeData("features"):N(this).data("features",e),G("features",N(this))}):(t.col?t.col!=chainMapping.defaultColourScheme&&t.col!=jQuery.cookie("colourScheme")&&jQuery.cookie("colourScheme",t.col,{expires:365,path:"/"}):(t.col=chainMapping.defaultColourScheme,t.col||(t.col=jQuery.cookie("colourScheme"))),N(".alignTbl").each(function(){N(this).removeData("features"),G(t.col,N(this))})),u()},changeExportFormat:function(e){return this.each(function(){a()})},secondaryStructure:function(e){e&&jQuery.cookie("secStruct",e.sstype,{expires:365,path:"/"});var l=null,e=(null==(l=e?e.sstype:N.cookie("secStruct"))&&(l="dssp"),this.each(function(){N(this).data("templateData")&&(F(N(this)),"secstruc"==N.cookie("colourScheme"))&&G("secstruc",N(this))})),t=null,n=null,i=null;if("undefined"!=typeof globalTemplateData?"undefined"!=typeof globalTemplateData&&(n=globalTemplateData):N(this).data("templateData")&&("model-template"==N(this).data("templateData").type?i=!0:(n=[],this.each(function(){N(this).data("templateData")&&(n=n.concat(N(this).data("templateData").templates))}))),0<N("#pv:visible",currentWin.document).length){if(i)this.each(function(){var e=N(this).data("templateData");if(e){var t=e.struc_id;if(pv_viewer.get(t)){var n=pv_viewer.get(t).structure(),i=(pv_viewer.rm(t),"none"==l);if(!i)for(var a=0;a<e.keyseq_chain_name.length;a++){var s=e.keyseq_chain_name[a],r=(r=e.templates[0].trg_offset)||1,o=e.keyseq_annotation[s][l+"_string"],s=n.select({chain:s});o?s.eachResidue(function(e){e.full().setSS(o[e.num()-r])}):i=!0}i&&n.select("protein").eachResidue(function(e){e.full().setSS("")}),pv_viewer.cartoon(t,n,{color:pv.color.uniform("white")})}}});else for(var a=0;a<n.length;a++)if(n[a].selected){var s=n[a].struc_id,t=pv_viewer.get(s).structure();if(pv_viewer.rm(s),"none"==l)t.select("protein").eachResidue(function(e){e.full().setSS("")});else if(n[a].targets)for(var r=0;r<n[a].targets.length;r++)for(var o=n[a].targets[r],h=0;h<o.chain.length;h++)c=(c=o.annotation[o.chain[h]][l+"_string"])||o.annotation[o.chain[h]][l],t.select({chain:o.chain[h]}).eachResidue(function(e){e.full().setSS(c[e.num()-1])});else{var c=(c=n[a].annotation[l+"_string"])||n[a].annotation[l];t.select({chain:n[a].chain}).eachResidue(function(e){e.full().setSS(c?c[e.num()-1]:"")})}pv_viewer.cartoon(s,t,{color:pv.color.uniform("white")})}}else if(0<N("#ngl:visible",currentWin.document).length)if(i)this.each(function(){var e=N(this).data("templateData");if(e)for(var t=e.struc_id,n="none"==l,i=0;i<e.keyseq_chain_name.length;i++){var a=e.keyseq_chain_name[i],s=(s=e.templates[0].trg_offset)||1,r=e.keyseq_annotation[a][l+"_string"];for(comp in r||(n=!0),ngl_stage.compList)if(ngl_stage.compList[comp].name==t){ngl_stage.compList[comp].structure.eachResidue(function(e){e.chainname==a&&(e.sstruc=n?"":r[e.resno-s].toLowerCase())});break}}});else for(a=0;a<n.length;a++)if(n[a].selected){if(ngl_stage.eachRepresentation(function(e){if(e.name&&!e.name.match(/(ligands|dna|over)/)){var t=e.name;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==t&&ngl_stage.compList[comp].removeRepresentation(e)}}),"none"==l)for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==n[a].struc_id&&ngl_stage.compList[comp].structure.eachResidue(function(e){e.sstruc=""});else if(n[a].targets){for(r=0;r<n[a].targets.length;r++)for(o=n[a].targets[r],h=0;h<o.chain.length;h++)for(comp in c=(c=o.annotation[o.chain[h]][l+"_string"])||o.annotation[o.chain[h]][l],ngl_stage.compList)if(ngl_stage.compList[comp].name==n[a].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(e){e.chainname==o.chain[h]&&(e.sstruc=c[e.resno-1].toLowerCase())});break}}else for(comp in c=n[a].annotation[l+"_string"]||n[a].annotation[l],ngl_stage.compList)if(ngl_stage.compList[comp].name==n[a].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(e){e.chainname==n[a].chain&&(e.sstruc=c?c[e.resno-1].toLowerCase():"")});break}for(comp in s=n[a].struc_id,ngl_stage.compList)ngl_stage.compList[comp].name==s&&ngl_stage.compList[comp].addRepresentation("cartoon",{name:s,sele:"not :_ and not nucleic and not :-",smoothSheet:!0,aspectRatio:6,roughness:1})}return changeRep(N.cookie("defaultRepr")),u(),e},targetMismatch:function(t){return t.match?jQuery.cookie("targetMismatch",t.match,{expires:365,path:"/"}):jQuery.removeCookie("targetMismatch",{path:"/"}),this.each(function(){var e;N(this).find("span.targetMismatch").removeClass("targetMismatch"),"fade"==t.match?(N("#enhanceMismatch_cb").prop("checked",!1),N(this).find("span[nm]").addClass("targetMismatch")):"enhance"==t.match&&(N("#fadeMismatch_cb").prop("checked",!1),(e=N(this).find("span")).not("[nm]").addClass("targetMismatch"),e.not("[s]").addClass("targetMismatch"))})},viewerInitialised:function(e){let t=null;t=chainMapping.defaultColourScheme||(N(this).data("features")?"features":N.cookie("colourScheme")),-1<["qmean_local","confClass","bfactor","bfactor_range","secstruc","lddt"].indexOf(t)?N(".alignTbl:first").alignment("colourAllAlignments",{col:t}):u(e),0<N("#pv:visible",currentWin.document).length&&pv_viewer.fitParent()},updateColoursSingleResidue:function(e){u({singleResidue:e})},resizeToParent:function(e,o){return o=!e||e.redrawAnnotation,this.each(function(){var n=N(this);if(n.is(":visible")&&n.data("templateData")){var i=N(this).find("tr:visible td").first(),a=i.find("span").first()[0];if(a){var s=n.width()-i.width(),r=n.parent().closest("table").parent();let e=r.width()-(n.offset().left-r.offset().left)-s;r.css("maxHeight")&&(e-=8),n.data("templateData").nowrap&&(e=1e7);s=i.text().length;let t=Math.floor(e/a.getBoundingClientRect().width);n.data("options").textOnly&&(t=Math.floor(e/(i.width()/i.text().length))),(t-=t%5)<1&&(t=5);r=0<n.find("tr:hidden").length,a=n.data("templateData").chaingroups;t!=s?(n.attr("cols_cookie")&&N.cookie(n.attr("cols_cookie"),t,{expires:365,path:"/"}),q(n,null,{cols:t}),o&&F(n),r&&l.toggleIdenticalSeqs.call(n,{chaingroups:a})):(o&&F(n),N("#"+(i=n).attr("id")+"_features").css("top",i.position().top))}}})},toggleEditMode:function(e){(w=e&&null!=e.edit?e.edit:!w)?(N("a[id^=gapEdit_]").css("opacity",1),N(".hoverResidue").removeClass("hoverResidue"),null==k&&(k={seqno:1,seqidx:0}),N(this).find("tr[seqno="+k.seqno+"]").find("span").eq(k.seqidx).addClass("cursor")):(N("a[id^=gapEdit_]").css("opacity",.6),N(".cursor").removeClass("cursor"))},removeGappedColumns:function(e){var t=N(this).data("templateData").templates,n=function(e,t){for(var n="",i="",a=0;a<e.length;a++)"-"==e.charAt(a)&&"-"==t.charAt(a)||(n+=e.charAt(a),i+=t.charAt(a));return[n,i]}(t[0].trg_seq,t[0].tpl_seq);t[0].trg_seq=n[0],t[0].tpl_seq=n[1],q(N(this))}};function R(e){return N("#alignNameTbl"+e.attr("id").substring(8))}function n(s){var r;N(document).mouseup(function(){var e,t,n;N.data(s,"downchain")&&(e=N("#offscreen_selection span"),window.getSelection&&0<e.length?((t=(n=s.find(".selectResidue")).first().closest("tr")).attr("struc_id")&&N("body").trigger("centerResRange",{src:"alignment",struc_id:t.attr("struc_id"),chain:t.attr("keyseqchain")?t.attr("keyseqchain"):t.attr("chain"),min:parseInt(n.first().attr("s")),max:parseInt(n.last().attr("s"))}),t=window.getSelection(),(n=document.createRange()).setStart(e.get(0),0),n.setEndAfter(e.get(-1),0),t.addRange(n)):document.selection&&document.selection.empty(),N.data(s,"downchain",null)),s.data("mouseDragEdit",null)}),N(document).mousemove(function(){N.data(s,"downchain")&&(window.getSelection?(windowSelection=window.getSelection()).removeAllRanges():document.selection&&document.selection.empty())}),s.off(),(null==s.data("options")||"textOnly"in s.data("options")&&!s.data("options").textOnly)&&(r=null),s.data("templateData")&&s.data("templateData").charts?s.on("mouseover mousedown mouseup mousemove dblclick","td",function(e){var t,n,i,a=N(this).find("span");0!=a.length&&(t=a[0].getBoundingClientRect().width,i=N(this),e.pageX||e.pageY?n=e.pageX-i.offset().left:(e.clientX||e.clientY)&&(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-i.offset().left),$span=N(a[Math.floor(n/t)]),r!=$span.text()?(r=$span.text(),o(s,$span,"mouseover",e)):(r=$span.text(),o(s,$span,e.type,e)))}):s.on("mouseover mousedown mouseup mousemove dblclick","span",function(e){o(s,N(this),e.type,e)})}function o(e,s,r,o){var l=s.text();if(w&&function(e,t){if(t.stopPropagation(),t.preventDefault(),!d){var n,i=e.closest(".alignTbl"),a=e.closest("tr"),s=e.closest("tr").attr("seqno"),r=a.attr("chain");if(r||(r=a.attr("keyseqtype"),keyseqchain=a.attr("keyseqchain")),"mouseover"!=t.type)if("dblclick"==t.type)!e.hasClass("shadowCursor")||i.data("mouseDragEdit")||("-"==e.text()?f:g)();else if("mousedown"==t.type){if(!e.hasClass("shadowCursor")){var o=N(".shadowCursor").first();if(t.shiftKey&&o){if(o.closest("tr").attr("seqno")!=s)return;N(".shadowCursor").removeClass("shadowCursor");var l,h=(l=i.find("tr[seqno="+s+"]").find("span")).index(o),r=l.index(e);h<r?(i.data("startEditRegion",o),i.data("endEditRegion",e)):(a=h,h=r,r=a,i.data("startEditRegion",e),i.data("endEditRegion",o)),l.slice(h,r).each(function(){N(this).addClass("shadowCursor")}),i.data("mouseDragEdit",!1)}else N(".shadowCursor").removeClass("shadowCursor"),e.addClass("shadowCursor"),i.data("mouseDragEdit",!0),i.data("startEditRegion",e),i.data("endEditRegion",e)}N(".cursor").removeClass("cursor"),e.addClass("cursor")}else"mousemove"==t.type?((a=window.getSelection?window.getSelection():document.selection)&&(a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty()),i.data("mouseDragEdit")&&0!=(n=i.data("startEditRegion")).length&&(r=0,r=t.pageX>n.offset().left?(t.pageX-n.offset().left)/n.outerWidth()|0:(t.pageX-n.offset().left-n.outerWidth())/n.outerWidth()|0,N(".shadowCursor").removeClass("shadowCursor"),0<r?n.nextAll(":lt("+r+")").addClass("shadowCursor"):r<0&&n.prevAll().slice(0,Math.abs(r)).each(function(){N(this).addClass("shadowCursor")}),n.addClass("shadowCursor"))):"mouseup"==t.type&&(n=i.data("startEditRegion"))&&(h=(l=i.find("tr[seqno="+s+"]").find("span")).index(o),k={seqno:s,seqidx:l.index(e)},i.data("startEditRegion",N("span.shadowCursor").first()),i.data("endEditRegion",N("span.shadowCursor").last()),i.data("mouseDragEdit",!1))}}(s,o),l!=_.gapChar){var i=s.attr("s");if(i){var h=s.closest("tr");let n=h.attr("chain");n=n||(h.attr("keyseqchain")?h.attr("keyseqchain"):null);var a,c=h.attr("struc_id"),h=h.attr("seqno"),u=e.data("templateData");if("mouseover"==r){if(null!=O[l.toUpperCase()]){let t=O[l.toUpperCase()].triplet+" "+i+(n?" "+n:"");if(chainMapping.structures[c])for(let e=0;e<chainMapping.annotations.length;e++)chainMapping.annotations[e].active&&null!=chainMapping.structures[c][n][i][chainMapping.annotations[e].key]&&(a=chainMapping.structures[c][n][i][chainMapping.annotations[e].key],t+="; "+chainMapping.annotations[e].label+": "+("number"==typeof a?a.toFixed("ramachandran"==chainMapping.annotations[e].key?4:2):a));s.attr("title",t),s[0]!==o.target&&o.target.setAttribute("title",t)}n&&N("body").trigger("highlightResidue",{src:"alignment",struc_id:c,chain:n,resno:parseInt(i)})}if(!w&&u)if("mousedown"==r)N.data(e,"downspan",s),N.data(e,"downchain",h+c),N(".hoverResidue").removeClass("hoverResidue"),N(".selectResidue").removeClass("selectResidue");else if(("mousemove"==r||"mouseup"==r)&&(N.data(e,"downchain")&&(window.getSelection?((windowSelection=window.getSelection()).removeAllRanges(),range=document.createRange()):document.selection&&document.selection.empty()),c)&&n&&N.data(e,"downchain")==h+c&&("mousemove"!=r||null==N.data(e,"lastMouseDrag")||N.data(e,"lastMouseDrag")!=h+c+s.index())){N.data(e,"lastMouseDrag",h+c+s.index());l=e.find(`tr[seqno=${h}][struc_id="${c}"]`);let t=N.data(e,"downspan"),n=s,i=l.index(t.closest("tr")),a=l.index(n.closest("tr"));"mouseup"==r&&t.index()==n.index()&&i==a?s.addClass("selectResidue"):((i>a||i==a&&t.index()>n.index())&&(o=i,n=t,t=s,i=a,a=o),t.index()==n.index()&&i==a||(N(".selectResidue").removeClass("selectResidue"),t.addClass("selectResidue"),n.addClass("selectResidue"),l.each(function(e){e<i||e>a||(e==i?t.nextUntil(n):e==a?n.prevUntil(n):N(this).find("span")).addClass("selectResidue")})));u=e.find(".selectResidue");0<u.length&&(N("#offscreen_selection").html(""),u.clone().appendTo(N("#offscreen_selection")),window.getSelection?(h=window.getSelection(),(r=document.createRange()).setStart(N("#offscreen_selection span").get(0),0),r.setEndAfter(N("#offscreen_selection span").get(-1),0),h.addRange(r)):document.selection&&document.selection.empty())}}}}function E(e,t){var n;if(!(null==t||t.length<1))return(n=null==(n=N("body").data("editHistory"))?[]:n).push(t),N("body").data("editHistory",n),0<(n=N(".alignTbl").not(e)).length&&(i(n,t,!1),N(".cursor").removeClass("cursor")),1}function i(e,r,o,l){e.each(function(){if(null!=N(this).data("templateData")){for(var e=N(this).data("templateData").templates,t=r,n=0;n<t.length;n++)for(var i=t[n],a=0;a<i.length;a++)for(var s=0;s<e.length;s++)if(e[s].id==i[a].template.id){o?(e[s].trg_seq=i[a].trg_seq,e[s].tpl_seq=i[a].tpl_seq):(e[s].trg_seq=i[a].template.trg_seq,e[s].tpl_seq=i[a].template.tpl_seq),l&&(k=i[a].currentCursor,n==t.length-1)&&L(e[s]);break}N(this).is(":visible")&&q(N(this),null,{firstDraw:!1})}})}function L(e){if(!(N("#seqid_"+e.id).length<1)){for(var t=0,n=0,i=0;i<e.trg_seq.length;i++)"-"==e.trg_seq.charAt(i)||"-"==e.tpl_seq.charAt(i)?t++:e.trg_seq.charAt(i)==e.tpl_seq.charAt(i)&&n++;N("#seqid_"+e.id).text((n/(e.trg_seq.length-t)*100).toFixed(2))}}function A(e,t){var n,i,a,s,r,o,l,h,c;null==e&&(38==t.keyCode?e="up":40==t.keyCode?e="down":37==t.keyCode?e="left":39==t.keyCode&&(e="right")),null!=e&&(t&&t.preventDefault(),i=(n=(t=N("span.cursor").first()).closest("tr")).attr("seqno"),o=a=t.index(),0<(s=n.prevAll("[seqno="+i+"]")).length&&(o+=(r=s.find("span")).length),l=i,o=o,"up"==e&&0<n.index()?(l=(c=n.prev()).attr("seqno"),h=c.find("span:eq("+a+")")):"down"==e&&0<n.next().length?(l=(c=n.next()).attr("seqno"),h=c.find("span:eq(rowidx)"),h=(h=n.next().find("span")).length>a?h.eq(a):h.last()):"left"==e?0==t.prev().length?0<s.length&&(h=r.last(),o--):(h=t.prev(),o--):"right"==e&&(0<t.next().length?(h=t.next(),o++):0<(c=n.nextAll("[seqno="+i+"]:eq(0)")).length&&(h=c.find("span").first(),o++)),null!=h)&&(t.removeClass("cursor"),h.addClass("cursor"),k={seqno:l,seqidx:o})}function g(){var e=[],t=N("span.cursor").first(),n=t.closest("tr"),i=n.attr("seqno"),a=n.closest(".alignTbl");if(!t.hasClass("shadowCursor")){if(0!=a.find("span.shadowCursor").length)return;t.addClass("shadowCursor")}if(null!=a.data("templateData")){for(var s,r=a.find("span.shadowCursor").last(),o=r.index(),l=r[0]==t[0],h=a.find("tr"),c=r.closest("tr"),u=N(),d=0,p=(h.filter("[seqno="+i+"]").each(function(){d++;var e=N(this).find("span");if(N(this)[0]==c[0])return u=u.add(e.slice(0,o+1)),!1;u=u.add(e)}),u.index(t)),g=u.text(),f=a.data("templateData").templates,m=null!=n.attr("keyseqchain"),v="",b=m?null:h.filter("[seqno=1]").slice(0,d),r=t.nextAll(".shadowCursor").addBack(),y=0;y<f.length;y++)if(!(null==f[y].selected||f[y].selected<1)){if(m)s=f[y].trg_seq,v=f[y].tpl_seq,b=h.filter("[seqno="+(f[y].selected+1)+"]").slice(0,d);else{if(f[y].selected!=i-1)continue;s=f[y].tpl_seq,v=f[y].trg_seq}strEdit2=b.find("span").slice(0,g.length).text();for(var _="",w=!1,x=!1,C=0;C<g.length;C++)if(C<p)_+=s.charAt(_.length);else if(w){if("-"==g.charAt(C)){_+=s.charAt(_.length-1),x=!0;break}_+=s.charAt(_.length-1)}else _+="-",w=!0;x?s=_+s.substring(_.length):w&&(s=_+s.substring(_.length-1),l||(v=v.substring(0,_.length-1)+"-"+v.substring(_.length-1))),s.length>v.length?v+=Array(s.length-v.length+1).join("-"):v.length>s.length&&(s+=Array(v.length-s.length+1).join("-"));var M={template:f[y],trg_seq:f[y].trg_seq,tpl_seq:f[y].tpl_seq,currentCursor:{seqno:k.seqno,seqidx:k.seqidx}};m?(f[y].trg_seq=s,f[y].tpl_seq=v):(f[y].trg_seq=v,f[y].tpl_seq=s),L(f[y]),e[e.length]=M}1==r.length&&N(".shadowCursor").removeClass("shadowCursor"),0<e.length?(A("right"),a.data("templateData"),l&&(a.data("startEditRegion",null),a.data("endEditRegion",null)),E(a,[e])&&q(a,null,{firstDraw:!1})):S(t,'<strong style="color:red">The pairwise alignment already contains a gap at this position</strong>')}}function S(e,t){d=!0,e.removeAttr("title").popover({html:!0,content:t,placement:"top"}).popover("show"),setTimeout(function(){e.popover("destroy"),d=!1},2e3)}function f(e){var t=[],n=N("span.cursor").first(),i=n.closest("tr"),a=i.attr("seqno"),s=i.closest(".alignTbl"),r=s.find("span.shadowCursor").length<2;if(e){if("-"!=n.prev().text())return;r&&n.removeClass("shadowCursor"),(n=n.prev()).addClass("shadowCursor")}else if("-"!=n.text())return;if(null!=s.data("templateData")){if(!n.hasClass("shadowCursor")){if(0!=s.find("span.shadowCursor").length)return;n.addClass("shadowCursor")}for(var o,l,h=s.find("span.shadowCursor").last(),c=h.index(),u=s.find("tr"),d=h.closest("tr"),p=N(),g=0,f=(u.filter("[seqno="+a+"]").each(function(){g++;var e=N(this).find("span");if(N(this)[0]==d[0])return p=p.add(e.slice(0,c+1)),!1;p=p.add(e)}),p.index(n)),m=p.text(),v=s.data("templateData").templates,b=null!=i.attr("keyseqchain"),y="",_=b?null:u.filter("[seqno=1]").slice(0,g),w=0;w<v.length;w++)if(!(null==v[w].selected||v[w].selected<1)){if(b)o=v[w].trg_seq,l=v[w].tpl_seq,_=u.filter("[seqno="+(v[w].selected+1)+"]").slice(0,g);else{if(v[w].selected!=a-1)continue;o=v[w].tpl_seq,l=v[w].trg_seq}for(var y=_.find("span").slice(0,m.length).text(),x="",C=!1,M=0;M<m.length;M++)if(M!=f)if(M<f)x+=o.charAt(x.length);else if("-"==m.charAt(M)){if("-"!=y.charAt(M)){if(C){gapmoved=!0;break}x+="-",0}}else C=!0,x+=o.charAt(x.length+1);(o=r?x+o.substring(x.length+1):x+"-"+o.substring(x.length+1)).length>l.length?l+=Array(o.length-l.length+1).join("-"):l.length>o.length&&(o+=Array(l.length-o.length+1).join("-"));var P={template:v[w],trg_seq:v[w].trg_seq,tpl_seq:v[w].tpl_seq,currentCursor:{seqno:k.seqno,seqidx:k.seqidx}};b?(v[w].trg_seq=o,v[w].tpl_seq=l):(v[w].trg_seq=l,v[w].tpl_seq=o),L(v[w]),t[t.length]=P}0<t.length?(e&&A("left"),r&&(s.data("startEditRegion",null),s.data("endEditRegion",null)),E(s,[t])&&q(s,null,{firstDraw:!1})):S(n,'<strong style="color:red">No valid gaps to be deleted in the selected range</strong>')}}function B(e,t){var n;if(!(n=e.templates?function(e,n){var i=0,a=[],s=[],r=[],t="";if(N.each(e.templates,function(e,t){!t||n&&!t.selected||t.trg_seq&&(s[s.length]=t,a[a.length]="",r[r.length]=(a.length,0),i=Math.max(t.trg_seq.length,i))}),s.sort(function(e,t){return e.selected<t.selected?-1:e.selected>t.selected?1:0}),0!=s.length){for(var o=null,l=(e.keyseq_sequence?o=e.keyseq_sequence:(o=s[0].trg_seq,e.templates[0].up_res_num||(o=o.replace(/-/g,""))),0);l<i;){for(var h=0,c=0,u=0;u<s.length;u++){for(c=0;s[u].trg_seq.charAt(r[u]+c)==_.gapChar;)c++;h=Math.max(c,h)}for(c=0;c<h;)t+=_.gapChar,c++;t+=o.charAt(l++);for(u=0;u<s.length;u++)if(s[u].tpl_seq){for(c=0;s[u].trg_seq.charAt(r[u])==_.gapChar;)a[u]+=s[u].tpl_seq.charAt(r[u]++),c++;for(;c<h;)a[u]+=_.gapChar,c++;a[u]+=s[u].tpl_seq.charAt(r[u]++)}}return a.target=t,L((a.templates=s)[0]),a}}(e,!0):n))if((n=[]).templates=["empty"],e.keyseq_sequence)n.target=e.keyseq_sequence;else{for(var i=0;i<e.templates.length;i++)if(e.templates[i].trg_seq){n.target=e.templates[i].trg_seq.replace(/-/g,"");break}var a=e.templates[i].trg_seq.length-n.target.length;1==e.templates.length&&0<a&&N("#alignmentWarning_"+t.attr("id").substring(8)).html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Note: </strong> '+a+" gaps were removed from your target sequence</div>")}return n}var I={};function q(e,r,o){$alignNameTbl=R(e),e.removeData("clustalColours");let l=e.data().templateData;if(l=l||N("#alignTbl").data().templateData){r=r||B(l,e);for(var t=0,n=0;n<r.length;n++){var h=r[n].match(/[a-zA-Z]/g);h&&(t+=h.length)}for(var c,u={cols:60,fastDraw:!1,textOnly:2e4<t,showResiduePosition:!0},u=(0==(o=e.data("options")?N.extend(e.data("options"),o):(!(o=o||{}).cols&&e.attr("cols_cookie")&&N.cookie(e.attr("cols_cookie"))&&(o.cols=N.cookie(e.attr("cols_cookie"))),N.extend(u,o))).cols&&(o.cols=50),o.cols=parseInt(o.cols),e.attr("id").substring(8)),d=o.fastDraw,p=(o.textOnly?(N("#alignTbl"+u+"_features").remove(),e.off()):d&&(N("#alignTbl"+u+"_features").html(""),(c=I["timer"+u])&&clearTimeout(c),o.fastDraw=!1,c=setTimeout(function(){q(e,r)},10),I["timer"+u]=c),e.data("options",o),document.getElementById(e.attr("id")));p.hasChildNodes();)p.removeChild(p.lastChild);for(p=document.getElementById($alignNameTbl.attr("id"));p&&p.hasChildNodes();)p.removeChild(p.lastChild);var g,f="SEQRES"==(g=(g=l.target_name||("model-template"==l.type?l.struc_id:l.type.split("-")[0])).charAt(0).toUpperCase()+g.substring(1)).toUpperCase(),m=(void 0!==l.templates&&l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[0].seq:r.target).length;let a="",s="";if(l.nowrap){a='<tr><td style="padding-top:0px;">',s='<tr><td style="padding-top:0px;border-right:none">&nbsp;</td></tr>';for(let e=r.templates[0].trg_offset;e<m+r.templates[0].trg_offset;e++)0<e&&(0<e&&e%10==0?a=(a+='<span style="position:relative;color:#A2A2A2;">&nbsp;<span style="position:absolute;left:0px;top:8px;font-size:.7em;">|</span>')+'<span style="position:absolute;left:0px;top:0px;font-size:.8em;">'+e+"</span></span>":a+="<span>&nbsp;</span>")}a+="</td></tr>";var v={},b={};for(let i=0;i<m;i+=o.cols){let n=1;for(var y=0;y<l.keyseq_chain_name.length;y++){var _=[];let e;e=void 0!==l.templates&&l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[y].seq:r.target;var w=l.keyseq_chain_name[y];s+='<tr seqno="'+n+'" '+$(l.keyseq_description)+"><td"+(0<i&&0==y||l.charts?' style="position:relative; padding-top:10px" ':"")+">"+g+(1<l.keyseq_chain_name.length?":"+w:"")+"</td></tr>";let t=r.templates[0].trg_offset||1;void 0!==l.templates&&l.templates[0].modelAtomSeqs&&(t=l.templates[0].modelAtomSeqs[y].trg_offset),a+=`<tr seqno="${n}" keyseqtype="${l.type}"`,!l.struc_id||o.textOnly&&o.fastDraw||(a+=` struc_id="${l.struc_id}" keyseqchain="${w}"`),a+="><td"+(0<i&&0==y||l.charts?' style="padding-top:10px" ':"")+">",o.fastDraw?a+=V(e.substring(i,i+o.cols)):o.textOnly?a+="<span>"+e.substring(i,i+o.cols)+"</span>":(a+=D(e.substring(i,i+o.cols),{alIndex:i,pos:T(e.substring(0,i)),offset:t,annotation:l.keyseq_annotation?l.keyseq_annotation[w]:null,seqres:f,up_res_num:l.templates&&l.templates[y]&&l.templates[y].up_res_num?l.templates[y].up_res_num:null,resmap:_,keyseq:!0}),v[w]||(v[w]=[]),v[w]=v[w].concat(_)),a+="</td></tr>",n+=1}for(let e=0;e<r.length;e++){var x,C="model-template"!=l.type&&r.templates[e].struc_id?[]:null,M=l.templates[0].modelAtomSeqs?l.templates[0].modelAtomSeqs[e].seq:r.target;r.templates[e].tpl_seq?(s+='<tr seqno="'+n+'"  chain="'+r.templates[e].chain+'"'+$(r.templates[e].description)+'><td nowrap align="left" >'+r.templates[e].qname+"</td></tr>",x=r.templates[e].offset?r.templates[e].offset+1:1,a+=`<tr seqno="${n}" `+(o.textOnly&&o.fastDraw||"model-template"==l.type||!r.templates[e].struc_id?"":' struc_id="'+r.templates[e].struc_id+'"')+' qname="'+r.templates[e].qname+'" chain="'+r.templates[e].chain+'"><td nowrap align="left">',o.fastDraw?a+=V(r[e].substring(i,i+o.cols)):o.textOnly?a+="<span>"+r[e].substring(i,i+o.cols)+"</span>":(a+=D(r[e].substring(i,i+o.cols),{alIndex:i,pos:T(r[e].substring(0,i)),offset:x,seqres:f,annotation:r.templates[e].annotation,targetSeq:M.substring(i,i+o.cols),pdb_res_num:l.templates[e].pdb_res_num?l.templates[e].pdb_res_num.slice(i,i+o.cols):null,resmap:C,keyseq:!1}),C&&(b[r.templates[e].struc_id]||(b[r.templates[e].struc_id]={}),b[r.templates[e].struc_id][r.templates[e].chain]||(b[r.templates[e].struc_id][r.templates[e].chain]=[]),b[r.templates[e].struc_id][r.templates[e].chain]=b[r.templates[e].struc_id][r.templates[e].chain].concat(C))),a+="</td></tr>",n+=1):n+=1}}if(-1==chainMapping.alignments.indexOf(e.attr("id"))){if(l.modelLabel)if("model-template"==l.type)for(kchn in v)chainMapping.chainMeta[l.struc_id]||(chainMapping.chainMeta[l.struc_id]={}),chainMapping.chainMeta[l.struc_id][kchn]||(chainMapping.chainMeta[l.struc_id][kchn]={display:l.modelLabel});else for(let e=0;e<l.templates.length;e++)chainMapping.chainMeta[l.templates[e].struc_id]||(chainMapping.chainMeta[l.templates[e].struc_id]={}),chainMapping.chainMeta[l.templates[e].struc_id][l.templates[e].chain]||(chainMapping.chainMeta[l.templates[e].struc_id][l.templates[e].chain]={display:l.modelLabel});for(var P in chainMapping.alignments.push(e.attr("id")),v)if("model-template"==l.type){l.md5&&(chainMapping.targets[l.md5]||(chainMapping.targets[l.md5]={}),chainMapping.targets[l.md5][l.struc_id]||(chainMapping.targets[l.md5][l.struc_id]=[])),chainMapping.structures[l.struc_id]||(chainMapping.structures[l.struc_id]={}),chainMapping.structures[l.struc_id][P]||(chainMapping.structures[l.struc_id][P]=[]);for(let n=0;n<v[P].length;n++)if(v[P][n]){let e=!1,t={};chainMapping.structures[l.struc_id][P][v[P][n][1]]&&(e=!0,t=chainMapping.structures[l.struc_id][P][v[P][n][1]]),t.trgno=v[P][n][1],t.trgname=v[P][n][0],t.chn=P,t.resno=v[P][n][1],t.resname=v[P][n][0],3==v[P][n].length&&("qmean"in v[P][n][2].anno&&(t.qm=v[P][n][2].anno.qmean),"qmeanbrane"in v[P][n][2].anno&&(t.qmb=v[P][n][2].anno.qmeanbrane),"consistency"in v[P][n][2].anno)&&(t.c=v[P][n][2].anno.consistency),e||(l.md5&&(chainMapping.targets[l.md5][l.struc_id][v[P][n][1]]||(chainMapping.targets[l.md5][l.struc_id][v[P][n][1]]=[]),chainMapping.targets[l.md5][l.struc_id][v[P][n][1]].push(t)),chainMapping.structures[l.struc_id][P][v[P][n][1]]=t)}}else for(let n=0;n<v[P].length;n++)for(var k in b)for(var E in chainMapping.targets[l.md5]||(chainMapping.targets[l.md5]={}),chainMapping.targets[l.md5][k]||(chainMapping.targets[l.md5][k]=[]),chainMapping.structures[k]||(chainMapping.structures[k]={}),b[k])if(chainMapping.structures[k][E]||(chainMapping.structures[k][E]=[]),b[k][E][n]){let e=!1,t={};chainMapping.structures[k][E][b[k][E][n][1]]&&(e=!0,t=chainMapping.structures[k][E][b[k][E][n][1]]),t.chn=E,t.resno=b[k][E][n][1],t.resname=b[k][E][n][0],v[P][n]&&(t.trgno=v[P][n][1],t.trgname=v[P][n][0]),3==b[k][E][n].length&&("qmean"in b[k][E][n][2].anno&&(t.qm=b[k][E][n][2].anno.qmean),"qmeanbrane"in b[k][E][n][2].anno&&(t.qmb=b[k][E][n][2].anno.qmean),"consistency"in b[k][E][n][2].anno)&&(t.c=b[k][E][n][2].anno.consistency),e||(v[P][n]&&(chainMapping.targets[l.md5][k][v[P][n][1]]||(chainMapping.targets[l.md5][k][v[P][n][1]]=[]),chainMapping.targets[l.md5][k][v[P][n][1]].push(t)),chainMapping.structures[k][E][b[k][E][n][1]]=t)}}u=N.cookie("secStruct");u&&"none"==u||e.addClass("ss"),$alignNameTbl.last().append(s),e.last().append(a);let i;!l.nowrap&&o.showResiduePosition&&e.find("tr:visible").each(function(e,t){i="";var n=N(this).find("span[s]").last().attr("s");n&&N(this).append('<td style="padding-left:8px; font-size:.8em; text-align:right; '+i+'">'+n+"</td>")}),d||(chainMapping.defaultColourScheme?(N("#"+chainMapping.defaultColourScheme+"Button").prop("checked",!0),G(chainMapping.defaultColourScheme,e)):G(N.cookie("colourScheme"),e),r=null,o.firstDraw)||F(e)}}function T(e){e=e.match(/[^-]/g);return e?e.length:0}function $(e){return e?' title="'+e+'" ':""}function V(e){for(var t="",n=0;n<e.length;n++)t+="<span>"+e.charAt(n)+"</span>";return t}function D(i,a){if(!i)return"";let s=a.pos;var r=a.alIndex,o=a.seqres,l=null!=a.targetSeq,h=[];let c=null;for(let n=0;n<i.length;n++){var u,d,p,g=i.charAt(n);let e=null,t=null;if(g==_.gapChar)h.push('<span nm="true">-</span>'),a.resmap&&a.resmap.push(null);else if(a.pdb_res_num?(t=a.pdb_res_num[n]-a.offset,u=a.pdb_res_num[n-1],p=a.pdb_res_num[n],d=a.pdb_res_num[n+1],e=a.pdb_res_num[n],u&&u!=p-1&&u!=p?(0<n&&"-"==i.charAt(n-1)&&(h[n-1]=h[n-1].substring(0,h[n-1].length-9)+' class="insert_r">-</span>'),h.push(`<span s="${e}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+' class="insert_l">'+g+"</span>")):d&&p!=d-1&&d!=p?(h.push(`<span s="${e}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+' class="insert_r">'+g+"</span>"),n<i.length-2&&"-"==i.charAt(n+1)&&(h.push('<span nm="true" class="insert_l">-</span>'),n++)):h.push(`<span s="${e}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+">"+g+"</span>")):a.up_res_num?(t=r+n,u=a.up_res_num[r+n-1],d=a.up_res_num[r+n],p=a.up_res_num[r+n+1],null==d&&(d=c+=1),null==p&&(u=d-1,p=d+1),e=d,h.push("<span "+(0<r+n&&u!=d-1?'class="insert_l"':"")+(r+n<r+i.length-1&&d!=p-1?'class="insert_r"':"")+` s="${d}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+">"+g+"</span>"),c=d):o?(t=r+n,e=r+n+a.offset,h.push(`<span s="${e}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+">"+g+"</span>")):(t=s,e=s+a.offset,h.push(`<span s="${e}" r="${g.toUpperCase()}"`+(l&&a.targetSeq.charAt(n)!=g?' nm="true"':"")+">"+g+"</span>"),s++),a.resmap){var f=[g.toUpperCase(),e];if(a.annotation)for(var m in f.push({anno:{}}),a.annotation)a.annotation[m]&&a.annotation[m][t]&&(f[f.length-1].anno[m]=a.annotation[m][t]),a.keyseq&&"qmean"==m&&null==a.annotation.qmean[t]&&(h[h.length-1]='<span nores="true" '+h[h.length-1].substring(6));a.resmap.push(f)}}return h.join("")}function P(e,t,n){e[n][t]?e[n][t]++:e[n][t]=1}let O={A:{name:"Alanine",triplet:"ALA",hydrophobic:.7,size:.11},C:{name:"Cysteine",triplet:"CYS",hydrophobic:.78,size:.35},D:{name:"Aspartate",triplet:"ASP",hydrophobic:.11,size:.45},E:{name:"Glutamate",triplet:"GLU",hydrophobic:.11,size:.56},F:{name:"Phenylalanine",triplet:"PHE",hydrophobic:.81,size:.7},G:{name:"Glycine",triplet:"GLY",hydrophobic:.46,size:0},H:{name:"Histidine",triplet:"HIS",hydrophobic:.14,size:.62},I:{name:"Isoleucine",triplet:"ILE",hydrophobic:1,size:.43},K:{name:"Lysine",triplet:"LYS",hydrophobic:.07,size:.55},L:{name:"Leucine",triplet:"LEU",hydrophobic:.92,size:.43},M:{name:"Methionine",triplet:"MET",hydrophobic:.71,size:.57},N:{name:"Asparagine",triplet:"ASN",hydrophobic:.11,size:.44},P:{name:"Proline",triplet:"PRO",hydrophobic:.32,size:.31},Q:{name:"Glutamine",triplet:"GLN",hydrophobic:.11,size:.55},R:{name:"Arginine",triplet:"ARG",hydrophobic:0,size:.77},S:{name:"Serine",triplet:"SER",hydrophobic:.41,size:.23},T:{name:"Threonine",triplet:"THR",hydrophobic:.42,size:.34},V:{name:"Valine",triplet:"VAL",hydrophobic:.97,size:.32},W:{name:"Tryptophan",triplet:"TRP",hydrophobic:.4,size:1},Y:{name:"Tyrosine",triplet:"TYR",hydrophobic:.36,size:.82},B:{name:"Aspartate or Asparagine",triplet:"ASX"},Z:{name:"Glutamate or Glutamine",triplet:"GLX"},J:{name:"Leucine or Isoleucine",triplet:"XLE"},X:{name:"Unknown",triplet:"UNC"},"?":{name:"Unknown",triplet:"UNC"},hydrophobic:"LIFWVM",polar:"RKDENQ",small:"TDN",large:"WYRFH",aliphatic:"ILV",charged:"HKRED",positive:"HKR",negative:"ED",tiny:"AGS",aromatic:"FYWH",proline:"P",serThr:"ST"};function G(h,c){var t=c.find("span");if(0!=t.length){if(N.each(t,function(e,t){t.style.backgroundColor&&(t.style.backgroundColor="")}),c.data("features")||c.removeData("features"),null==h&&(h="rainbow"),(-1<["clustal","hydrophobic","size","charged","cysteine"].indexOf(h)||O[h])&&c.data("templateData").is_nucleotide&&(h="base"),c.data("features"))for(let o in c.data("features")){let s=0,r=c.find("tr[struc_id]");r.filter(`[struc_id="${o}"]`).each(function(e,t){if(s>parseInt(t.getAttribute("seqno")))return!1;s=parseInt(t.getAttribute("seqno"));let i=t.getAttribute("chain");i=i||t.getAttribute("keyseqchain");t=r.filter("tr[seqno="+s+"]").find(" span[s]");for(let e=0;e<c.data("features")[o].length;e++){var n=c.data("features")[o][e],a=n.rgb.split(",").map(Number);if(n.frmChn!=n.toChn)console.error("THIS IS AN ERROR "+n);else if(-1!=n.frmChn.indexOf(i))for(let e=n.resStart;e<n.resEnd+1;e++)chainMapping.structures[o][i][e]&&(chainMapping.structures[o][i][e].rgb=a)}t.each(function(e,t){var n=parseInt(t.getAttribute("s"));chainMapping.structures[o][i][n]&&(t.style.backgroundColor="rgba("+chainMapping.structures[o][i][n].rgb+",.6)")})})}else if("chain"==h||"uniqueChain"==h||"template"==h){let o=null;if("undefined"!=typeof globalTemplateData){if(!(o=globalTemplateData).chainColoursAssigned){for(let e=0;e<globalTemplateData.length;e++){var n=globalTemplateData[e],i=(n.chainColours={chain:[],unique:[],template:M[e%M.length]},n.chain_name?"chain_name":"chain");for(let t=0;t<n[i].length;t++){n.chainColours.unique[1<n[i][t].length?n[i][t].join(""):n[i][t]]=M[C],C++,C%=12;for(let e=0;e<n[i][t].length;e++)n.chainColours.chain[n[i][t][e]]=M[x],x++,x%=M.length}}globalTemplateData.chainColoursAssigned=!0}}else o=c.data("templateData").templates,N(".alignTbl").each(function(){var n=N(this).data("templateData");if(n&&n.templates&&!n.chainColoursAssigned){for(let t=0;t<n.templates.length;t++)if(n.templates[t].chainColours={chain:[],unique:[]},"model-template"==n.type)for(let e=0;e<n.keyseq_chain_name.length;e++)n.templates[t].chainColours.chain[n.keyseq_chain_name[e]]=M[x],n.templates[t].chainColours.unique[n.keyseq_chain_name[e]]=M[C],x++,x%=M.length;else n.templates[t].chainColours.chain[n.templates[t].chain]=M[x],n.templates[t].chainColours.unique[n.templates[t].chain]=M[C],x++,x%=M.length;C++,C%=M.length,n.chainColoursAssigned=!0}});o?N.each(c.find("tr[struc_id]"),function(e,t){let i=t.getAttribute("struc_id");var a=t.getAttribute("keyseqchain");if(!(a=a||t.getAttribute("chain")))return!1;var s,r=N(this).find("span[s]");for(let e=0;e<o.length;e++)if(o[e].struc_id==i){s=o[e];let n;if("chain"==h)n=s.chainColours.chain[a];else if("template"==h)n=s.chainColours.template;else for(chns in s.chainColours.unique)if(-1<chns.indexOf(a)){n=s.chainColours.unique[chns];break}n&&r.each(function(e,t){t.style.backgroundColor="rgb("+n+",.6)",i&&(t=parseInt(t.getAttribute("s")),chainMapping.structures[i])&&chainMapping.structures[i][a]&&chainMapping.structures[i][a][t]&&(chainMapping.structures[i][a][t].rgb=n)})}}):c.find("span").each(function(e,t){t.style.backgroundColor="rgba("+M[N(".alignTbl").index(c)%M.length]+",.6)"})}else if("rainbow"==h){let r=!1,o=0,l=c.find("tr");l.each(function(e,t){var n=t.getAttribute("struc_id");let i=t.getAttribute("chain");i=i||t.getAttribute("keyseqchain"),0==e&&(r="model-template"==t.getAttribute("keyseqtype"));e=parseInt(t.getAttribute("seqno"));if(e<=o)return!1;if(o=e,!r||null!=t.getAttribute("keyseqtype")){$span=l.filter("[seqno="+o+"]").find("span[s]:not([nores])");for(let e=0;e<$span.length;e++){var a,s=$span[e].getAttribute("s");null!=s&&(a=e/$span.length*(1.5*Math.PI-Math.PI/2)+Math.PI/2,a=[Math.round(127.5*(Math.sin(a+Math.PI)+1)),Math.round(255*Math.sin(a-Math.PI/2)),Math.round(127.5*(Math.sin(a)+1))],$span[e].style.backgroundColor="rgba("+a+",.6)",n&&chainMapping.structures[n]&&chainMapping.structures[n][i]&&(s=parseInt(s),chainMapping.structures[n][i][s]))&&(chainMapping.structures[n][i][s].rgb=a)}}})}else if("qmean_local"==h){let l="qm";"undefined"!=typeof qmeanbraneActive&&qmeanbraneActive&&(l="qmb"),c.find("tr[struc_id]").each(function(){let s=N(this).attr("struc_id"),r=N(this).attr("chain");r=r||N(this).attr("keyseqchain");var e=N(this).find("span[s]");let o=!0,t=!1;for(chn in chainMapping.structures[s]){for(res in chainMapping.structures[s][chn])if(chainMapping.structures[s][chn][res])if(chainMapping.structures[s][chn][res][l]){if(valExists=!0,1<chainMapping.structures[s][chn][res][l]){o=!1;break}}else chainMapping.structures[s][chn][res].bfactor&&(t=!0);if(!o)break}if(t)return z(c,"bfactor_range",N(this)),!0;N.each(e,function(e,t){var n=parseInt(t.getAttribute("s"));if(!chainMapping.structures[s][r][n])return!0;let i=chainMapping.structures[s][r][n][l];if(null==i)return!0;o||(i/=100);var a=qmeanLocalColour(i,.6),t=(t.style.backgroundColor=a).substring(5).split(",").slice(0,3).map(Number);chainMapping.structures[s][r][n].rgb=t})})}else if("confClass"==h)c.find("tr[struc_id]").each(function(){let a=N(this).attr("struc_id"),s=N(this).attr("chain");s=s||N(this).attr("keyseqchain");var e=N(this).find("span[s]");let r=!0;let t=!1;for(chn in chainMapping.structures[a]){for(res in chainMapping.structures[a][chn])if(chainMapping.structures[a][chn][res])if(chainMapping.structures[a][chn][res].qm){if(1<chainMapping.structures[a][chn][res].qm){r=!1;break}}else chainMapping.structures[a][chn][res].bfactor&&(t=!0);if(!r)break}if(t)return z(c,"bfactor_range",N(this)),!0;N.each(e,function(e,t){var n=parseInt(t.getAttribute("s"));if(!chainMapping.structures[a][s][n])return!0;let i=chainMapping.structures[a][s][n].qm;if(!i)return!0;r&&(i*=100),rgb=90<i?[0,83,214]:70<i?[101,203,243]:50<i?[255,219,19]:[255,125,69],t.style.backgroundColor="rgba("+rgb+",.6)",chainMapping.structures[a][s][n].rgb=rgb})});else if(-1<h.indexOf("consistency")){let o=0,l=1;"consistency"!=h&&(o=999,l=-99,c.find("tr[struc_id]").each(function(){var t=N(this).attr("struc_id");let n=N(this).attr("chain");if(!(n=n||N(this).attr("keyseqchain")))return!0;for(let e=0;e<chainMapping.structures[t][n].length;e++)chainMapping.structures[t][n][e]&&chainMapping.structures[t][n][e].c&&(o=Math.min(o,chainMapping.structures[t][n][e].c),l=Math.max(l,chainMapping.structures[t][n][e].c))})),c.find("tr[struc_id]").each(function(){var t=N(this).attr("struc_id");let n=N(this).attr("chain");if(!(n=n||N(this).attr("keyseqchain")))return!0;var i=N(this).find("span[s]").toArray();for(let e=0;e<i.length;e++){var a=[127,195,45],s=parseInt(i[e].getAttribute("s")),r=chainMapping.structures[t][n][s].c;r&&(l!=o&&((r=(parseFloat(r)-o)/(l-o))<.5?(a[0]=Math.round(255*(1-r)),a[1]=Math.round(160*r),a[2]=Math.round(90*r)):(a[0]=Math.round(127),a[1]=Math.round(20+175*r),a[2]=45)),i[e].style.backgroundColor="rgba("+a+",0.6)",t)&&(chainMapping.structures[t][n][s].rgb=a)}})}else if("clustal"==h){let s={red:[238,51,17],blue:[17,119,238],green:[17,204,17],orange:[255,102,0],cyan:[17,187,187],pink:[238,119,119],magenta:[204,68,204],yellow:[204,204,0]},r=c.data("clustalColours");r||(y=B(c.data("templateData"),c),r=function(n){let i,a,s=[];for(let t=0;t<n[0].length;t++){s[t]={};for(let e=i=0;e<n.length;e++)if((a=n[e].charAt(t).toUpperCase())==_.gapChar)i++;else{P(s,a,t);for(var r of["QE","ED","WLVIMAFCYHP","KR","TS"])-1<r.indexOf(a)&&P(s,r,t)}s[t].gapCount=i;var e,o,l={};for(e in s[t])l[e+"_nogap"]=(s[t][e]/n.length).toFixed(2),s[t][e]=(s[t][e]/(n.length-i)).toFixed(2);for(o in l)s[t][o]=l[o]}return s}(y.concat(y.target)),c.data("clustalColours",r));let o,t=0;c.find("tr").each(function(){if(parseInt(N(this).attr("seqno"))<t)return!1;let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain"),t=parseInt(N(this).attr("seqno"));var e=c.find("tr[seqno="+t+"] span");N.each(e,function(t,n){if(null!=r[t]){let e=null;if(n.hasAttribute("r")){switch(o=n.getAttribute("r")){case"A":case"I":case"L":case"M":case"F":case"W":case"V":.6<r[t].WLVIMAFCYHP_nogap&&(e=s.blue);break;case"C":.6<r[t].WLVIMAFCYHP_nogap&&(e=s.blue),.85<r[t].C_nogap&&(e=s.pink);break;case"K":case"R":(.6<r[t].KR_nogap||.8<r[t].K_nogap||.8<r[t].R_nogap||.8<r[t].Q_nogap)&&(e=s.red);break;case"E":(.6<r[t].KR_nogap||.5<r[t].ED_nogap||.5<r[t].QE_nogap||.85<r[t].E_nogap||.85<r[t].Q_nogap||.85<r[t].D_nogap)&&(e=s.magenta);break;case"D":(.6<r[t].KR_nogap||.5<r[t].ED_nogap||.85<r[t].D_nogap||.85<r[t].E_nogap||.85<r[t].N_nogap)&&(e=s.magenta);break;case"N":(.5<r[t].N_nogap||.85<r[t].Y_nogap)&&(e=s.green);break;case"Q":(.6<r[t].KR_nogap||.5<r[t].QE_nogap||.85<r[t].Q_nogap||.85<r[t].E_nogap||.85<r[t].K_nogap||.85<r[t].R_nogap)&&(e=s.green);break;case"S":case"T":(.6<r[t].WLVIMAFCYHP_nogap||.5<r[t].TS_nogap||.85<r[t].S_nogap||.85<r[t].T_nogap)&&(e=s.green);break;case"G":e=s.orange;break;case"P":e=s.yellow;break;case"H":case"Y":(.6<r[t].WLVIMAFCYHP_nogap||.85<r[t].W_nogap||.85<r[t].Y_nogap||.85<r[t].A_nogap||.85<r[t].C_nogap||.85<r[t].P_nogap||.85<r[t].Q_nogap||.85<r[t].F_nogap||.85<r[t].H_nogap||.85<r[t].I_nogap||.85<r[t].L_nogap||.85<r[t].M_nogap||.85<r[t].V_nogap)&&(e=s.cyan)}e&&(n.style.backgroundColor="rgb("+e+",.5)",i)&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(n=parseInt(n.getAttribute("s")),chainMapping.structures[i][a][n])&&(chainMapping.structures[i][a][n].rgb=e)}}})})}else if("secstruc"==h){let t=N.cookie("secStruct");null==t&&(t="dssp");var o=c.data("templateData"),l=c.find("tr");let s,r;if(o.keyseq_annotation)for(let e=0;e<o.keyseq_chain_name.length;e++){r=o.struc_id;var a=o.keyseq_chain_name[e];if(o.keyseq_annotation[a]&&o.keyseq_annotation[a][t]){var u=W(o.keyseq_annotation[a],t).replace(/[GI]/g,"H").replace(/B/g,"E");for(let e=0;e<u.length;e++)chainMapping.structures[r][a][e+1]&&(chainMapping.structures[r][a][e+1].ss=u[e])}else if(chainMapping.structures[r])for(let e=0;e<chainMapping.structures[r][a].length;e++)chainMapping.structures[r][a][e]&&(chainMapping.structures[r][a][e].ss=null)}else if(o.templates)for(let e=0;e<o.templates.length;e++){var d=o.templates[e];if(d.annotation&&d.annotation[t]){var p=W(d.annotation,t).replace(/[GI]/g,"H").replace(/B/g,"E");if(chainMapping.structures[d.struc_id])for(let e=0;e<p.length;e++)chainMapping.structures[d.struc_id][d.chain]&&chainMapping.structures[d.struc_id][d.chain][e+1]&&(chainMapping.structures[d.struc_id][d.chain][e+1].ss=p[e]);else console.warn("no chain mapping found for "+d.struc_id+" "+d.chain)}else if(d.struc_id&&"none"!=t){let t=!1;for(let e=0;!t&&e<chainMapping.structures[d.struc_id][d.chain].length;e++)chainMapping.structures[d.struc_id][d.chain][e]&&chainMapping.structures[d.struc_id][d.chain][e].ss&&(t=!0);t||fetchSecStruc(d.struc_id)}}let n=0;for(let e=0;e<l.length;e++){var g=l.eq(e);if(parseInt(g.attr("seqno"))<n)break;n=parseInt(g.attr("seqno"));let i=g.attr("chain"),a=(i=i||g.attr("keyseqchain"),r=g.attr("struc_id"),null);if(!r){if("model-template"==o.type)for(let e=0;e<o.templates.length;e++)if(o.templates[e].chain==i){o.templates[e].annotation&&o.templates[e].annotation[t]&&(a=(a=W(o.templates[e].annotation,t)).replace(/[GI]/g,"H").replace(/B/g,"E"));break}if(!a)continue}g=($row=l.filter('[seqno="'+n+'"]')).find("span[s]").toArray();N.each(g,function(e,t){let n=null;s=parseInt(t.getAttribute("s")),a?"E"==a[s-1]?n=[51,204,51]:"H"==a[s-1]&&(n=[153,153,230]):chainMapping.structures[r][i][s]&&("E"==chainMapping.structures[r][i][s].ss?n=[51,204,51]:"H"==chainMapping.structures[r][i][s].ss&&(n=[153,153,230]),chainMapping.structures[r][i][s].rgb=n),t.style.backgroundColor="rgba("+n+",.6)"})}}else if(-1<["hydrophobic","size","charged","cysteine"].indexOf(h)||O[h])c.find("tr").each(function(){let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain");var e=N(this).find("span");N.each(e,function(e,t){if((res=t.getAttribute("r"))&&O[res]){var n=function(e,t){{var n;return"hydrophobic"!=e?"size"!=e?"charged"==e?-1<O.positive.indexOf(t)?[100,100,255]:-1<O.negative.indexOf(t)?[255,100,100]:void 0:"cysteine"==e?"C"==t?[202,168,14]:null:-1<O[e].indexOf(t)?[20,80,250]:null:null!=(n=O[t][e])?[Math.round(255*n),255-Math.round(255*n),0]:void 0:null!=(n=O[t][e])?[Math.round(255*n),0,255-Math.round(255*n)]:void 0}}(h,res);if(!n)return!0;t.style.backgroundColor="rgba("+n+",.6)",i&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(t=parseInt(t.getAttribute("s")),chainMapping.structures[i][a][t])&&(chainMapping.structures[i][a][t].rgb=n)}})});else if("base"==h)c.find("tr").each(function(){let i=N(this).attr("struc_id"),a=N(this).attr("chain");a=a||N(this).attr("keyseqchain");var e=N(this).find("span");N.each(e,function(e,t){var n;return!(res=t.getAttribute("r"))||!(n={A:[70,195,70],C:[195,195,70],G:[195,70,70],T:[70,70,195],U:[70,70,195]}[res])||(t.style.backgroundColor="rgba("+n+",.6)",void(i&&chainMapping.structures[i]&&chainMapping.structures[i][a]&&(t=parseInt(t.getAttribute("s")),chainMapping.structures[i][a][t])&&(chainMapping.structures[i][a][t].rgb=n)))})});else if("soa"==h)z(c,"soa");else if("lddt"==h)z(c,h);else if(-1<h.indexOf("bfactor"))z(c,h);else if("entropy"==h)z(c,"entropy");else if("indels"==h&&"model-template"==c.data("templateData").type&&c.data("templateData").templates[0].tpl_seq){var f=c.data("templateData");let a=f.struc_id,n=99999999,i=0;var m=[],v=[];for(let t=0;t<f.templates.length;t++)if(f.templates[t].struc_id==a){trgOffset=f.templates[t].trg_offset?f.templates[t].trg_offset-1:0,i=f.templates[t].residue_from?(n=Math.min(n,f.templates[t].residue_from),Math.max(i,f.templates[t].residue_to)):(n=0,99999999999);for(let e=0;e<f.templates[t].trg_seq.length;e++)"-"!=f.templates[t].trg_seq.charAt(e)&&(v[e]="X"),"-"!=f.templates[t].tpl_seq.charAt(e)&&(m[e]="X")}let t=null,s=1+trgOffset,r=[],o=[];for(let e=0;e<f.templates[0].trg_seq.length;e++){if(!m[e])for(let e=0;-1==r.indexOf(s)&&e<f.keyseq_chain_name.length;e++)s>=n&&s<=i&&r.push(s);if(v[e])t=s,s++;else if(null!=t)for(let e=0;-1==o.indexOf(s)&&e<f.keyseq_chain_name.length;e++){f.keyseq_chain_name[e];s>=n&&s<=i&&o.push(s),s-1>=n&&s<=i&&o.push(s-1)}}for(let e=0;e<f.keyseq_chain_name.length;e++){let i=f.keyseq_chain_name[e];var b=c.find("tr[keyseqchain="+i+"]");N.each(b.find("span[s]:not([nores])"),function(e,t){var n=parseInt(t.getAttribute("s"));if(-1<r.indexOf(n))rgb=[80,214,80];else{if(!(-1<o.indexOf(n)))return!0;rgb=[100,100,255]}t.style.backgroundColor="rgba("+rgb+",.6)",chainMapping.structures[a][i][n].rgb=rgb})}}if(!N.cookie("targetMismatch")||"fade"==N.cookie("targetMismatch")?t.filter("[nm]").addClass("targetMismatch"):"enhance"==N.cookie("targetMismatch")&&(t.not("[nm]").addClass("targetMismatch"),t.not("[s]").addClass("targetMismatch")),w&&(k&&c.find(`tr[seqno=${k.seqno}]`).find("span").eq(k.seqidx).addClass("cursor"),c.data("startEditRegion"))&&c.data("endEditRegion")){var y=c.data("startEditRegion"),t=c.data("endEditRegion"),s=y.closest("tr"),r=s.attr("seqno"),s=s.siblings("[seqno="+r+"]").addBack().find("span");let e=c.find("tr[seqno="+r+"]").find("span");e=e.slice(s.index(y),s.index(t)+1).addClass("shadowCursor"),c.data("startEditRegion",e.first()),c.data("endEditRegion",e.last())}}}function z(n,c,e){if(!n.data("options").textOnly){let o=!1,l=null,t=null,h="bfactor_range"==c;h&&(c="bfactor"),(e||n.find("tr[struc_id]")).each(function(){l=N(this).attr("struc_id"),t=N(this).attr("qname");let r=N(this).attr("chain");if(!(r=r||N(this).attr("keyseqchain")))return!0;var e=N(this).find("span[s]");N.each(e,function(e,t){var n,i=parseInt(t.getAttribute("s"));if(!(chainMapping.structures[l]&&chainMapping.structures[l][r]&&chainMapping.structures[l][r][i]&&c in chainMapping.structures[l][r][i]))return!0;o=!0;let a=chainMapping.structures[l][r][i][c],s=[0,200,0];"entropy"==c?s=a<1.9?[Math.floor(a/1.9*256),Math.floor(a/1.9*256),255]:[255,256-Math.floor((a-1.9)/1.9*256),256-Math.floor((a-1.9)/1.9*256)]:"soa"==c?(a=Math.max(0,Math.min(1,.01*a)),s=[Math.floor(255*(1-a)),0,255-Math.floor(255*(1-a))]):"lddt"==c?(a=(1-a)*(1.5*Math.PI-Math.PI/2)+Math.PI/2,s=[Math.round(127.5*(Math.sin(a+Math.PI)+1)),Math.round(255*Math.sin(a-Math.PI/2)),Math.round(127.5*(Math.sin(a)+1))]):"bfactor"==c&&(h?(n=chainMapping.annotations.map(e=>e.key).indexOf("bfactor_range"),chainMapping.annotations[n].rangeColours[l]&&chainMapping.annotations[n].rangeColours[l][r]&&(s=chainMapping.annotations[n].rangeColours[l][r][i])):s=a<=10?[0,0,255]:10<a&&a<=15?[115,115,255]:15<a&&a<=20?[170,170,255]:20<a&&a<=25?[215,215,255]:25<a&&a<=30?[255,215,215]:30<a&&a<=35?[255,170,170]:35<a&&a<=40?[255,115,115]:[255,0,0]),t.style.backgroundColor="rgba("+s+",.6)",chainMapping.structures[l][r][i].rgb=s})}),o||(!t||"soa"!=c&&"entropy"!=c||"undefined"==typeof SCORE_URL?"bfactor"==c&&fetchBFactors(l,"bfactor")&&z(n,c+(h?"_range":"")):N.getJSON(SCORE_URL.replace("xxxx.0",t.match(/\w{4}\.\d+/)[0])+c,function(t,e){if(t.error)console.error("Could not fetch "+c+" values");else{for(chn in t)for(let e=0;e<t[chn].values.length;e++)null!=t[chn].values[e]&&chainMapping.structures[l]&&chainMapping.structures[l][chn]&&chainMapping.structures[l][chn][e+t[chn].offset+1]&&(chainMapping.structures[l][chn][e+t[chn].offset+1][c]=t[chn].values[e]);G(c,n),u()}}))}}function u(n){if(n&&n.singleResidue||("function"==typeof colourRama&&colourRama(),"function"==typeof colourModelBars&&colourModelBars()),void 0!==currentWin){if(0<N("#pv:visible",currentWin.document).length){let t=[];if(pv_viewer.forEach(function(e){t.push(e.name())}),0!=t.length){for(let i in chainMapping.structures)-1<t.indexOf(i)&&pv_viewer.get(i)&&pv_viewer.get(i).colorBy(new pv.color.ColorOp(function(e,t,n){e=e.residue();chainMapping.structures[i][e.chain().name()]&&chainMapping.structures[i][e.chain().name()][e.num()]&&chainMapping.structures[i][e.chain().name()][e.num()].rgb?(t[n]=chainMapping.structures[i][e.chain().name()][e.num()].rgb[0]/255,t[n+1]=chainMapping.structures[i][e.chain().name()][e.num()].rgb[1]/255,t[n+2]=chainMapping.structures[i][e.chain().name()][e.num()].rgb[2]/255):(t[n]=.9,t[n+1]=.9,t[n+2]=.9),t[n+3]=1}));pv_viewer.requestRedraw()}}if(0<N("#ngl:visible",currentWin.document).length)if(n&&n.singleResidue){var s=n.singleResidue;for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf("singleres")&&(NGL.ColormakerRegistry.removeScheme(schemeId),ngl_stage.eachRepresentation(function(e){if(e.repr.colorScheme==schemeId)for(schemeId2 in NGL.ColormakerRegistry.userSchemes)if(schemeId2.endsWith(e.name))return void e.setColor(schemeId2)}));if(s){let i=getNGLComponentByName(s.struc_id);i&&ngl_stage.eachRepresentation(function(e){let t=i.name;if(e.name!=t){if(!e.name.endsWith(".dna")||!i.name.startsWith(e.name.substring(0,5)))return;t=i.name+".dna"}var n;chainMapping.structures[t]&&(n=NGL.ColormakerRegistry.addScheme(function(e){for(chn in chainMapping.structures[t])" "==chn&&N("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(e){return ngl_picked_atom&&e.structure.name===ngl_picked_atom.structure.name&&e.index===ngl_picked_atom.index?16711680:chainMapping.structures[t][e.chainname]&&chainMapping.structures[t][e.chainname][e.resno]&&chainMapping.structures[t][e.chainname][e.resno].rgb?chainMapping.structures[t][e.chainname][e.resno].rgb[0]<<16|chainMapping.structures[t][e.chainname][e.resno].rgb[1]<<8|chainMapping.structures[t][e.chainname][e.resno].rgb[2]:16777215}},"singleres"),e.setColor(n))})}}else{var r,s=n;let t=[],e=(ngl_stage.eachRepresentation(function(e){t.push(e.name)}),s&&s.strucId?s.strucId:null),a={};for(r in ngl_stage.compList)if(void 0!==ngl_stage.compList[r].structure){let i=ngl_stage.compList[r].name;if(chainMapping.structures[i]&&(!e||i==e)){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(i)&&-1==schemeId.indexOf("membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);ngl_stage.eachRepresentation(function(e){if(e.name==i||e.name.endsWith(".dna")||e.name.endsWith(".highlight")||"drug.surroundings"==e.name)if(a[e.name])e.setColor(a[e.name]);else{let t;if(e.name.endsWith(".dna")){if(!i.startsWith(e.name.substring(0,5)))return;if(!chainMapping.structures[i+".dna"])return;t=i+".dna"}else t=i;var n=NGL.ColormakerRegistry.addScheme(function(e){for(chn in chainMapping.structures[t])" "===chn&&N("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(e){return chainMapping.structures[t][e.chainname]&&chainMapping.structures[t][e.chainname][e.resno]&&chainMapping.structures[t][e.chainname][e.resno].rgb?chainMapping.structures[t][e.chainname][e.resno].rgb[0]<<16|chainMapping.structures[t][e.chainname][e.resno].rgb[1]<<8|chainMapping.structures[t][e.chainname][e.resno].rgb[2]:16777215}},t);a[e.name]=n,e.setColor(n)}})}}}}}function F(t){let u=N.cookie("secStruct");null==u&&(u="dssp");var e=t.attr("id")+"_features";if(N("#"+e).html(""),0==N("#"+e).length||u&&"none"==u)t.removeClass("ss"),R(t).removeClass("ss");else{t.addClass("ss"),R(t).addClass("ss");let h=t.position().top,c=t.find("td:visible").first().width();var n=t.find("span:visible");if(0!==n.length){let l=n[0].getBoundingClientRect().width;var i=n[0].getBoundingClientRect().height,a=t.position().left;if(!(c<1)){p=Raphael(e,c,t.height()),N("#"+e).css("top",t.position().top);let o=t.data("templateData");if(o){var d=t.find("tr:visible");if(o.keyseq_annotation){var r=o.templates[0].trg_offset||1;for(let e=0;e<o.keyseq_chain_name.length;e++){var g=o.keyseq_chain_name[e];o.keyseq_annotation[g]&&o.keyseq_annotation[g][u]&&U(p,H(o.keyseq_annotation[g],u,r),d.filter('[keyseqchain="'+g+'"]'),d.filter('[keyseqchain="'+g+'"]').find("span[s]").toArray(),h,a,c,l,i)}}if(o.charts)for(let e=0;e<o.templates.length;e++){let r=o.templates[e];if(r.struc_id&&r.annotation){let a=r.trg_offset||1;function f(n,e,i){setTimeout(function(){var S=n,B=r.annotation,I=u,q=a,e=i,T=h,$=c,V=l,t=o;if(t.charts){let b=t.charts.split("|"),y=0,_=5,w=(-1<b.indexOf("dssp")&&(_=2,y=12,b.splice(b.indexOf("dssp"),1)),t.pageResidueCount<5e3),x=(q=q||1,S.set()),C=S.set(),M=S.set(),P=null,k,E,R,L,A;e.each(function(e,n){if(0!=(span=N(n).find("span").toArray()).length){var i=n.getAttribute("struc_id"),a=n.getAttribute("chain"),r=N(n).position().top-T+N(span[0]).position().top,o=n.getBoundingClientRect().left,n=span[span.length-1].getBoundingClientRect().right-o,l=(P=P||(r-y-_-10-6*(b.length-1))/(b.length||1),[]);let t="";for(let e=0;e<b.length;e++){var h=b[e];k="qm"===h?.3:0,L=r-P*e-_-y-6*e,R=L,(A=S.path(`M0,${R}L${$},${R}L${$},${R-P}L0,`+(R-P))).attr({"stroke-width":.4,stroke:"#888"});for(let e=Math.round(10*k);e<11;e++){E=R-P*((e-10*k)/(10-10*k));var c=S.path("M0,"+E+"L"+$+","+E);5==e?c.attr({"stroke-width":.7,opacity:.8,stroke:"#888","stroke-dasharray":"-"}):x.push(c)}l.push("")}for(let e=0;e<span.length;e++){var u=span[e],d=u.getAttribute("s");if(d){var p=u.getBoundingClientRect().left-o,g=parseInt(d),u=g-q;B[I+"_string"]&&B[I+"_string"][u]?t+=B[I+"_string"][u]:t+="-";for(let e=0;e<b.length;e++){var f=b[e],m=(k="qm"===f?.3:0,L=r-P*e-_-y-6*e,R=L,Math.max(k,chainMapping.structures[i][a][g][f]));if(E=R-P*((m-k)/(1-k)),w){let e;"qm"===f?e=.5<m?[Math.round(490*(1-m)),80,Math.round(255*m)]:"245,80,0":"lddt"===f&&(m=(1-m)*(1.5*Math.PI-Math.PI/2)+Math.PI/2,e=[Math.round(127.5*(Math.sin(m+Math.PI)+1)),Math.round(255*Math.sin(m-Math.PI/2)),Math.round(127.5*(Math.sin(m)+1))]),s=S.path(`M${p},${R}L${p},${E}L${p+V},${E}L${p+V},`+R),M.push(s),s.attr({fill:`rgba(${e},.6)`})}else l[e]+=`M${p} ${R}L${p} ${E}L${p+V} ${E}L${p+V} `+R}}else t+="-"}if(w)for(var v of l)M.push(S.path(v));0<y&&(txt=S.text(2,r-y-_+y/2,t),C.push(txt),txt.node.setAttribute("textLength",n-4+"px"),txt.node.firstChild.setAttribute("textLength",n-4+"px"))}}),C.attr({"text-anchor":"start","font-family":"consolas"}),M.attr({"stroke-width":.7,stroke:"#666"}),x.attr({"stroke-width":.9,stroke:"#888",opacity:.6,"stroke-dasharray":". "})}},0)}f(p,r.chain,d.filter(`[struc_id="${r.struc_id}"][chain="${r.chain}"]`))}}let e=null;for(visrow of d){$this=N(visrow);var m=parseInt($this.attr("seqno"));if(null!==e&&m<=e)break;if(null===e&&(e=m),!$this.attr("keyseqtype")){var v=$this.attr("chain"),b=$this.attr("struc_id"),y=($row=d.filter("[seqno="+m+"]")).find("span[s]").toArray();for(let e=0;e<o.templates.length;e++)o.templates[e].annotation&&H(o.templates[e].annotation,u),(b?o.templates[e].struc_id!=b:o.templates[e].chain!=v)||!b&&"target-template"==o.type&&o.templates[e].struc_id||o.templates[e].chain==v&&o.templates[e].annotation&&o.templates[e].annotation[u]&&U(p,H(o.templates[e].annotation,u),$row,y,h,a,c,l,i)}}}}}}}function W(e,t){var n=e[t];return"string"==typeof n&&(e[t+"_string"]=n.replace(/[GI]/g,"H").replace(/B/g,"E")),e[t+"_string"]}function H(e,n,i){var a;if(i=i||1,"string"==typeof e[n]){e[n+"_string"]=e[n],a=e[n].replace(/[GI]/g,"H").replace(/B/g,"E");let t=null;for(let e=0;e<a.length;e++)"H"!=a[e]&&"E"!=a[e]||(res_index=e+i,null==t?t=[[res_index,res_index,a[e]]]:t[t.length-1][1]==res_index-1&&t[t.length-1][2]==a[e]?t[t.length-1][1]=res_index:t.push([res_index,res_index,a[e]]));e[n]=t}return e[n]}function U(o,l,c,u,d,e,p,g,f){if(null!=l){let r=0;var m=u.length;for(let a=0;a<l.length;a++)if("E"==l[a][2]||"H"==l[a][2]){let t=null,n=null,i;for(let e=l[a][0];e<=l[a][1];e++)if(!(u[r].getAttribute("s")>e)){for(s=r;s<m;s++)if(u[s].getAttribute("s")==e){r=s,t=N(u[s]);break}if(t)break}for(let e=l[a][1];e>=l[a][0];e--){for(s=r;s<m;s++)if(u[s].getAttribute("s")==e){r=s,n=N(u[s]);break}if(n)break}if(null==t||null==n)r=0;else{thisRow=t.closest("tr"),startRowIdx=c.index(thisRow),endRowIdx=c.index(n.closest("tr"));var v=t.position();startResLeft=v.left-e,spanTop=v.top,endResLeft=n.position().left-e,rightLimit=thisRow.width()-g-g;for(let e=startRowIdx;e<endRowIdx+1;e++)if(e>startRowIdx&&(thisRow=c.eq(e),spanTop=thisRow.find("span").first().position().top),i=thisRow.position().top+spanTop-d,"E"==l[a][2]){M=C=x=w=_=y=b=void 0;var b=o,y=i,_=startResLeft-(e-startRowIdx)*p,w=endResLeft+(endRowIdx-e)*p,x=g,C=f,M=rightLimit;y+=1,C-=2,padding=2,_=Math.max(-x,Math.round(_)),w=Math.min(M,Math.round(w+x)),(s=b.path("M"+_+","+(y-padding)+"L"+(w-6)+","+(1.5+y)+"L"+(w-6)+","+(y-padding)+"L"+(w+padding)+","+(C/2+y)+"L"+(w-6)+","+(C+y+padding)+"L"+(w-6)+","+(C-1.5+y)+"L"+_+","+(C+y+padding)+"L"+_+","+(y-padding))).attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226","stroke-dasharray":"5 2"}),s}else M=o,x=i,b=startResLeft-(e-startRowIdx)*p,w=endResLeft+(endRowIdx-e)*p,C=g,_=f,y=rightLimit,x+=2,_-=4,padding=2,b=Math.max(-C,Math.round(b)),w=Math.min(y,Math.round(w+C)),(h=M.rect(b,x-padding,w-b,_+2*padding,4)).attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226"}),h}}}}function a(){let e="";"Multi FASTA"==N("#alignmentFormatSelect").val()?N(".alignTbl:visible").each(function(){e=e+t(N(this).attr("id").substring(8),"FASTA")+"\n"}):e=t(N("#currentAlignmentIndex").val(),N("#alignmentFormatSelect").val()),N("#formattedAlignmentTextarea").val(e),N("#formattedAlignmentTextarea").focus(),N("#formattedAlignmentTextarea").select()}function t(e,t){t=t||"fasta";var n=N("#alignNameTbl"+e);let i=N("#alignTbl"+e),a=[],s=[],r=[],o=[];e=0<N("#alignTbl"+e+" :visible").first().length?":visible":"";if(n.find("tr[seqno]"+e).each(function(e,t){t=parseInt(t.getAttribute("seqno"));if(0<a.length&&t<=a[0])return!1;a.push(t),s.push(N(this).text()),o.push(N(this).attr("title")),breakCount=0;let n="";i.find(`tr[seqno=${t}]`).each(function(){n+=N(this).find("td").first().text(),breakCount+=N(this).find(".insert_l,.insert_r").length}),r.push(n),0<breakCount&&(s[e]=`MULTIPLE_SEGMENTS_OF_${s[e]} - WARNING - CONTAINS NON-SEQUENTIAL SEGMENTS`)}),-1<t.search(/fasta/i)){var l=s,h=r,c=o;if(!h||0==h.length)return"No templates selected";let n="";for(let t=0;t<l.length;t++){n+=">"+l[t]+(c&&c[t]?" "+c[t]:"")+"\n";for(let e=0;e<h[t].length;e+=72)n+=h[t].substring(e,e+72)+"\n"}return n}if(-1<t.search(/clustal/i)){var u=s,d=r;if(!d||0==d.length)return"No templates selected";for(var p=0,g=0;g<u.length;g++)p=Math.max(p,u[g].length);p+=2;for(var f="CLUSTAL\n\n",m=0;m<d[0].length;m+=60){for(g=0;g<u.length;g++){f+=u[g];for(var v=u[g].length;v<p;v++)f+=" ";f+=d[g].substring(m,m+60)+"\n"}f+="\n"}return f=f.substring(0,f.length-2)}return""}N.fn.alignment=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void N.error("Method "+e+" does not exist on alignment.min.js"):l.init.apply(this,arguments)}}(jQuery),Object.keys||(Object.keys=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n}),$(document).on("click",".alignmentOptions input[name=csRadioGroup]",function(){delete chainMapping.defaultColourScheme,$(".alignTbl:first").alignment("colourAllAlignments",{col:$(this).val()})}),$(document).on("click","#viewerSelect input[name=3dRG]",function(){showViewer($(this).val())}),$("body").on("highlightResidue",function(e,t){if("alignment"!=t.src){t.multiple||$(".hoverResidue").removeClass("hoverResidue");var n=$('.alignTbl tr[struc_id^="'+t.struc_id+'"]:visible');if(0<n.length){let e=n.filter('[chain="'+t.chain+'"]');0<(e=0==e.length?n.filter('[keyseqchain="'+t.chain+'"]'):e).length&&e.find("span[s="+t.resno+"]").addClass("hoverResidue")}}}).on("selectResidue",function(e,t){if("alignment"!=t.src){t.multiple||($(".hoverResidue").removeClass("hoverResidue"),$(".selectResidue").removeClass("selectResidue"));var n=$('.alignTbl tr[struc_id^="'+t.struc_id+'"]:visible');if(0<n.length){let e=n.filter('[chain="'+t.chain+'"]');0<(e=0==e.length?n.filter('[keyseqchain="'+t.chain+'"]'):e).length&&e.find("span[s="+t.resno+"]").addClass("selectResidue")}}}),$("body").on("click",function(e){$(".poponthis").each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})}),addSettingsPopover(),0<$("#bgColSlider").length&&$("#bgColSlider").slider({value:$.cookie("bg_r")?$.cookie("bg_r"):255,min:0,max:255,step:1,slide:function(e,t){pv_viewer.options("background",[t.value/255,t.value/255,t.value/255]),ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+t.value+","+t.value+","+t.value+")"}),jQuery.cookie("bg_r",t.value,{expires:365,path:"/"})},change:function(e,t){pv_viewer.options("background",[t.value/255,t.value/255,t.value/255]),ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+t.value+","+t.value+","+t.value+")"}),jQuery.cookie("bg_r",t.value,{expires:365,path:"/"}),t.value<180?$(".viewerStatus").addClass("status_dark"):$(".viewerStatus").removeClass("status_dark")}}),$.cookie("bg_r")&&$.cookie("bg_r")<180&&$(".viewerStatus").addClass("status_dark");var chainMapping={structures:{},targets:{},alignments:[],chainMeta:{},annotations:[{key:"qm",label:"Confidence",active:!0},{key:"qmb",label:"QMEANBrane",active:!1},{key:"c",label:"Consistency",active:!0},{key:"entropy",label:"Entropy",active:!0},{key:"soa",label:"Solvent Accessibility",active:!0},{key:"bfactor",label:"B-factor",active:!0},{key:"bfactor_range",label:"B-factor range",active:!0}]};let annotationsModified=!1;function processAnnotations(d){if(0<$("#pv:visible",currentWin.document).length&&(pv_viewer.rm("model_"+(d||"*")+".label"),pv_viewer.rm("model_"+(d||"*")+".selected")),0<$("#ngl:visible",currentWin.document).length)for(const i in modelData)if(!d||i==d){var t=getNGLComponentByName("model_"+i);if(t){var n=[];for(let e=0;e<t.reprList.length;e++)(-1<t.reprList[e].name.indexOf(".label")||-1<t.reprList[e].name.indexOf(".selected"))&&n.push(t.reprList[e]);for(let e=0;e<n.length;e++)t.removeRepresentation(n[e])}}var s,e,p=[],g=$("#annotate").val().split(/\r?\n/),f={};for(let i=0;i<g.length;i++){let a,r,t,o,l,h,c,u=!1,e=(g[i]=g[i].trim().replace(/\s{1,}/g," ").replace(/\s*= */g,"="),g[i]);-1<e.search(/label=\"(.+)\"/i)&&(s=e.match(/label=\"(.+)\" ?/i),c=s[1],e=e.replace(s[0],"").trim());let n=!1;var m=e.split(" ");for(let e=0;e<m.length;e++){var v=m[e].split("=");if(2!=v.length)n=!0;else switch(v[0].toUpperCase()){case"MOTIF":a=v[1];break;case"COLOUR":case"COLOR":r=255*(r=new NGL.Color(v[1].toLowerCase())).r+","+255*r.g+","+255*r.b;break;case"TARGET":t=parseInt(v[1]);break;case"CHAIN":o=v[1];break;case"START":l=parseInt(v[1]);break;case"END":h=parseInt(v[1]);break;case"LABEL":c=v[1];break;case"SIDECHAINS":u="on"==v[1];break;default:n=!0}}if(a){let e=!1;try{rxtest=RegExp(a,"g"),e=!0}catch(e){}e||(console.error("Motif regex is invalid"),n=!0)}if(n=null!=r||null!=c||u?n:!0)0<g[i].length&&"?"!=g[i].charAt(0)?p.push("?"+g[i]):p.push(g[i]);else{p.push(g[i]);for(const C in modelData)if(!modelData[C].status||"COMPLETED"==modelData[C].status){let s={};for(let e=0;e<modelData[C].targets.length;e++)if(null==t||t==e+1){var b=modelData[C].targets[e];let t=b.target_sequence,n=b.id,i=(t||(t=b.templates[0].trg_seq,b.templates[0].tpl_seq&&(t=t.replaceAll("-","")),n=b.keyseq_chain_name,b.templates[0].trg_offset&&(t="-".repeat(b.templates[0].trg_offset-1)+t)),"string"!=typeof n&&(n=n.join("")),f["model_"+C]||(f["model_"+C]=[]),a);null==i&&(i=t.substring(l?l-1:0,h||t.length));for(let e=0;e<n.length;e++){var y=n.charAt(e);if(null==o||y==o){s[y]||(s[y]={labelled:[],selected:[]});var _=RegExp(i,"g");for(const M of t.matchAll(_)){let t=M.index+1,n=t+M[0].length-1;if(4==M.length&&(t+=M[1].length,n=t+M[2].length-1),!(l&&l>n)&&(!(h&&h<t)&&(l&&(t=Math.max(t,l)),h&&(n=Math.min(n,h)),r&&f["model_"+C].push({frmChn:y,toChn:y,resStart:t,resEnd:n,rgb:r}),c||u))){c&&"default"==c.toLowerCase()&&(c="default");var w=Math.floor((n-t)/2)+t;for(let e=t;e<=n;e++)u&&s[y].selected.push(e),"default"==c&&s[y].labelled.push(e);c&&"default"!=c&&s[y].labelled.push(w)}}}}}if((c||u)&&(null==d||d==C))if(0<$("#pv:visible",currentWin.document).length){var x=pv_viewer.get("model_"+C);x&&(x=x.structure().residueSelect(function(e){if(s[e.chain().name()]&&(-1<s[e.chain().name()].selected.indexOf(e.num())||-1<s[e.chain().name()].labelled.indexOf(e.num())))return-1<s[e.chain().name()].labelled.indexOf(e.num())&&e.eachAtom(function(e){"CA"==e.name()&&pv_viewer.label(`model_${C}.label`,"default"!=c?c:e.residue()._name+" "+e.residue()._chain.name()+e.residue().num(),e.pos(),{fontSize:12,fontColor:"#CCC"})}),-1<s[e.chain().name()].selected.indexOf(e.num())}))&&pv_viewer.ballsAndSticks(`model_${C}.selected`,x)}else if(0<$("#ngl:visible",currentWin.document).length){x=getNGLComponentByName("model_"+C);if(x){let n="",i=!1;for(chn in s)if(0!=s[chn].labelled.length){0<n.length&&(n+=" or "),n+="( :"+chn+" and (";let t=null;for(let e=0;e<s[chn].labelled.length;e++)i=!0,t=(t&&s[chn].labelled[e]==t+1||(t&&(n+="-"+t),0<e&&(n+=" or "),n+=s[chn].labelled[e]),s[chn].labelled[e]);t&&(n+="-"+t),n+=") and .CA) "}i&&x.addRepresentation("label",{name:"model_"+C+".label",sele:n,labelType:"format",labelFormat:"default"!=c?c:"%(resname)s %(chainname)s%(resno)s",fontWeight:"bold",radiusScale:1.4,xOffset:.3}),n="";let a=!1;for(chn in s)if(0!=s[chn].selected.length){0<n.length&&(n+=" or "),n+="( :"+chn+" and (";let t=null;for(let e=0;e<s[chn].selected.length;e++)a=!0,t=(t&&s[chn].selected[e]==t+1||(t&&(n+="-"+t),0<e&&(n+=" or "),n+=s[chn].selected[e]),s[chn].selected[e]);t&&(n+="-"+t),n+=")) "}a&&x.addRepresentation("ball+stick",{name:"model_"+C+".selected",sele:n,colorScheme:"element"})}}}}}d||(e=p.join("\n"),"undefined"!=typeof annotationsURL&&-1==e.search(/^\?/m)&&$.ajax({type:"POST",url:annotationsURL,data:{annotations:e,csrfmiddlewaretoken:csrf},success:function(e){annotationsModified=!1},error:function(e){console.error(e)}}),chainMapping.defaultColourScheme="features",$("#annotate").val()!=e&&$("#annotate").val(e),$(".alignTbl:first").alignment("colourAllAlignments",{features:f}))}$("#annotate").on("keyup",function(e){var t=e.keyCode||e.which;"keyup"==e.type&&13==t?processAnnotations():annotationsModified=!0}),$("body").on("centerResRange selectResidue",function(e,r){if(r.struc_id&&0!=$("#annotate:visible").length){let a=r.resno,s=r.resno;for(var o in null==a&&(a=r.min,s=r.max),modelData)if("model_"+o==r.struc_id){for(let i=0;i<modelData[o].targets.length;i++){var l=modelData[o].targets[i];let t=l.target_sequence,e=l.id,n=0;if(t||(t=l.templates[0].trg_seq,l.templates[0].tpl_seq&&(t=t.replaceAll("-","")),e=l.keyseq_chain_name,l.templates[0].trg_offset&&(n=l.templates[0].trg_offset-1)),-1<e.indexOf(r.chain)){l=t.substring(a-1-n,s-n);let e=$("#annotate").val();"\n"!=e.charAt(e.length-1)&&(e+="\n"),e+="motif="+l,1<modelData[o].targets.length&&(e+=" target="+(i+1)),$("#annotate").val(`${e} start=${a} end=${s}\n`).scrollTop($("#annotate")[0].scrollHeight);break}}break}}});let currentWin=window,main_NGL_module=null,main_pv=null,main_ngl=null,plip_bond_num_dash=5,plip_bond_radius=.1,plip_higlight_factor=2,plip_higlight_bond_num_dash=1;var PLIP=PLIP||{};PLIP.AbstractViewer=null;let opacity_fadeout_ligand=.3,opacity_fadeout_protein=.3;function takeSnapshot(t,e){var n;".png"==t&&(t="structure.png"),0<$("#pv:visible",currentWin.document).length&&$("#pv canvas")[0].toBlob(function(e){saveAs(e,t)}),0<$("#ngl:visible",currentWin.document).length&&(e=e||1,n=$("#snapshot_bg_transparent_checkbox").is(":checked"),ngl_stage.makeImage({factor:e,antialias:!1,trim:!1,transparent:n}).then(function(e){NGL.download(e,t)}))}function resetStructure(){$(".hoverResidue").removeClass("hoverResidue"),$(".selectResidue").removeClass("selectResidue"),0<$("#pv:visible",currentWin.document).length&&(pv_viewer.show("*ligands"),pv_viewer.hide("*ligands_lines"),pv_viewer.rm("*res"),pv_viewer.autoZoom(),pv_viewer.requestRedraw()),0<$("#ngl:visible",currentWin.document).length&&(ngl_stage.eachRepresentation(function(e){-1<e.name.indexOf("hover")&&"none"!=e.repr.selection.string&&e.setSelection("none")}),ngl_stage.autoView(1200))}function spin(e){"undefined"!=typeof pv_viewer&&pv_viewer.spin(e),null!=ngl_stage&&(e?ngl_stage.setSpin([0,1,0],-.005):ngl_stage.setSpin(0))}function detach(e){if(currentWin==window){if(0<$("#pv:visible",currentWin.document).length)currentWin=window.open(e.replace("xx","pv"),"_blank","resizable=1,status=1,toolbar=1,location=1,height=700,width=700"),main_pv=pv_viewer;else{if(!(0<$("#ngl:visible",currentWin.document).length))return;main_ngl=ngl_stage,main_NGL_module=NGL,currentWin=window.open(e.replace("xx","ngl"),"_blank","resizable=1,status=1,toolbar=1,location=1,height=700,width=700")}$("#left-panel").is(".ui-resizable")&&$("#left-panel").resizable("destroy"),$("#left-panel").removeClass().addClass("detached"),$("#right-panel").hide(),$(window).trigger("resize")}}function attachPV(){pv_viewer=main_pv,attach()}function attachNGL(){var e=ngl_stage.viewerControls.getOrientation();NGL=main_NGL_module,(ngl_stage=main_ngl).removeAllComponents(),showNGL(e),attach()}function attach(){currentWin=window;let t=$("#right-panel").attr("class");if(t){t=t.split(/\s+/);for(let e=0;e<t.length;e++)3==(size=t[e].split("-")).length&&$("#left-panel").addClass(size[0]+"-"+size[1]+"-"+(12-parseInt(size[2])))}$("#left-panel").removeClass("detached").resizable({handles:"e",stop:function(){}}),$("#right-panel").show(),$(window).trigger("resize"),"undefined"!=typeof superposeTemplates&&superposeTemplates(!0),refreshBondsAndLigandHighlights()}function refreshBondsAndLigandHighlights(e){refreshHighlightLigands(e),refreshBonds(e)}function refreshBonds(e){void 0===e?plip_bonds.refreshAll():plip_bonds.refresh(e)}function refreshHighlightLigands(e){void 0===e?all_ligands.redrawAll():all_ligands.redraw(e)}function centerOnLigand(e,t){0<$("#pv:visible",currentWin.document).length&&centerOnLigandPV(e,t),0<$("#ngl:visible",currentWin.document).length&&centerOnLigandNGL(e,t)}function highlightLigand(e,t,n){$(".ligandContact").removeClass("ligandContact");for(var i={},a=0;a<t.length;a++)t[a]&&"_"!=t[a].charAt(0)&&(res=t[a].substring(1),i[chain=t[a].charAt(0)]||(i[chain]=[]),i[chain].push(res));var s,r=$(".alignTbl tr[struc_id="+n+"]"),o=r[0].hasAttribute("keyseqchain")?"keyseqchain":"chain";for(s in i)for(var l=r.filter("["+o+"="+s+"]").find("span").toArray(),a=0;a<i[s].length;a++)for(var h=0;h<l.length;h++)if(l[h].getAttribute("s")==i[s][a]){l[h].className="ligandContact";break}0<$("#pv:visible",currentWin.document).length&&highlightLigandPV(i,t,n),0<$("#ngl:visible",currentWin.document).length&&highlightLigandNGL(e,t,n)}function selectResidues(e,t,n,i){if(null!=e||null!=t)return 0<$("#pv:visible",currentWin.document).length?highlightResiduesPV(e,t,n,i):0<$("#ngl:visible",currentWin.document).length?highlightResiduesNGL(e,t,n,i):void 0;0<$("#pv:visible",currentWin.document).length&&pv_viewer.rm(n+"_res"),0<$("#ngl:visible",currentWin.document).length&&("undefined"!=typeof all_ligands&&"undefined"!=typeof plip_residues?highlightLigandNGL(all_ligands.getVisibleLigandIds(n),plip_residues.getVisibleResiduesResId(n),n,i):highlightResiduesNGL([],[],n,i))}function changeRep(e){e=e||"cartoon",0<$("#pv:visible",currentWin.document).length&&(changeRepPV(e),null!=pv_viewer)&&0<pv_viewer.all().length&&("undefined"!=typeof detached&&detached?window.opener.updatecols():updatecols()),0<$("#ngl:visible",currentWin.document).length&&(changeRepNGL(e),"undefined"!=typeof detached&&detached?window.opener.updatecols():updatecols())}function updatecolsSingleRes(e){$(".alignTbl:first").alignment("updateColoursSingleResidue",e)}function updatecols(){$(".alignTbl:first").alignment("viewerInitialised")}function fetchSecStruc(e){if(0<$("#pv:visible",currentWin.document).length){if(pv_viewer.get(e))return fetchSecStrucPV(e,pv_viewer.get(e).structure())}else if(0<$("#ngl:visible",currentWin.document).length&&getNGLComponentByName(e))return fetchSecStrucNGL(e,getNGLComponentByName(e).structure)}function fetchBFactors(e,t,n){if(0<$("#pv:visible",currentWin.document).length){if(pv_viewer.get(e))return fetchBFactorsPV(e,pv_viewer.get(e).structure(),t,n)}else if(0<$("#ngl:visible",currentWin.document).length&&getNGLComponentByName(e))return fetchBFactorsNGL(e,getNGLComponentByName(e).structure,t,n)}function setBFactorRange(e){let t=1e10,n=-1e10,i=0,a=0;for(chn in chainMapping.structures[e])for(res in chainMapping.structures[e][chn]){var s;chainMapping.structures[e][chn][res]&&chainMapping.structures[e][chn][res].bfactor&&(s=chainMapping.structures[e][chn][res].bfactor,t=Math.min(s,t),n=Math.max(s,n),i+=s*s,a++)}i/=a,i=Math.sqrt(i),n=2*i;var r=[];for(let e=0;e<256;e++)r.push([e,e,255]);for(let e=256;e<512;e++)r.push([255,512-e,512-e]);var o,l=chainMapping.annotations.map(e=>e.key).indexOf("bfactor_range");for(chn in chainMapping.annotations[l].rangeColours||(chainMapping.annotations[l].rangeColours={}),chainMapping.annotations[l].rangeColours[e]={},chainMapping.structures[e])for(res in chainMapping.annotations[l].rangeColours[e][chn]=[],chainMapping.structures[e][chn])chainMapping.structures[e][chn][res]&&chainMapping.structures[e][chn][res].bfactor&&(o=chainMapping.structures[e][chn][res].bfactor,o=Math.round(512*(o-t)/(n-t))-1,o=Math.max(o,0),o=Math.min(o,511),chainMapping.annotations[l].rangeColours[e][chn][res]=r[o])}$("body").on("highlightResidue",function(e,t){if("structure"!=t.src&&"varianceChart"!=t.src)return null!=t.chain||null!=t.resno?0<$("#pv:visible",currentWin.document).length?highlightResiduesPV(t.chain,t.resno,t.struc_id,t.multiple):0<$("#ngl:visible",currentWin.document).length?highlightResiduesNGL(t.chain,t.resno,t.struc_id,t.multiple):void 0:(0<$("#pv:visible",currentWin.document).length&&pv_viewer.rm(t.struc_id+"_res"),void(0<$("#ngl:visible",currentWin.document).length&&ngl_stage.getRepresentationsByName(t.struc_id+".hover").list[0].setSelection("none")))}),$("body").on("centerResRange",function(e,t){0<$("#pv:visible",currentWin.document).length&&centerResRangePV(t.chain,t.min,t.max,t.struc_id,t.isDisulfid,t.secondChain),0<$("#ngl:visible",currentWin.document).length&&centerResRangeNGL(t.chain,t.min,t.max,t.struc_id,t.isDisulfid,t.secondChain)}),$("body").on("connectResidues",function(e,t){0<$("#pv:visible",currentWin.document).length&&connectResiduesPV(t.residuePairs),0<$("#ngl:visible",currentWin.document).length&&connectResiduesNGL(t.residuePairs)});var ngl_stage=null,ngl_picked_atom=!1,ngl_picked_component=!1;function getNGL(){var e="white",e=($.cookie("bg_r")&&(e="rgb("+$.cookie("bg_r")+","+$.cookie("bg_r")+","+$.cookie("bg_r")+")"),ngl_stage=new NGL.Stage("ngl",{backgroundColor:e,hoverTimeout:.005,sampleLevel:2,tooltip:!1}),(new NGL.Matrix4).makeRotationX(Math.PI/2)),t=(new NGL.Quaternion).setFromRotationMatrix(e);return ngl_stage.viewerControls.rotate(t),e=(new NGL.Matrix4).makeRotationY(Math.PI),t=(new NGL.Quaternion).setFromRotationMatrix(e),ngl_stage.viewerControls.rotate(t),ngl_stage.signals.clicked.add(function(e){var t;e&&(e.atom||e.bond)&&(t=e.atom||e.closestBondAtom,e.component.autoView(t.resno+":"+t.chainname,1e3),$("body").trigger("selectResidue",{src:"structure",struc_id:e.component.name,chain:t.chainname,resno:t.resno}))}),ngl_stage.signals.hovered.add(function(e){var t,n,i;ngl_stage.mouseObserver.pressed||(e&&(e.atom||e.bond)?(t=e.atom||e.closestBondAtom,ngl_picked_atom&&t.structure.name==ngl_picked_atom.structure.name&&t.index==ngl_picked_atom.index||(n=getNGLRepresentationByName(e.component.name),ngl_picked_atom=t,ngl_picked_component=e.component,i=t.resname+" "+t.resno+t.inscode,"_"!=t.chainname&&(i+=" "+t.chainname),"_"!=t.chainname&&["cartoon","tube","rope"].includes(n.repr.type)&&"CA"==t.atomname||(i+=" "+t.atomname),i+=resAnnoLabel(e.component.name,t.chainname,t.resno),document.getElementById("ngl_status").innerHTML=i,$("body").trigger("highlightResidue",{src:"structure",struc_id:e.component.name,chain:t.chainname,resno:t.resno}),"undefined"!=typeof detached&&detached?(window.opener.ngl_picked_atom=ngl_picked_atom,window.opener.updatecolsSingleRes({struc_id:e.component.name,chain:t.chainname,resno:t.resno})):updatecolsSingleRes({struc_id:e.component.name,chain:t.chainname,resno:t.resno}))):ngl_picked_atom&&(ngl_picked_atom=!1,document.getElementById("ngl_status").innerHTML="","undefined"!=typeof detached&&detached?(window.opener.ngl_picked_atom=ngl_picked_atom,window.opener.updatecolsSingleRes()):updatecolsSingleRes()))}),ngl_stage}function getNGLComponentByName(e){return ngl_stage.getComponentsByName(e).list[0]}function getNGLRepresentationByName(e){return ngl_stage.getRepresentationsByName(e).list[0]}function removeNGLComponentByName(e){e=getNGLComponentByName(e);ngl_stage.removeComponent(e)}function highlightResiduesNGL(e,t,n,i){let a="";if(n&&n.endsWith(".dna")&&(n=n.replace(".dna","")),!t){var s=getNGLComponentByName(n),r="";if(s){if(1==e.length)r=(t||"")+":"+e;else for(l=0;l<e.length;l++)r+=(t||"")+":"+e[l]+" ";s.autoView(r,1e3)}return r}ngl_stage.eachRepresentation(function(e){-1<e.name.indexOf("hover")&&-1==e.name.indexOf(n)&&"none"!=e.repr.selection.string&&e.setVisibility(!1)});s=getNGLRepresentationByName(n+".hover");if(s){s.setVisibility(!0),i&&(a=s.repr.selection.string+" ").startsWith("none")&&(a=a.substring(5));for(var o=getNGLComponentByName(n).structure,r="",l=0;l<e.length;l++)if(t.length)for(var h=0;h<t.length;h++)t[h][0]==t[h][1]?isResidueInStructureNGL(o,e[l],t[h][0])&&(r+=t[h][0]+":"+e[l]+" "):(console.warn("Not checking if the selection is part of the structure"),r+=t[h][0]+"-"+t[h][1]+":"+e[l]+" ");else isResidueInStructureNGL(o,e[l],t)&&(r+=t+":"+e[l]+" ");return""==(new_selection=a+r)&&(new_selection="none"),s.setSelection(new_selection),new_selection}}function centerResRangeNGL(n,i,a,e,s,r){let o="";var l=getNGLComponentByName(e=e.replace(".dna",""));if(l){l=l.structure;for(let t=0;t<n.length;t++){var h=r?i:a;for(let e=i;e<=h;e++)s&&e!=i&&e!=h||isResidueInStructureNGL(l,n[t],e)&&(o+=e+":"+n[t]+" ")}if(r)for(let e=0;e<r.length;e++)isResidueInStructureNGL(l,r[e],a)&&(o+=a+":"+r[e]+" ");""!=o&&getNGLComponentByName(e).autoView(o,1e3)}}function centerOnLigandNGL(e,t){for(var n,i=e[0]+":_",a=1;a<e.length;a++)i+=" "+e[a]+":_";for(n in ngl_stage.compList)if(ngl_stage.compList[n].name==t){ngl_stage.compList[n].autoView(i,1e3);break}}function contactListToNGLSelection(e,t,n){var i,a={},s=null;if(void 0!==n&&null!=n||(n=[]),t&&0<t.length)for(var r=getNGLComponentByName(e).structure,o=0;o<t.length;o++)t[o]&&(s=t[o].charAt(0),i=parseInt(t[o].substring(1)),"_"==s&&-1==n.indexOf(i)&&n.push(i),isResidueInStructureNGL(r,s,i))&&"-"!=s&&(a[s]||(a[s]=[]),a[s][i]=1);var l="",h="";for(s in a){l+=" ( (",h+=" ( (";for(var c=!0,o=0;o<a[s].length;o++)if(a[s][o]){for(c?c=!1:(l+=" or ",h+=" or "),l+=o,h+=o-2,start=o;a[s][++o];);1<o-start&&(l+="-"+(o-1)),h+="-"+(o+1)}l+=") AND :"+s+") ",h+=") AND :"+s+") "}return[l,h,n]}function isResidueInStructureNGL(e,t,n){var i={};try{e.eachChain(function(e){e.chainname==t&&(first_residue=e.residueStore.resno[e.residueOffset],last_residue=e.residueStore.resno[e.residueEnd],e.eachResidue(function(e){if(e.resno==n)throw i}))})}catch(e){if(e===i)return!0}return!1}function highlightLigandNGL(e,t,n,i,a){removeNGLComponentByName(n+"ligandBondsHL"),void 0===i&&(i="undefined"==typeof extra_residues_selection?[]:extra_residues_selection),void 0===a&&(a="undefined"==typeof extra_ranges_selection?[]:extra_ranges_selection),residue_contacts=t.concat(i),ranges_contacts=residue_contacts.concat(a);var s,r,t=contactListToNGLSelection(n,residue_contacts,e),o=(e=t[2],contactListToNGLSelection(n,ranges_contacts));let l=t[0],h=o[1];for(s in""==l&&(l="none"),""==h?(h="none",fadeOutRepresentationNGL(n,n,1)):fadeOutRepresentationNGL(n,n,opacity_fadeout_protein),ngl_stage.compList)if(ngl_stage.compList[s].name==n){for(var c in ngl_stage.compList[s].reprList)ngl_stage.compList[s].reprList[c].name==n+".residuesHighlight"&&ngl_stage.compList[s].reprList[c].setSelection(l),ngl_stage.compList[s].reprList[c].name==n+".highlight"&&(protein_residue_sele_string="protein AND ("+h+")",ngl_stage.compList[s].reprList[c].setSelection(protein_residue_sele_string));break}e&&0<e.length?(r=":_ and ("+e.join(" or ")+")",fadeOutRepresentationNGL(n,n+".ligands",opacity_fadeout_ligand)):0<i.length||0<a.length?(r="none",fadeOutRepresentationNGL(n,n+".ligands",opacity_fadeout_ligand)):(r="none",fadeOutRepresentationNGL(n,n+".ligands",1));t=getNGLRepresentationByName(n+".ligandsHighlight");t&&t.setSelection(r)}function fadeOutRepresentationNGL(e,t,n){(repr=getNGLRepresentationByName(t))&&repr.setParameters({opacity:n})}function connectResiduesNGL(e){var t=[];ngl_stage.compList.forEach(function(e){-1<e.name.indexOf("connect")&&t.push(e)});for(var n=0;n<t.length;n++)ngl_stage.removeComponent(t[n]);if(e)for(n=0;n<e.length;n++){var i,a=getNGLComponentByName(e[n][0].struc_id),s=new NGL.Shape("connect."+n+".line",{disableImpostor:!0});a&&(i=a.structure.getView(new NGL.Selection(e[n][0].res_num+":"+e[n][0].chain+".CA")).getAtomData().position,a=a.structure.getView(new NGL.Selection(e[n][1].res_num+":"+e[n][1].chain+".CA")).getAtomData().position,0<i.length)&&0<a.length&&(score=Math.min(1,2*e[n][2]),s.addCylinder(i,a,[.9,1-score,1-score],.2),ngl_stage.addComponentFromObject(s).addRepresentation("buffer"))}}function changeRepNGL(t){switch($("#repBtnLbl").text(t.charAt(0).toUpperCase()+t.substring(1)),jQuery.cookie("defaultRepr",t,{expires:365,path:"/"}),t){case"lines":t="line";break;case"ballAndStick":t="ball+stick";break;case"outline":return}var n,a=null;ngl_stage.eachRepresentation(function(e){if(!e.name.match(/(ligands|dna|over|buffer|membrane)/))for(i in n=e.name.split(".")[0],ngl_stage.compList)if((comp=ngl_stage.compList[i]).name==n){if("surface"==(a=null===a?e.repr.type:a)&&"surface"!=t){console.debug("Adding residuesHighlight representation"),comp.addRepresentation(t,{name:n+".residuesHighlight",sele:"none",smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,side:"front",opacity:e.getParameters().opacity,scaleFactor:Math.min(1.5,Math.max(.1,5e4/comp.structure.atomCount))});try{refreshBondsAndLigandHighlights()}catch(e){}}comp.removeRepresentation(e),"surface"==t&&e.name==n+".residuesHighlight"?console.debug("Removing surface residuesHighlight"):comp.addRepresentation(t,{name:e.name,sele:e.getParameters().sele,smoothSheet:!0,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/comp.structure.atomCount)),roughness:1,side:"front",opacity:e.getParameters().opacity})}})}function setupNGLRepresentations(t,n,e,i,a,s){a&&ngl_stage.viewerControls.orient(a),void 0===e&&(e=!1);var r=$.cookie("defaultRepr");null==r?r="cartoon":"ballAndStick"==r?r="ball+stick":"lines"==r&&(r="line"),t.setName(n),t.addRepresentation(r,{name:n,sele:"not :_ and not nucleic and not :-"+(s?" and not ligand":""),smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/t.structure.atomCount)),side:"front"}),t.addRepresentation("ball+stick",{name:n+".ligands",colorScheme:"element",sele:":_"+(s?" or ligand":""),side:"front"}),t.addRepresentation("ball+stick",{name:n+".residuesHighlight",colorScheme:"element",sele:"none",aspectRatio:1}),t.addRepresentation("ball+stick",{name:n+".hover",sele:"none"}),e&&(t.addRepresentation("ball+stick",{name:n+".ligandsHighlight",colorScheme:"element",sele:"none"}),"surface"!=r)&&t.addRepresentation(r,{name:n+".highlight",sele:"none",smoothSheet:!0,roughness:1,surfaceType:"sas",probeRadius:1.4,scaleFactor:Math.min(1.5,Math.max(.1,5e4/t.structure.atomCount)),side:"front"}),i&&i.forEach(function(e){scheme="line"==e?"element":"base"==e?"resname":"moleculetype",t.addRepresentation(e,{name:n+".dna",colorScheme:scheme,sele:"nucleic and not :_"})}),a?ngl_stage.autoView():"function"==typeof on_viewer_ready_function?on_viewer_ready_function(n,t):t.autoView(1e3),updatecols(),e&&refreshBondsAndLigandHighlights()}function resAnnoLabel(e,i,a){let s="";return[e,e+".dna"].forEach(n=>{if(chainMapping.structures[n]&&chainMapping.structures[n][i]&&chainMapping.structures[n][i][a]){chainMapping.chainMeta[n]&&chainMapping.chainMeta[n][i]&&(s+=" ("+chainMapping.chainMeta[n][i].display+")");for(let t=0;t<chainMapping.annotations.length;t++)if(chainMapping.annotations[t].active&&null!=chainMapping.structures[n][i][a][chainMapping.annotations[t].key]){let e=chainMapping.structures[n][i][a][chainMapping.annotations[t].key];s+="<br><small>"+chainMapping.annotations[t].label+": "+("number"==typeof e?e.toFixed("ramachandran"==chainMapping.annotations[t].key?4:2):e),"qm"==chainMapping.annotations[t].key&&"confClass"==$.cookie("colourScheme")&&(e<1&&(e*=100),90<e?s+=" (Very high)":70<e?s+=" (Confident)":50<e?s+=" (Low)":s+=" (Very low)"),s+="</small>"}}}),s}function fetchBFactorsNGL(i,e,a,s){let r=0,o=0;return chainMapping.structures[i]||(chainMapping.structures[i]={}),e.eachResidue(function(e){var n=e.chainname;if(!n.match(/(_|-)/)){let t=0;e.eachAtom(function(e){t+=e.bfactor}),r+=t/e.atomCount,o++,coloursAssigned=!0,chainMapping.structures[i][n]||(chainMapping.structures[i][n]=[]),chainMapping.structures[i][n][e.resno]||(chainMapping.structures[i][n][e.resno]={}),s&&!chainMapping.structures[i].invalidMapping&&chainMapping.structures[i][n][e.resno].resname&&residueProperties[chainMapping.structures[i][n][e.resno].resname].triplet!=e.resname&&(chainMapping.structures[i].invalidMapping=!0),chainMapping.structures[i][n][e.resno][a]=t/e.atomCount}}),"bfactor"==a&&setBFactorRange(i),0<r?r/o:0}function fetchSecStrucNGL(t,e){let n;return e.eachResidue(function(e){(n=e.chainname).match(/(_|-)/)||(chainMapping.structures[t]||(chainMapping.structures[t]={}),chainMapping.structures[t][n]||(chainMapping.structures[t][n]=[]),chainMapping.structures[t][n][e.resno]||(chainMapping.structures[t][n][e.resno]={}),chainMapping.structures[t][n][e.resno].ss=e.sstruc.toUpperCase(),""==chainMapping.structures[t][n][e.resno].ss&&(chainMapping.structures[t][n][e.resno].ss="C"))}),!0}function setColorForAtom(e,t,n){var i=e.structure().createEmptyView();i.addAtom(t),e.colorBy(pv.color.uniform(n),i)}var prevPicked=null;function doPVMouse(e){var t,n,i,a;pv_viewer._mouseHandler._lastMouseDownTime&&(null==pv_viewer._mouseHandler._lastMouseDownTime||pv_viewer._mouseHandler._lastMouseUpTime<pv_viewer._mouseHandler._lastMouseDownTime)||(t=pv_viewer.boundingClientRect(),t=pv_viewer.pick({x:e.clientX-t.left,y:e.clientY-t.top}),null!==prevPicked&&null!==t&&t.target()===prevPicked.atom?"click"==e.type&&("_"!=(n=(e=prevPicked.atom).qualifiedName().split("."))[0].charAt(0)&&e.residue()._isAminoacid&&$("body").trigger("selectResidue",{src:"structure",struc_id:t.object().geom.name(),chain:n[0],resno:e.residue().num()}),pv_viewer.fitTo(e.residue())):(null!==prevPicked&&setColorForAtom(prevPicked.node,prevPicked.atom,prevPicked.color),null!==t?"_"===(e=(n=t.target()).qualifiedName().split("."))[0].charAt(0)||!n.residue().isAminoacid()&&!n.residue().isNucleotide()?document.getElementById("pv_status").innerHTML=n.residue().name()+" "+n.residue().num():(a=[0,0,0,0],t.node().getColorForAtom(n,a),prevPicked={atom:n,color:a,node:t.node()},setColorForAtom(t.node(),n,"red"),a=t.object().geom.name(),a=n.residue().name()+" "+(i=n.residue().num())+" "+e[0]+resAnnoLabel(a,e[0],i),document.getElementById("pv_status").innerHTML=a,$("body").trigger("highlightResidue",{src:"structure",struc_id:t.object().geom.name(),chain:e[0],resno:n.residue().num()})):(document.getElementById("pv_status").innerHTML="",prevPicked=null),pv_viewer.requestRedraw()))}function highlightResiduesPV(t,n,i,e){e||pv_viewer.rm("*_res");let a=pv_viewer.get(i);if(null!=a){if(a=a.structure(),n){let e=null;return e=n.length?a.select({cnames:t.split("")}).residueSelect(function(t){for(let e=0;e<n.length;e++)if(t.num()>=n[e][0]&&t.num()<=n[e][1])return!0;return!1}):a.select({cnames:t.split("")}).residueSelect(function(e){return e.num()==n}),pv_viewer.ballsAndSticks((i?i+"_":"")+"res",e),e}pv_viewer.fitTo(a.select({cnames:t.split("")})),pv_viewer.requestRedraw()}}function centerResRangePV(t,n,i,e,a,s){var r,e=pv_viewer.get(e);null!=e&&(r=null,r=1==t.length?e.structure().residueSelect(function(e){return s?e.num()==n&&e.chain().name()==t||e.num()==i&&e.chain().name()==s:a?(e.num()==n||e.num()==i)&&e.chain().name()==t:e.num()>=n&&e.num()<=i&&e.chain().name()==t}):e.structure().residueSelect(function(e){return a?(e.num()==n||e.num()==i)&&-1<t.indexOf(e.chain().name()):e.num()>=n&&e.num()<=i&&-1<t.indexOf(e.chain().name())}),pv_viewer.fitTo(r),pv_viewer.requestRedraw())}function centerOnLigandPV(n,e){var e=pv_viewer.get(e+".ligands");null!=e&&(e=(e=e.structure()).residueSelect(function(e){for(var t=0;t<n.length;t++)if(e.num()==n[t])return!0}),pv_viewer.fitTo(e),pv_viewer.requestRedraw())}function highlightLigandPV(s,e,t){pv_viewer.rm("*ligandContactsHL"),null!=pv_viewer.get(t+".ligands")&&s&&(e=pv_viewer.get(t).structure().residueSelect(function(e){var t=e.chain().name(),n=e.num(),i=s[t];if(i)for(var a=0;a<i.length;a++)if(n==i[a])return!0}),pv_viewer.lines(t+"ligandContactsHL",e),pv_viewer.requestRedraw())}function connectResiduesPV(n){if(pv_viewer.rm("connect.*"),n)for(let t=0;t<n.length;t++){var i,a,s,r=pv_viewer.customMesh("connect."+t+".line");let e=pv_viewer.get(n[t][0].struc_id);e&&(i=(e=e.structure()).atom(n[t][0].chain+"."+n[t][0].res_num+".CA"),a=e.atom(n[t][1].chain+"."+n[t][1].res_num+".CA"),i)&&a&&(s=pv.vec3.clone(i.pos()),pv.vec3.add(s,s,a.pos()),pv.vec3.scale(s,s,.5),score=Math.min(1,2*n[t][2]),r.addTube(i.pos(),a.pos(),.1,{color:[.9,1-score,1-score]}))}pv_viewer.requestRedraw()}function changeRepPV(e){if("outline"==(e=e.match(/(cartoon|tube|trace|lines|outline|fog)/)?e:"cartoon"))jQuery.cookie("pv_outline",!pv_viewer.options("outline"),{expires:365,path:"/"}),pv_viewer.options("outline",!pv_viewer.options("outline"));else if("fog"==e)jQuery.cookie("pv_fog",!pv_viewer.options("fog"),{expires:365,path:"/"}),pv_viewer.options("fog",!pv_viewer.options("fog"));else if(e.match(/(cartoon|tube|trace|lines|ballAndStick)/)){$("#repBtnLbl").text(e.charAt(0).toUpperCase()+e.substring(1)),jQuery.cookie("defaultRepr",e,{expires:365,path:"/"});var n=[],i=[];pv_viewer.forEach(function(e){var t=e.name();t.match(/(ligand|dna|res|LigandBond|membrane|label|selected)/)||(n.push(t),i.push(e.structure()))});for(var t=0;t<n.length;t++)pv_viewer.rm(n[t]);for(t=0;t<i.length;t++){var a=n[t],s=i[t];switch(e){case"cartoon":pv_viewer.cartoon(a,s,{color:pv.color.uniform("white")});break;case"tube":pv_viewer.tube(a,s,{color:pv.color.uniform("white")});break;case"trace":pv_viewer.trace(a,s,{color:pv.color.uniform("white")});break;case"lines":pv_viewer.lines(a,s,{color:pv.color.uniform("white")});break;case"ballAndstick":pv_viewer.ballsAndSticks(a,s,{color:pv.color.uniform("white")})}}}}function normalize(e){var t=[],n=e[0],i=e[1],a=e[2],n=n*n+i*i+a*a;return 0<n&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross(e,t){var n=[],i=e[0],a=e[1],e=e[2],s=t[0],r=t[1],t=t[2];return n[0]=a*t-e*r,n[1]=e*s-i*t,n[2]=i*r-a*s,n}function distance(e,t){var n=t[0]-e[0],i=t[1]-e[1],t=t[2]-e[2];return Math.sqrt(n*n+i*i+t*t)}function showMembrane(n,r){var o=membraneData[n];if(o){let e=null;if(0<$("#pv:visible",currentWin.document).length){if(!pv_viewer.get(n))return;if(e="pv",!r)return pv_viewer.hide(n+".membrane"),void pv_viewer.requestRedraw();if(pv_viewer.get(n+".membrane"))return pv_viewer.show(n+".membrane"),void pv_viewer.requestRedraw()}if(0<$("#ngl:visible",currentWin.document).length){if(e="ngl",!getNGLComponentByName(n))return;var l=getNGLComponentByName(n+".membrane");if(l)return void l.setVisibility(r);if(!r)return}let t=[0,1,0];1<=dot(o.axis,t)&&(t=[0,0,1]),plane_x=normalize(cross(o.axis,t)),plane_y=normalize(cross(o.axis,plane_x));var h=[],c=[];let i=[];"pv"==e?pv_viewer.get(n).structure().eachAtom(function(e){"CA"==e.name()&&i.push(e.pos())}):"ngl"==e&&getNGLComponentByName(n).structure.eachResidue(function(e){e.eachAtom(function(e){"CA"==e.atomname&&i.push([e.x,e.y,e.z])})});var u=[];let a="",s=1;var d=1.5,p=o.radius/2+24;for(let n=-p;n<p;n+=d)for(let t=-p;t<p;t+=d)if(!(distance(pos=[o.plane_one_center[0]+n*d*plane_x[0]+t*d*plane_y[0],o.plane_one_center[1]+n*d*plane_x[1]+t*d*plane_y[1],o.plane_one_center[2]+n*d*plane_x[2]+t*d*plane_y[2]],o.plane_one_center)>o.radius+8)){pos2=[o.plane_two_center[0]+n*d*plane_x[0]+t*d*plane_y[0],o.plane_two_center[1]+n*d*plane_x[1]+t*d*plane_y[1],o.plane_two_center[2]+n*d*plane_x[2]+t*d*plane_y[2]];let e=0;for(;e<i.length;)distance(pos,i[e])<5?h.push(i.splice(e,1)[0]):distance(pos2,i[e])<5?c.push(i.splice(e,1)[0]):e++;u.push([pos,pos2])}for(let i=0;i<u.length;i++){let n=h,e=0;do{let t=!1;var g=u[i][e++];for(let e=0;e<n.length;e++)if(distance(g,n[e])<5){t=!0;break}t||(a+="ATOM  "+("     "+s++).slice(-5)+"   -  MEM M   1    "+("        "+g[0].toFixed(3)).slice(-8)+("        "+g[1].toFixed(3)).slice(-8)+("        "+g[2].toFixed(3)).slice(-8)+"  1.00  0.00    \n"),n=c}while(e<2)}if(a+="END","pv"==e)pv_viewer.points(n+".membrane",pv.io.pdb(a),{color:pv.color.uniform("#8b8b8b"),pointSize:2}),o.viewTransform&&pv_viewer.setRotation(o.viewTransform);else if("ngl"==e){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(n+".membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);membraneData[n].viewTransform&&ngl_stage.viewerControls.orient(membraneData[n].viewTransform),schemeId=NGL.ColormakerRegistry.addScheme(function(e){this.atomColor=function(){return 9868950}},n+".membrane");l=new Blob([a],{type:"text/plain"});ngl_stage.loadFile(l,{ext:"pdb"}).then(function(e){e.setName(n+".membrane"),e.addRepresentation("point",{name:n+".membrane",pointSize:2,useTexture:!0,forceTransparent:!0,edgeBleach:.6,color:schemeId}),membraneData[n].viewTransform&&ngl_stage.viewerControls.spin([0,1,0],Math.PI),ngl_stage.autoView()})}}}function fetchBFactorsPV(i,e,a,s){let r=0,o=0;return e.eachChain(function(e){(chn=e.name()).match(/(_|-)/)||(chainMapping.structures[i]||(chainMapping.structures[i]={}),chainMapping.structures[i][chn]||(chainMapping.structures[i][chn]=[]),e.eachResidue(function(e){if(e.isAminoacid()||e.isNucleotide()){let t=0,n=0;e.eachAtom(function(e){t+=e.tempFactor(),n++}),r+=t/n,o++,chainMapping.structures[i][chn][e.num()]||(chainMapping.structures[i][chn][e.num()]={}),s&&!chainMapping.structures[i].invalidMapping&&chainMapping.structures[i][chn][e.num()].resname&&residueProperties[chainMapping.structures[i][chn][e.num()].resname].triplet!=e.name()&&(chainMapping.structures[i].invalidMapping=!0),chainMapping.structures[i][chn][e.num()][a]=t/n}}))}),"bfactor"==a&&setBFactorRange(i),0<r?r/o:0}function fetchSecStrucPV(t,e){return e.eachResidue(function(e){(chn=e.chain().name()).match(/(_|-)/)||(chainMapping.structures[t]||(chainMapping.structures[t]={}),chainMapping.structures[t][chn]||(chainMapping.structures[t][chn]=[]),chainMapping.structures[t][chn][e.num()]||(chainMapping.structures[t][chn][e.num()]={}),chainMapping.structures[t][chn][e.num()].ss=e.ss())}),!0}function midpoint1d(e,t,n){return e+(t-e)*n}function midpoint3d(e,t,n){return[midpoint1d(e[0],t[0],n),midpoint1d(e[1],t[1],n),midpoint1d(e[2],t[2],n)]}function showWaterPV(){pv_viewer.ballsAndSticks("water",pv_viewer.get("template").structure().select({rnames:["HOH"]}))}function showWaterNGL(){log.console("showWaterNGL not implemented")}function showWater(){0<$("#pv:visible",currentWin.document).length&&showWaterPV(),0<$("#ngl:visible",currentWin.document).length&&showWaterNGL()}function toggleBond(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_bonds.getBondById(e,t).toggle(),deHighlightBond(e,t,!0))}function highlightBond(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&plip_bonds.getBondById(e,t).highlight()}function deHighlightBond(e,t,n){PLIP.AbstractViewer.isStructureEnabled(e)&&(null==n&&(n=!0),plip_bonds.getBondById(e,t).dehighlight(!0,n))}function highlightBonds(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_bonds.getBondsById(e,t).forEach(function(e){e.highlight(!1)}),plip_residues.redraw(e))}function deHighlightBonds(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_bonds.getBondsById(e,t).forEach(function(e){e.dehighlight(!1)}),plip_residues.redraw(e))}function clickBonds(e,t,n){toggleBonds(e,t,n),$("#plip_bonds_"+n).prop("checked")&&fitToBonds(e,t,n)}function toggleBonds(e,t,n){var n=$("#plip_bonds_"+n),i=n.prop("checked");n.prop("checked",!i),n.trigger("change")}function changeBondsCheckbox(e,t,n){var i=$("#plip_bonds_"+n),a=i.prop("checked");PLIP.AbstractViewer.isStructureEnabled(e)?(plip_bonds.getBondsById(e,t).forEach(function(e){a?e.show(!1):e.hide(!1),e.dehighlight(!1,!0)}),plip_residues.redraw(e),a&&plip_interactions_fit_bonds&&fitToBonds(e,t,n)):i.prop("checked",!1)}function showBonds(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_bonds.getBondsById(e,t).forEach(function(e){e.show(!1),e.dehighlight(!1,!0)}),plip_residues.redraw(e))}function hideBonds(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_bonds.getBondsById(e,t).forEach(function(e){e.hide(!1),e.dehighlight(!1,!0)}),plip_residues.redraw(e))}function fitToBond(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&plip_bonds.getBondById(e,t).fitView()}function fitToResidue(e,t,n){PLIP.AbstractViewer.isStructureEnabled(e)&&(residue=plip_residues.getResidue(e,t),n?(ligand=all_ligands.getLigandById(e,n),PLIP.AbstractViewer.fitView(e,[ligand],[residue])):PLIP.AbstractViewer.fitView(e,null,[residue]))}function fitToBonds(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&plip_bonds.fitViewBonds(e,t)}function showResidues(e,t,n){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_residues.getResiduesByResId(e,t).forEach(function(e){e.show(!1)}),plip_residues.redraw(e))}function hideResidues(e,t,n){PLIP.AbstractViewer.isStructureEnabled(e)&&(plip_residues.getResiduesByResId(e,t).forEach(function(e){e.hide(!1)}),plip_residues.redraw(e))}function showLigands(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(all_ligands.getLigandsById(e,t).forEach(function(e){e.show(!1,!0)}),all_ligands.redraw(e))}function hideLigands(e,t){PLIP.AbstractViewer.isStructureEnabled(e)&&(all_ligands.getLigandsById(e,t).forEach(function(e){e.hide(!1,null,!0)}),all_ligands.redraw(e))}function togglePLIPLigandContacts(e,t,n){($("#togglePLIPLigandContacts_"+e).hasClass("glyphicon-chevron-down")?showPLIPLigandContacts:hidePLIPLigandContacts)(e,t,n)}function showPLIPLigandContacts(e,t,n){$("#PLIPligandContacts_"+e).show(100),setTimeout(function(){$("#togglePLIPLigandContacts_"+e).addClass("glyphicon-chevron-up").removeClass("glyphicon-chevron-down")},100),void 0!==n&&(showBonds(t,n),fitToBonds(t,n))}function hidePLIPLigandContacts(e,t,n){$("#PLIPligandContacts_"+e).hide(100),setTimeout(function(){$("#togglePLIPLigandContacts_"+e).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up")},100),void 0!==n&&hideBonds(t,n)}document.getElementById("pv")&&(document.getElementById("pv").addEventListener("mousemove",function(e){doPVMouse(e)}),document.getElementById("pv").addEventListener("click",function(e){doPVMouse(e)})),PLIP.Bonds=function(){var i={};this.hasStruc=function(e){return e in i},this.removeStruc=function(e){e in i&&delete i[e]},this.addStruc=function(e){this.hasStruc(e)||(i[e]=[])},this.listStruc=function(){return Object.keys(i)},this.listVisible=function(e){if(this.hasStruc(e))return i[e].filter(function(e){return e.isVisible()});console.error("listVisible: no strucId "+e)},this.getBondById=function(e,t){if(e in i)return i[e].find(function(e){return e.id===t});console.error("getBondById: no strucId "+e),console.trace()},this.getBondsById=function(e,t){if(e in i)return i[e].filter(function(e){return t.includes(e.id)});console.error("getBondsById: no strucId "+e)},this.add=function(e){this.addStruc(e.strucId),i[e.strucId].push(e)};this.showAll=function(e){for(var t=i[e],n=0;n<t.length;n++)t[n].isVisible()||t[n].show(!1);plip_residues.redraw(e)},this.hideAll=function(e){for(var t=i[e],n=0;n<t.length;n++)t[n].isVisible()&&t[n].hide(!1);plip_residues.redraw(e)},this.fitViewBonds=function(e,t){var t=this.getBondsById(e,t),n=t.map(function(e){return e.ligand}).filter(function(e,t,n){return n.indexOf(e)==t}),t=t.map(function(e){return e.residue}).filter(function(e,t,n){return n.indexOf(e)==t});PLIP.AbstractViewer.fitView(e,n,t)},this.refresh=function(e){for(var t=0;t<i[e].length;t++)i[e][t].refresh()},this.refreshAll=function(){for(var e in i)PLIP.AbstractViewer.isStructureEnabled(e)&&this.refresh(e)}},PLIP.Bond=function(e,t,n,i,a,s,r,o,l){var h=!1,c=!1,u=void 0,d="LigandBond"+e,p=void 0,g="LigandBondHighlight"+e;this.show=function(e){null==e&&(e=!0),this.isVisible()?console.info("Bond already visible"):PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(this.draw(),void 0!==this.residue&&this.residue.show(!1),this.ligand.show(e),h=!0,e)&&pv_viewer.requestRedraw()},this.hide=function(e){null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&this.isVisible()&&(this.destroy(),h=!1,void 0!==this.residue&&this.residue.hide(!1),this.ligand.hide(e),e)&&pv_viewer.requestRedraw()},this.draw=function(){null==this.coo3?PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo1,this.coo2,plip_bond_num_dash,plip_bond_radius,this.color,!0):(PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo1,this.coo3,plip_bond_num_dash,plip_bond_radius,this.color,!1),PLIP.AbstractViewer.addBondLine(this.getBondMesh(),this.coo2,this.coo3,plip_bond_num_dash,plip_bond_radius,this.color,!1),PLIP.AbstractViewer.addWaterCircle(this.getBondMesh(),this.coo3,2*plip_bond_radius,this.color,!0))},this.destroy=function(){u=PLIP.AbstractViewer.removeMesh(d)},this.refresh=function(){this.destroy(),this.isVisible()&&this.draw(),this.destroyHighlight(),this.isHighlighted()&&this.drawHighlight()},this.toggle=function(){this.isVisible()?this.hide():this.show()},this.isVisible=function(){return h},this.getBondMesh=function(){return u=null==u?PLIP.AbstractViewer.newBondMesh(d):u},this.highlight=function(e){null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&!this.isHighlighted()&&(this.drawHighlight(),void 0!==this.residue&&this.residue.show(!1),this.ligand.show(e),c=!0)},this.drawHighlight=function(){null==this.coo3?PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo1,this.coo2,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!0):(PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo1,this.coo3,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!1),PLIP.AbstractViewer.addBondLine(this.getBondMeshHighlight(),this.coo2,this.coo3,plip_higlight_bond_num_dash,plip_bond_radius*plip_higlight_factor,this.color,!1),PLIP.AbstractViewer.addWaterCircle(this.getBondMeshHighlight(),this.coo3,plip_bond_radius*plip_higlight_factor*2,this.color,!0))},this.destroyHighlight=function(){p=PLIP.AbstractViewer.removeMesh(g)},this.dehighlight=function(e){null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&this.isHighlighted()&&this.isHighlighted()&&(this.destroyHighlight(),void 0!==this.residue&&this.residue.hide(!1),this.ligand.hide(e),c=!1,e)&&pv_viewer.requestRedraw()},this.toggleHighlight=function(){this.isHighlighted()?this.dehighlight():this.highlight()},this.isHighlighted=function(){return c},this.getBondMeshHighlight=function(){return p=null==p?PLIP.AbstractViewer.newBondMesh(g):p},this.fitView=function(){PLIP.AbstractViewer.fitView(this.strucId,[this.ligand],[this.residue])},this.getLigand=function(){return this.ligand},this.residue=plip_residues.addResidue(t,o[0],o[1],o[2]),this.residue.addBond(this),this.id=e,this.strucId=t,this.ligand=n,this.coo1=i,this.coo2=a,this.coo3=s,this.color=r,l&&this.show()},PLIP.makeResidueId=function(e,t,n){return e+":"+t+n},PLIP.Residue=function(e,t,n,i){var a=0,s=[];this.show=function(e){null==e&&(e=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&0<++a&&e&&plip_residues.redraw(this.strucId)},this.hide=function(e,t){null==e&&(e=!0),null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(t?a=Math.max(a-1,0):alert("Did not decrement counter! "+this.id+": "+a),0==a)&&e&&plip_residues.redraw(this.strucId)},this.isVisible=function(){return 0<a},this.getOldResId=function(){return this.chain+this.position},this.addBond=function(e){s.push(e)},this.getBonds=function(){return s},this.strucId=e,this.id=PLIP.makeResidueId(t,n,i),this.chain=t,this.one_letter=n,this.position=i},PLIP.Residues=function(){var n={};this.hasStruc=function(e){return e in n},this.removeStruc=function(e){e in n&&delete n[e]},this.addStruc=function(e){this.hasStruc(e)||(n[e]=[])},this.listStruc=function(){return Object.keys(n)},this.getStruc=function(e){if(e in n)return n[e];void 0===e?console.error("StrucId is undefined"):console.error("No such strucId: '"+e+"'"),console.trace()},this.addResidue=function(e,t,n,i){this.addStruc(e);var a=PLIP.makeResidueId(t,n,i),a=this.getResidue(e,a);return void 0===a&&(a=new PLIP.Residue(e,t,n,i),this.getStruc(e).push(a)),a},this.getResidue=function(e,t){if(e in n)return this.getStruc(e).find(function(e){return e.id==t})},this.getResidueByOldResId=function(e,t){if(e in n)return this.getStruc(e).find(function(e){return e.getOldResId()==t})},this.getResiduesByResId=function(e,t){if(e in n)return n[e].filter(function(e){return t.includes(e.id)})},this.getVisibleResidues=function(e){return this.hasStruc(e)?this.getStruc(e).filter(function(e){return e.isVisible()}):[]},this.getVisibleResiduesResId=function(e){return this.getVisibleResidues(e).map(function(e){return e.getOldResId()})},this.redraw=function(e){highlightLigand(all_ligands.getVisibleLigandIds(e),this.getVisibleResiduesResId(e),e),pv_viewer.requestRedraw()},this.redrawAll=function(){for(var e in n)PLIP.AbstractViewer.isStructureEnabled(e)&&this.redraw(e)}},PLIP.Ligands=function(){var n={};this.hasStruc=function(e){return e in n},this.removeStruc=function(e){this.hasStruc(e)&&delete n[e]},this.addStruc=function(e){this.hasStruc(e)||(n[e]=[])},this.listStruc=function(){return Object.keys(n)},this.getStruc=function(e){if(this.hasStruc(e))return n[e];void 0===e?console.error("StrucId "+e+" is undefined"):console.error("No such strucId: '"+e+"'"),console.trace()},this.getLigandById=function(e,t){if(this.hasStruc(e))return n[e].find(function(e){return e.id===t});console.error("getLigandById: no strucId "+e),console.trace()},this.getLigandsById=function(e,t){if(this.hasStruc(e))return n[e].filter(function(e){return t.includes(e.id)});console.error("getLigandsById: no strucId "+e)},this.addLigand=function(e,t){this.addStruc(e);var n=this.getLigandById(e,t);return void 0===n&&(n=new PLIP.Ligand(e,t),this.getStruc(e).push(n)),n},this.getVisibleLigands=function(e){return this.hasStruc(e)?this.getStruc(e).filter(function(e){return e.isVisible()}):[]},this.getVisibleLigandIds=function(e){return this.getVisibleLigands(e).map(function(e){return e.getLigandId()})},this.redraw=function(e){highlightLigand(this.getVisibleLigandIds(e),plip_residues.getVisibleResiduesResId(e),e),pv_viewer.requestRedraw()},this.redrawAll=function(){for(var e in n)PLIP.AbstractViewer.isStructureEnabled(e)&&this.redraw(e)}},PLIP.Ligand=function(e,t){var i=0,a=[],n=[];this.show=function(e,t){null==e&&(e=!0),null==t&&(t=!1),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(i++,t&&a.forEach(function(e){e.show(!1)}),0<i)&&e&&all_ligands.redraw(this.strucId)},this.hide=function(e,t,n){null==e&&(e=!0),null==n&&(n=!1),null==t&&(t=!0),PLIP.AbstractViewer.isStructureEnabled(this.strucId)&&(t?i=Math.max(i-1,0):alert("Did not decrement counter! "+this.id+": "+i),n&&a.forEach(function(e){e.hide(!1)}),0==i)&&e&&all_ligands.redraw(this.strucId)},this.addResidue=function(e){-1==a.indexOf(e)&&a.push(e)},this.addBond=function(e){-1==n.indexOf(e)&&n.push(e)},this.isVisible=function(){return 0<i},this.getLigandId=function(){return this.id},this.getResidues=function(){return a},this.strucId=e,this.id=t,this.position=t},PLIP.AbstractViewerPV={newBondMesh:function(e){return pv_viewer.customMesh(e)},addWaterCircle:function(e,t,n,i,a){e.addSphere(t,n,{cap:!0,color:i})},addBondLine:function(e,t,n,i,a,s,r){for(var o=1;o<=i;o++)e.addTube(midpoint3d(t,n,(2*o-2)/(2*i-1)),midpoint3d(t,n,(2*o-1)/(2*i-1)),a,{cap:!0,color:s})},removeMesh:function(e){pv_viewer.rm(e)},fitView:function(e,i,t){var a,s;this.isStructureEnabled(e)&&(a=t.map(function(e){return void 0===e?null:e.chain}),s=t.map(function(e){return void 0===e?null:e.position}),a.length!=s.length&&console.error("queryResidue -Chains and -Positions array lengths don't match: "+a.length+" != "+s.length),t=pv_viewer.get(e).structure().residueSelect(function(e){var t=e.chain().name();if("_"===t){if(!i)return!1;if((ligand_positions=i.map(function(e){return e.position})).includes(e.num()))return!0}for(var n=0;n<a.length;n++)if(a[n]===t&&s[n]===e.num())return!0;return!1}),pv_viewer.fitTo(t),pv_viewer.requestRedraw())},isStructureEnabled:function(e){return!!pv_viewer.get(e)}},PLIP.AbstractViewerNGL={newBondMesh:function(e){return new NGL.Shape(e,{disableImpostor:!0})},addWaterCircle:function(e,t,n,i,a){e.addEllipsoid(t,i,n,[n,0,0],[0,n,0]),a&&ngl_stage.addComponentFromObject(e).addRepresentation("buffer")},addBondLine:function(e,t,n,i,a,s,r){for(var o=1;o<=i;o++)e.addCylinder(midpoint3d(t,n,(2*o-2)/(2*i-1)),midpoint3d(t,n,(2*o-1)/(2*i-1)),s,a);r&&ngl_stage.addComponentFromObject(e).addRepresentation("buffer")},removeMesh:function(e){removeNGLComponentByName(e)},fitView:function(e,t,n){if(this.isStructureEnabled(e)){var i="";if(t&&(i+="(("+(ligand_positions=t.map(function(e){return e.position})).join(" or ")+") and :_)"),void 0!==n[0]){var a,s={};for(a in n){var r,o=n[a];"-"!=(r=o.chain)&&(o=o.position,s[r]?s[r].push(o):s[r]=[o])}for(r in s)""!=i&&(i+=" or "),i+="(("+s[r].join(" or ")+") and :"+r+")"}getNGLComponentByName(e).autoView(i,1e3)}},isStructureEnabled:function(e){return!!getNGLComponentByName(e)}};var plip_interactions_fit_bonds=!0;function togglePlipInteractions(e,t,n){$("#togglePlipInteractions_"+e).hasClass("glyphicon-chevron-down")?($("#togglePlipInteractions_"+e).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("#plipInteractions_"+e).show(),PLIP.AbstractViewer.isStructureEnabled(t)&&(plip_interactions_fit_bonds=!1,$.when($("#plipInteractions_"+e+" input").each(function(e,t){$(t).prop("checked",!0).trigger("change")})).done(function(){fitToBonds(t,n)}),plip_interactions_fit_bonds=!0)):($("#togglePlipInteractions_"+e).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up"),$("#plipInteractions_"+e).hide(),$("#plipInteractions_"+e+" input").each(function(e,t){$(t).prop("checked",!1).trigger("change")}))}function changeLigandContacts4Checkbox(e,t,n,i){var i=$("#chainContacts4_"+i),a=i.prop("checked");PLIP.AbstractViewer.isStructureEnabled(e)?(plip_residues.getResiduesByResId(e,n).forEach(function(e){a?e.show(!1):e.hide(!1)}),n=all_ligands.getLigandById(e,t),a?n.show(!0,!1):n.hide(!0,null,!1),plip_residues.redraw(e)):i.prop("checked",!1)}function clickLigandContacts4Checkbox(e,t,n,i){PLIP.AbstractViewer.isStructureEnabled(e)&&($("#chainContacts4_"+i).each(function(e,t){$(t).prop("checked",!$(t).prop("checked")).trigger("change")}),$("#chainContacts4_"+i).prop("checked"))&&PLIP.AbstractViewer.fitView(e,[all_ligands.getLigandById(e,t)],plip_residues.getResiduesByResId(e,n))}function toggleResidueContacts(e,t,n){$("#toggleResidueContacts4_"+e).hasClass("glyphicon-chevron-down")?($("#toggleResidueContacts4_"+e).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("#residueContacts4_"+e).show(),PLIP.AbstractViewer.isStructureEnabled(n)&&($("#residueContacts4_"+e+" input").each(function(e,t){$(t).prop("checked",!0).trigger("change")}),ligand=all_ligands.getLigandById(n,t),PLIP.AbstractViewer.fitView(n,[ligand],ligand.getResidues()))):($("#toggleResidueContacts4_"+e).removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$("#residueContacts4_"+e).hide(),PLIP.AbstractViewer.isStructureEnabled(n)&&$("#residueContacts4_"+e+" input").each(function(e,t){$(t).prop("checked",!1).trigger("change")})),updatecols()}function toggleLigandGroup(e,t,n){$("#toggleLigandGroup_"+e).hasClass("glyphicon-chevron-down")?($("#toggleLigandGroup_"+e).addClass("glyphicon-chevron-up").removeClass("glyphicon-chevron-down"),$("#ligandGroup_"+e).show(),centerOnLigand(t,n)):($("#toggleLigandGroup_"+e).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up"),$("#ligandGroup_"+e+" .glyphicon-chevron-up").each(function(e,t){$(t).trigger("click")}),$("#ligandGroup_"+e).hide()),updatecols()}function toggleAllLigands(e){$("#toggleAllLink").hasClass("glyphicon-chevron-down")?($("#toggleAllLink,span[id^=toggleLigandGroup_]").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$("div[id^=ligandGroup_]").show()):($("#toggleAllLink,span[id^=toggleLigandGroup_]").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$("div[id^=ligandGroup_]").hide())}function RGBColor(e){this.ok=!1,e=(e=(e="#"==e.charAt(0)?e.substr(1,6):e).replace(/ /g,"")).toLowerCase();var t,c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(t in c)e==t&&(e=c[t]);for(var u=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],n=0;n<u.length;n++){var i=u[n].re,a=u[n].process,i=i.exec(e);i&&(channels=a(i),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return"#"+(e=1==e.length?"0"+e:e)+(t=1==t.length?"0"+t:t)+(n=1==n.length?"0"+n:n)},this.getHelpXML=function(){for(var e,t=new Array,n=0;n<u.length;n++)for(var i=u[n].example,a=0;a<i.length;a++)t[t.length]=i[a];for(e in c)t[t.length]=e;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(n=0;n<t.length;n++)try{var r=document.createElement("li"),o=new RGBColor(t[n]),l=document.createElement("div"),h=(l.style.cssText="margin: 3px; border: 1px solid black; background:"+o.toHex()+"; color:"+o.toHex(),l.appendChild(document.createTextNode("test")),document.createTextNode(" "+t[n]+" -> "+o.toRGB()+" -> "+o.toHex()));r.appendChild(l),r.appendChild(h),s.appendChild(r)}catch(e){}return s}}!function(){this.canvg=function(e,t,n){if(null==e&&null==t&&null==n)for(var a=document.querySelectorAll("svg"),s=0;s<a.length;s++){var r=a[s],o=document.createElement("canvas"),l=(o.width=r.clientWidth,o.height=r.clientHeight,r.parentNode.insertBefore(o,r),r.parentNode.removeChild(r),document.createElement("div"));l.appendChild(r),canvg(o,l.innerHTML)}else{null!=(e="string"==typeof e?document.getElementById(e):e).svg&&e.svg.stop();n=function(e){var C={opts:e,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,log:function(e){}};1==C.opts.log&&"undefined"!=typeof console&&(C.log=function(e){console.log(e)});C.init=function(e){var t=0;C.UniqueId=function(){return"canvg"+ ++t},C.Definitions={},C.Styles={},C.StylesSpecificity={},C.Animations=[],C.Images=[],C.ctx=e,C.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},C.init(),C.ImagesLoaded=function(){for(var e=0;e<C.Images.length;e++)if(!C.Images[e].loaded)return!1;return!0},C.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},C.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},C.ajax=function(e){var t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return t?(t.open("GET",e,!1),t.send(null),t.responseText):null},C.parseXml=function(e){var t,n;return"undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml?(n=new Windows.Data.Xml.Dom.XmlDocument,(t=new Windows.Data.Xml.Dom.XmlLoadSettings).prohibitDtd=!1,n.loadXml(e,t),n):window.DOMParser?(new DOMParser).parseFromString(e,"text/xml"):(e=e.replace(/<!DOCTYPE svg[^>]*>/,""),(n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(e),n)},C.Property=function(e,t){this.name=e,this.value=t},C.Property.prototype.getValue=function(){return this.value},C.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},C.Property.prototype.numValue=function(){var e;return this.hasValue()?(e=parseFloat(this.value),(this.value+"").match(/%$/)&&(e/=100),e):0},C.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},C.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},C.Property.prototype.addOpacity=function(e){var t,n=this.value;return null!=e.value&&""!=e.value&&"string"==typeof this.value&&(t=new RGBColor(this.value)).ok&&(n="rgba("+t.r+", "+t.g+", "+t.b+", "+e.numValue()+")"),new C.Property(this.name,n)},C.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e=(e=e&&e[1])||this.value,C.Definitions[e]},C.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},C.Property.prototype.getFillStyleDefinition=function(e,t){var n=this.getDefinition();return null!=n&&n.createGradient?n.createGradient(C.ctx,e,t):null!=n&&n.createPattern?(n.getHrefAttribute().hasValue()&&(t=n.attribute("patternTransform"),n=n.getHrefAttribute().getDefinition(),t.hasValue())&&(n.attribute("patternTransform",!0).value=t.value),n.createPattern(C.ctx,e)):null},C.Property.prototype.getDPI=function(e){return 96},C.Property.prototype.getEM=function(e){var t=12,n=new C.Property("fontSize",C.Font.Parse(C.ctx.font).fontSize);return t=n.hasValue()?n.toPixels(e):t},C.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},C.Property.prototype.toPixels=function(e,t){var n;return this.hasValue()?(n=this.value+"").match(/em$/)?this.numValue()*this.getEM(e):n.match(/ex$/)?this.numValue()*this.getEM(e)/2:n.match(/px$/)?this.numValue():n.match(/pt$/)?this.numValue()*this.getDPI(e)*(1/72):n.match(/pc$/)?15*this.numValue():n.match(/cm$/)?this.numValue()*this.getDPI(e)/2.54:n.match(/mm$/)?this.numValue()*this.getDPI(e)/25.4:n.match(/in$/)?this.numValue()*this.getDPI(e):n.match(/%$/)?this.numValue()*C.ViewPort.ComputeSize(e):(n=this.numValue(),t&&n<1?n*C.ViewPort.ComputeSize(e):n):0},C.Property.prototype.toMilliseconds=function(){var e;return this.hasValue()?(e=this.value+"").match(/s$/)?1e3*this.numValue():(e.match(/ms$/),this.numValue()):0},C.Property.prototype.toRadians=function(){var e;return this.hasValue()?(e=this.value+"").match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180):0};var t={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return C.Property.prototype.toTextBaseline=function(){return this.hasValue()?t[this.value]:null},C.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,t,n,i,a,s){s=null!=s?this.Parse(s):this.CreateFont("","","","","",C.ctx.font);return{fontFamily:a||s.fontFamily,fontSize:i||s.fontSize,fontStyle:e||s.fontStyle,fontWeight:n||s.fontWeight,fontVariant:t||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(e){for(var t={},n=C.trim(C.compressSpaces(e||"")).split(" "),i={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<n.length;s++)i.fontStyle||-1==r.Styles.indexOf(n[s])?i.fontVariant||-1==r.Variants.indexOf(n[s])?i.fontWeight||-1==r.Weights.indexOf(n[s])?i.fontSize?"inherit"!=n[s]&&(a+=n[s]):("inherit"!=n[s]&&(t.fontSize=n[s].split("/")[0]),i.fontStyle=i.fontVariant=i.fontWeight=i.fontSize=!0):("inherit"!=n[s]&&(t.fontWeight=n[s]),i.fontStyle=i.fontVariant=i.fontWeight=!0):("inherit"!=n[s]&&(t.fontVariant=n[s]),i.fontStyle=i.fontVariant=!0):("inherit"!=n[s]&&(t.fontStyle=n[s]),i.fontStyle=!0);return""!=a&&(t.fontFamily=a),t}},C.ToNumberArray=function(e){for(var t=C.trim(C.compressSpaces((e||"").replace(/,/g," "))).split(" "),n=0;n<t.length;n++)t[n]=parseFloat(t[n]);return t},C.Point=function(e,t){this.x=e,this.y=t},C.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},C.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],e=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=e},C.CreatePoint=function(e){e=C.ToNumberArray(e);return new C.Point(e[0],e[1])},C.CreatePath=function(e){for(var t=C.ToNumberArray(e),n=[],i=0;i<t.length;i+=2)n.push(new C.Point(t[i],t[i+1]));return n},C.BoundingBox=function(e,t,n,a){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2)&&(this.x2=e),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2)&&(this.y2=t)},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,i,a,s){n=e+2/3*(n-e),i=t+2/3*(i-t);this.addBezierCurve(e,t,n,n+1/3*(a-e),i,i+1/3*(s-t),a,s)},this.addBezierCurve=function(e,t,n,a,s,r,o,l){var h=[e,t],c=[n,a],u=[s,r],d=[o,l];for(this.addPoint(h[0],h[1]),this.addPoint(d[0],d[1]),i=0;i<=1;i++){function p(e){return Math.pow(1-e,3)*h[i]+3*Math.pow(1-e,2)*e*c[i]+3*(1-e)*Math.pow(e,2)*u[i]+Math.pow(e,3)*d[i]}var g,f=6*h[i]-12*c[i]+6*u[i],m=-3*h[i]+9*c[i]-9*u[i]+3*d[i],v=3*c[i]-3*h[i];0==m?0!=f&&(0<(g=-v/f)&&g<1&&(0==i&&this.addX(p(g)),1==i))&&this.addY(p(g)):(g=Math.pow(f,2)-4*v*m)<0||(0<(v=(-f+Math.sqrt(g))/(2*m))&&v<1&&(0==i&&this.addX(p(v)),1==i)&&this.addY(p(v)),0<(v=(-f-Math.sqrt(g))/(2*m))&&v<1&&(0==i&&this.addX(p(v)),1==i)&&this.addY(p(v)))}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,a)},C.Transform=function(e){for(var t=this,n=(this.Type={},this.Type.translate=function(e){this.p=C.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){e=C.ToNumberArray(e);this.angle=new C.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=C.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=C.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(e){var t=this.m[0],n=this.m[2],i=this.m[4],a=this.m[1],s=this.m[3],r=this.m[5],o=1/(t*(+s-0*r)-n*(+a-0*r)+i*(0*a-0*s));e.transform(o*(+s-0*r),o*(0*r-+a),o*(0*i-+n),o*(+t-0*i),o*(n*r-i*s),o*(i*a-t*r))},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=t.Type.matrix,this.base(e),this.angle=new C.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;0<=t;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)},C.trim(C.compressSpaces(e)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)),i=0;i<n.length;i++){var a=C.trim(n[i].split("(")[0]),s=n[i].split("(")[1].replace(")",""),s=new this.Type[a](s);s.type=a,this.transforms.push(s)}},C.AspectRatio=function(e,t,n,i,a,s,r,o,l,h){var c=(t=(t=C.compressSpaces(t)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",t=t.split(" ")[1]||"meet",u=n/i,d=a/s,p=Math.min(u,d),g=Math.max(u,d);"meet"==t&&(i*=p,s*=p),"slice"==t&&(i*=g,s*=g),l=new C.Property("refX",l),h=new C.Property("refY",h),l.hasValue()&&h.hasValue()?e.translate(-p*l.toPixels("x"),-p*h.toPixels("y")):(c.match(/^xMid/)&&("meet"==t&&p==d||"slice"==t&&g==d)&&e.translate(n/2-i/2,0),c.match(/YMid$/)&&("meet"==t&&p==u||"slice"==t&&g==u)&&e.translate(0,a/2-s/2),c.match(/^xMax/)&&("meet"==t&&p==d||"slice"==t&&g==d)&&e.translate(n-i,0),c.match(/YMax$/)&&("meet"==t&&p==u||"slice"==t&&g==u)&&e.translate(0,a-s)),"none"==c?e.scale(u,d):"meet"==t?e.scale(p,p):"slice"==t&&e.scale(g,g),e.translate(null==r?0:-r,null==o?0:-o)},C.Element={},C.EmptyProperty=new C.Property("EMPTY",""),C.Element.ElementBase=function(s){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(e,t){var n=this.attributes[e];return null!=n?n:(1==t&&(n=new C.Property(e,""),this.attributes[e]=n),n||C.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if("href"==e||e.match(/:href$/))return this.attributes[e];return C.EmptyProperty},this.style=function(e,t,n){var i=this.styles[e];if(null!=i)return i;var a=this.attribute(e);if(null!=a&&a.hasValue())return this.styles[e]=a;if(1!=n){a=this.parent;if(null!=a){n=a.style(e);if(null!=n&&n.hasValue())return n}}return 1==t&&(i=new C.Property(e,""),this.styles[e]=i),i||C.EmptyProperty},this.render=function(e){var t;"none"!=this.style("display").value&&"hidden"!=this.style("visibility").value&&(e.save(),this.attribute("mask").hasValue()?null!=(t=this.attribute("mask").getDefinition())&&t.apply(e,this):this.style("filter").hasValue()?null!=(t=this.style("filter").getDefinition())&&t.apply(e,this):(this.setContext(e),this.renderChildren(e),this.clearContext(e)),e.restore())},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(e,t){var n=e;(n=t?C.CreateElement(e):n).parent=this,"title"!=n.type&&this.children.push(n)},this.addStylesFromStyleDefinition=function(){for(var e in C.Styles)if("@"!=e[0]&&h(s,e)){var t=C.Styles[e],n=C.StylesSpecificity[e];if(null!=t)for(var i in t){var a=this.stylesSpecificity[i];(a=void 0===a?"000":a)<n&&(this.styles[i]=t[i],this.stylesSpecificity[i]=n)}}},null!=s&&1==s.nodeType){for(var e=0;e<s.attributes.length;e++){var t=s.attributes[e];this.attributes[t.nodeName]=new C.Property(t.nodeName,t.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var n,i,a=this.attribute("style").value.split(";"),e=0;e<a.length;e++)""!=C.trim(a[e])&&(i=a[e].split(":"),n=C.trim(i[0]),i=C.trim(i[1]),this.styles[n]=new C.Property(n,i));this.attribute("id").hasValue()&&null==C.Definitions[this.attribute("id").value]&&(C.Definitions[this.attribute("id").value]=this);for(e=0;e<s.childNodes.length;e++){var r,o=s.childNodes[e];1==o.nodeType&&this.addChild(o,!0),!this.captureTextNodes||3!=o.nodeType&&4!=o.nodeType||(r=o.value||o.text||o.textContent||"",""!=C.compressSpaces(r)&&this.addChild(new C.Element.tspan(o),!1))}}},C.Element.RenderedElementBase=function(e){this.base=C.Element.ElementBase,this.base(e),this.setContext=function(e){var t,n,i;this.style("fill").isUrlDefinition()?null!=(t=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(e.fillStyle=t):this.style("fill").hasValue()&&("currentColor"==(i=this.style("fill")).value&&(i.value=this.style("color").value),"inherit"!=i.value)&&(e.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value),this.style("fill-opacity").hasValue()&&(i=(i=new C.Property("fill",e.fillStyle)).addOpacity(this.style("fill-opacity")),e.fillStyle=i.value),this.style("stroke").isUrlDefinition()?null!=(t=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(e.strokeStyle=t):this.style("stroke").hasValue()&&("currentColor"==(n=this.style("stroke")).value&&(n.value=this.style("color").value),"inherit"!=n.value)&&(e.strokeStyle="none"==n.value?"rgba(0,0,0,0)":n.value),this.style("stroke-opacity").hasValue()&&(n=(n=new C.Property("stroke",e.strokeStyle)).addOpacity(this.style("stroke-opacity")),e.strokeStyle=n.value),this.style("stroke-width").hasValue()&&(i=this.style("stroke-width").toPixels(),e.lineWidth=0==i?.001:i),this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(t=C.ToNumberArray(this.style("stroke-dasharray").value),void 0!==e.setLineDash?e.setLineDash(t):void 0!==e.webkitLineDash?e.webkitLineDash=t:void 0===e.mozDash||1==t.length&&0==t[0]||(e.mozDash=t),n=this.style("stroke-dashoffset").numValueOrDefault(1),void 0!==e.lineDashOffset?e.lineDashOffset=n:void 0!==e.webkitLineDashOffset?e.webkitLineDashOffset=n:void 0!==e.mozDashOffset&&(e.mozDashOffset=n)),void 0!==e.font&&(e.font=C.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()&&new C.Transform(this.style("transform",!1,!0).value).apply(e),this.attribute("clip-path",!1,!0).hasValue()&&null!=(i=this.attribute("clip-path",!1,!0).getDefinition())&&i.apply(e),this.style("opacity").hasValue()&&(e.globalAlpha=this.style("opacity").numValue())}},C.Element.RenderedElementBase.prototype=new C.Element.ElementBase,C.Element.PathElementBase=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new C.BoundingBox},this.renderChildren=function(e){this.path(e),C.Mouse.checkPath(this,e),""!=e.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?e.fill(this.style("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var t=this.getMarkers();if(null!=t){if(this.style("marker-start").isUrlDefinition()&&(n=this.style("marker-start").getDefinition()).render(e,t[0][0],t[0][1]),this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),i=1;i<t.length-1;i++)n.render(e,t[i][0],t[i][1]);this.style("marker-end").isUrlDefinition()&&(n=this.style("marker-end").getDefinition()).render(e,t[t.length-1][0],t[t.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},C.Element.PathElementBase.prototype=new C.Element.RenderedElementBase,C.Element.svg=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),C.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,void 0!==e.font&&void 0!==window.getComputedStyle&&(e.font=window.getComputedStyle(e.canvas).getPropertyValue("font")),this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var t,n,i,a=C.ViewPort.width(),s=C.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root&&(a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y"),t=n=0,this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(n=-this.attribute("refX").toPixels("x"),t=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden"))&&(e.beginPath(),e.moveTo(n,t),e.lineTo(a,t),e.lineTo(a,s),e.lineTo(n,s),e.closePath(),e.clip()),C.ViewPort.SetCurrent(a,s),this.attribute("viewBox").hasValue()&&(n=(t=C.ToNumberArray(this.attribute("viewBox").value))[0],i=t[1],a=t[2],s=t[3],C.AspectRatio(e,this.attribute("preserveAspectRatio").value,C.ViewPort.width(),a,C.ViewPort.height(),s,n,i,this.attribute("refX").value,this.attribute("refY").value),C.ViewPort.RemoveCurrent(),C.ViewPort.SetCurrent(t[2],t[3]))}},C.Element.svg.prototype=new C.Element.RenderedElementBase,C.Element.rect=function(e){this.base=C.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y"),s=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(r=s),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(s=r),s=Math.min(s,i/2),r=Math.min(r,a/2),null!=e&&(e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+i-s,n),e.quadraticCurveTo(t+i,n,t+i,n+r),e.lineTo(t+i,n+a-r),e.quadraticCurveTo(t+i,n+a,t+i-s,n+a),e.lineTo(t+s,n+a),e.quadraticCurveTo(t,n+a,t,n+a-r),e.lineTo(t,n+r),e.quadraticCurveTo(t,n,t+s,n),e.closePath()),new C.BoundingBox(t,n,t+i,n+a)}},C.Element.rect.prototype=new C.Element.PathElementBase,C.Element.circle=function(e){this.base=C.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(t,n,i,0,2*Math.PI,!0),e.closePath()),new C.BoundingBox(t-i,n-i,t+i,n+i)}},C.Element.circle.prototype=new C.Element.PathElementBase,C.Element.ellipse=function(e){this.base=C.Element.PathElementBase,this.base(e),this.path=function(e){var t=(Math.sqrt(2)-1)/3*4,n=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),a=this.attribute("cx").toPixels("x"),s=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(a,s-i),e.bezierCurveTo(a+t*n,s-i,a+n,s-t*i,a+n,s),e.bezierCurveTo(a+n,s+t*i,a+t*n,s+i,a,s+i),e.bezierCurveTo(a-t*n,s+i,a-n,s+t*i,a-n,s),e.bezierCurveTo(a-n,s-t*i,a-t*n,s-i,a,s-i),e.closePath()),new C.BoundingBox(a-n,s-i,a+n,s+i)}},C.Element.ellipse.prototype=new C.Element.PathElementBase,C.Element.line=function(e){this.base=C.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new C.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new C.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var t=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)),new C.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},C.Element.line.prototype=new C.Element.PathElementBase,C.Element.polyline=function(e){this.base=C.Element.PathElementBase,this.base(e),this.points=C.CreatePath(this.attribute("points").value),this.path=function(e){var t=new C.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)t.addPoint(this.points[n].x,this.points[n].y),null!=e&&e.lineTo(this.points[n].x,this.points[n].y);return t},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},C.Element.polyline.prototype=new C.Element.PathElementBase,C.Element.polygon=function(e){this.base=C.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},C.Element.polygon.prototype=new C.Element.polyline,C.Element.path=function(e){this.base=C.Element.PathElementBase,this.base(e);for(var t=(t=this.attribute("d").value).replace(/,/gm," "),n=0;n<2;n++)t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");t=(t=t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2");for(n=0;n<2;n++)t=t.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");t=t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=C.compressSpaces(t),t=C.trim(t),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new C.Point(0,0),this.control=new C.Point(0,0),this.current=new C.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new C.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new C.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){null!=n&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(t),this.path=function(e){var t=this.PathParser,n=(t.reset(),new C.BoundingBox);for(null!=e&&e.beginPath();!t.isEnd();)switch(t.nextCommand(),t.command){case"M":case"m":var i=t.getAsCurrentPoint();for(t.addMarker(i),n.addPoint(i.x,i.y),null!=e&&e.moveTo(i.x,i.y),t.start=t.current;!t.isCommandOrEnd();){i=t.getAsCurrentPoint();t.addMarker(i,t.start),n.addPoint(i.x,i.y),null!=e&&e.lineTo(i.x,i.y)}break;case"L":case"l":for(;!t.isCommandOrEnd();){var a=t.current,i=t.getAsCurrentPoint();t.addMarker(i,a),n.addPoint(i.x,i.y),null!=e&&e.lineTo(i.x,i.y)}break;case"H":case"h":for(;!t.isCommandOrEnd();){var s=new C.Point((t.isRelativeCommand()?t.current.x:0)+t.getScalar(),t.current.y);t.addMarker(s,t.current),t.current=s,n.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"V":case"v":for(;!t.isCommandOrEnd();){s=new C.Point(t.current.x,(t.isRelativeCommand()?t.current.y:0)+t.getScalar());t.addMarker(s,t.current),t.current=s,n.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"C":case"c":for(;!t.isCommandOrEnd();){var r=t.current,o=t.getPoint(),l=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,l,o),n.addBezierCurve(r.x,r.y,o.x,o.y,l.x,l.y,h.x,h.y),null!=e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,h.x,h.y)}break;case"S":case"s":for(;!t.isCommandOrEnd();){r=t.current,o=t.getReflectedControlPoint(),l=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,l,o),n.addBezierCurve(r.x,r.y,o.x,o.y,l.x,l.y,h.x,h.y),null!=e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,h.x,h.y)}break;case"Q":case"q":for(;!t.isCommandOrEnd();){r=t.current,l=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,l,l),n.addQuadraticCurve(r.x,r.y,l.x,l.y,h.x,h.y),null!=e&&e.quadraticCurveTo(l.x,l.y,h.x,h.y)}break;case"T":case"t":for(;!t.isCommandOrEnd();){r=t.current,l=t.getReflectedControlPoint(),h=(t.control=l,t.getAsCurrentPoint());t.addMarker(h,l,l),n.addQuadraticCurve(r.x,r.y,l.x,l.y,h.x,h.y),null!=e&&e.quadraticCurveTo(l.x,l.y,h.x,h.y)}break;case"A":case"a":for(;!t.isCommandOrEnd();){function c(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(y(e,t))}var r=t.current,u=t.getScalar(),d=t.getScalar(),p=t.getScalar()*(Math.PI/180),g=t.getScalar(),f=t.getScalar(),h=t.getAsCurrentPoint(),m=new C.Point(Math.cos(p)*(r.x-h.x)/2+Math.sin(p)*(r.y-h.y)/2,-Math.sin(p)*(r.x-h.x)/2+Math.cos(p)*(r.y-h.y)/2),v=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(d,2),v=(1<v&&(u*=Math.sqrt(v),d*=Math.sqrt(v)),(g==f?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(d,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(d,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(d,2)*Math.pow(m.x,2)))),g=(isNaN(v)&&(v=0),new C.Point(v*u*m.y/d,v*-d*m.x/u)),v=new C.Point((r.x+h.x)/2+Math.cos(p)*g.x-Math.sin(p)*g.y,(r.y+h.y)/2+Math.sin(p)*g.x+Math.cos(p)*g.y),b=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},y=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(b(e)*b(t))},_=c([1,0],[(m.x-g.x)/u,(m.y-g.y)/d]),w=[(m.x-g.x)/u,(m.y-g.y)/d],m=[(-m.x-g.x)/u,(-m.y-g.y)/d],g=c(w,m),x=(y(w,m)<=-1&&(g=Math.PI),1-f?1:-1),w=_+(g=1<=y(w,m)?0:g)/2*x,m=new C.Point(v.x+u*Math.cos(w),v.y+d*Math.sin(w));t.addMarkerAngle(m,w-x*Math.PI/2),t.addMarkerAngle(h,w-x*Math.PI),n.addPoint(h.x,h.y),null!=e&&(y=d<u?u:d,m=d<u?1:u/d,w=d<u?d/u:1,e.translate(v.x,v.y),e.rotate(p),e.scale(m,w),e.arc(0,0,y,_,_+g,1-f),e.scale(1/m,1/w),e.rotate(-p),e.translate(-v.x,-v.y))}break;case"Z":case"z":null!=e&&e.closePath(),t.current=t.start}return n},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],i=0;i<e.length;i++)n.push([e[i],t[i]]);return n}},C.Element.path.prototype=new C.Element.PathElementBase,C.Element.pattern=function(e){this.base=C.Element.ElementBase,this.base(e),this.createPattern=function(e,t){var n=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),a=new C.Element.svg,s=(a.attributes.viewBox=new C.Property("viewBox",this.attribute("viewBox").value),a.attributes.width=new C.Property("width",n+"px"),a.attributes.height=new C.Property("height",i+"px"),a.attributes.transform=new C.Property("transform",this.attribute("patternTransform").value),a.children=this.children,document.createElement("canvas")),r=(s.width=n,s.height=i,s.getContext("2d"));this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&r.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var o=-1;o<=1;o++)for(var l=-1;l<=1;l++)r.save(),a.attributes.x=new C.Property("x",o*s.width),a.attributes.y=new C.Property("y",l*s.height),a.render(r),r.restore();return e.createPattern(s,"repeat")}},C.Element.pattern.prototype=new C.Element.ElementBase,C.Element.marker=function(e){this.base=C.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,t,n){e.translate(t.x,t.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var i=new C.Element.svg;i.attributes.viewBox=new C.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new C.Property("refX",this.attribute("refX").value),i.attributes.refY=new C.Property("refY",this.attribute("refY").value),i.attributes.width=new C.Property("width",this.attribute("markerWidth").value),i.attributes.height=new C.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new C.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new C.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-n),e.translate(-t.x,-t.y)}},C.Element.marker.prototype=new C.Element.ElementBase,C.Element.defs=function(e){this.base=C.Element.ElementBase,this.base(e),this.render=function(e){}},C.Element.defs.prototype=new C.Element.ElementBase,C.Element.GradientBase=function(e){this.base=C.Element.ElementBase,this.base(e),this.stops=[];for(var t=0;t<this.children.length;t++){var n=this.children[t];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(e){for(var t=0;t<this.attributesToInherit.length;t++){var n=this.attributesToInherit[t];!this.attribute(n).hasValue()&&e.attribute(n).hasValue()&&(this.attribute(n,!0).value=e.attribute(n).value)}},this.createGradient=function(e,t,n){function i(e){return n.hasValue()?new C.Property("color",e).addOpacity(n).value:e}var a=this,s=(this.getHrefAttribute().hasValue()&&(a=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(a)),this.getGradient(e,t));if(null==s)return i(a.stops[a.stops.length-1].color);for(var r,o=0;o<a.stops.length;o++)s.addColorStop(a.stops[o].offset,i(a.stops[o].color));return this.attribute("gradientTransform").hasValue()?(e=C.ViewPort.viewPorts[0],(t=new C.Element.rect).attributes.x=new C.Property("x",-C.MAX_VIRTUAL_PIXELS/3),t.attributes.y=new C.Property("y",-C.MAX_VIRTUAL_PIXELS/3),t.attributes.width=new C.Property("width",C.MAX_VIRTUAL_PIXELS),t.attributes.height=new C.Property("height",C.MAX_VIRTUAL_PIXELS),(r=new C.Element.g).attributes.transform=new C.Property("transform",this.attribute("gradientTransform").value),r.children=[t],(t=new C.Element.svg).attributes.x=new C.Property("x",0),t.attributes.y=new C.Property("y",0),t.attributes.width=new C.Property("width",e.width),t.attributes.height=new C.Property("height",e.height),t.children=[r],(r=document.createElement("canvas")).width=e.width,r.height=e.height,(e=r.getContext("2d")).fillStyle=s,t.render(e),e.createPattern(r,"no-repeat")):s}},C.Element.GradientBase.prototype=new C.Element.ElementBase,C.Element.linearGradient=function(e){this.base=C.Element.GradientBase,this.base(e),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(e,t){var t="objectBoundingBox"==this.gradientUnits()?t.getBoundingBox():null,n=(this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0),"objectBoundingBox"==this.gradientUnits()?t.x()+t.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x")),i="objectBoundingBox"==this.gradientUnits()?t.y()+t.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),a="objectBoundingBox"==this.gradientUnits()?t.x()+t.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),t="objectBoundingBox"==this.gradientUnits()?t.y()+t.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return n==a&&i==t?null:e.createLinearGradient(n,i,a,t)}},C.Element.linearGradient.prototype=new C.Element.GradientBase,C.Element.radialGradient=function(e){this.base=C.Element.GradientBase,this.base(e),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(e,t){var t=t.getBoundingBox(),n=(this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%"),"objectBoundingBox"==this.gradientUnits()?t.x()+t.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x")),i="objectBoundingBox"==this.gradientUnits()?t.y()+t.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),a=n,s=i,t=(this.attribute("fx").hasValue()&&(a="objectBoundingBox"==this.gradientUnits()?t.x()+t.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?t.y()+t.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y")),"objectBoundingBox"==this.gradientUnits()?(t.width()+t.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return e.createRadialGradient(a,s,0,n,i,t)}},C.Element.radialGradient.prototype=new C.Element.GradientBase,C.Element.stop=function(e){this.base=C.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},C.Element.stop.prototype=new C.Element.ElementBase,C.Element.AnimateBase=function(e){this.base=C.Element.ElementBase,this.base(e),C.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+e;var t,e=!1;return this.begin<this.duration&&(t=this.calcValue(),this.attribute("type").hasValue()&&(t=this.attribute("type").value+"("+t+")"),this.getProperty().value=t,e=!0),e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e,t,n,i={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};return this.values.hasValue()?(e=i.progress*(this.values.value.length-1),t=Math.floor(e),n=Math.ceil(e),i.from=new C.Property("from",parseFloat(this.values.value[t])),i.to=new C.Property("to",parseFloat(this.values.value[n])),i.progress=(e-t)/(n-t)):(i.from=this.from,i.to=this.to),i}},C.Element.AnimateBase.prototype=new C.Element.ElementBase,C.Element.animate=function(e){this.base=C.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress();return e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress+this.initialUnits}},C.Element.animate.prototype=new C.Element.AnimateBase,C.Element.animateColor=function(e){this.base=C.Element.AnimateBase,this.base(e),this.calcValue=function(){var e,t,n=this.progress(),i=new RGBColor(n.from.value),a=new RGBColor(n.to.value);return i.ok&&a.ok?(e=i.r+(a.r-i.r)*n.progress,t=i.g+(a.g-i.g)*n.progress,a=i.b+(a.b-i.b)*n.progress,"rgb("+parseInt(e,10)+","+parseInt(t,10)+","+parseInt(a,10)+")"):this.attribute("from").value}},C.Element.animateColor.prototype=new C.Element.AnimateBase,C.Element.animateTransform=function(e){this.base=C.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),t=C.ToNumberArray(e.from.value),n=C.ToNumberArray(e.to.value),i="",a=0;a<t.length;a++)i+=t[a]+(n[a]-t[a])*e.progress+" ";return i}},C.Element.animateTransform.prototype=new C.Element.animate,C.Element.font=function(e){this.base=C.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var t=0;t<this.children.length;t++){var n=this.children[t];"font-face"==n.type?(this.fontFace=n).style("font-family").hasValue()&&(C.Definitions[n.style("font-family").value]=this):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}},C.Element.font.prototype=new C.Element.ElementBase,C.Element.fontface=function(e){this.base=C.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},C.Element.fontface.prototype=new C.Element.ElementBase,C.Element.missingglyph=function(e){this.base=C.Element.path,this.base(e),this.horizAdvX=0},C.Element.missingglyph.prototype=new C.Element.path,C.Element.glyph=function(e){this.base=C.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},C.Element.glyph.prototype=new C.Element.path,C.Element.text=function(e){this.captureTextNodes=!0,this.base=C.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e);var t=this.style("dominant-baseline").toTextBaseline();null!=(t=null==t?this.style("alignment-baseline").toTextBaseline():t)&&(e.textBaseline=t)},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize);return new C.BoundingBox(e,t-n,e+Math.floor(2*n/3)*this.children[0].getText().length,t)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,n){var i=this.style("text-anchor").valueOrDefault("start");if("start"==i)return 0;for(var a=0,s=n;s<t.children.length;s++){var r=t.children[s];if(n<s&&r.attribute("x").hasValue())break;a+=r.measureTextRecursive(e)}return-1*("end"==i?a:a/2)},this.renderChild=function(e,t,n){var i=t.children[n];i.attribute("x").hasValue()?(i.x=i.attribute("x").toPixels("x")+t.getAnchorDelta(e,t,n),i.attribute("dx").hasValue()&&(i.x+=i.attribute("dx").toPixels("x"))):(i.attribute("dx").hasValue()&&(t.x+=i.attribute("dx").toPixels("x")),i.x=t.x),t.x=i.x+i.measureText(e),i.attribute("y").hasValue()?(i.y=i.attribute("y").toPixels("y"),i.attribute("dy").hasValue()&&(i.y+=i.attribute("dy").toPixels("y"))):(i.attribute("dy").hasValue()&&(t.y+=i.attribute("dy").toPixels("y")),i.y=t.y),t.y=i.y,i.render(e);for(n=0;n<i.children.length;n++)t.renderChild(e,i,n)}},C.Element.text.prototype=new C.Element.RenderedElementBase,C.Element.TextElementBase=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,n){var i,a=t[n],s=null;return s=null==(s=e.isArabic&&(i="isolated",(0==n||" "==t[n-1])&&n<t.length-2&&" "!=t[n+1]&&(i="terminal"),0<n&&" "!=t[n-1]&&n<t.length-2&&" "!=t[n+1]&&(i="medial"),0<n&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(i="initial"),void 0===e.glyphs[a]||null!=(s=e.glyphs[a][i])||"glyph"!=e.glyphs[a].type)?s:e.glyphs[a])?e.missingGlyph:s},this.renderChildren=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t)for(var n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(C.Font.Parse(C.ctx.font).fontStyle),a=this.getText(),s=(t.isRTL&&(a=a.split("").reverse().join("")),C.ToNumberArray(this.parent.attribute("dx").value)),r=0;r<a.length;r++){var o=this.getGlyph(t,a,r),l=n/t.fontFace.unitsPerEm,h=(e.translate(this.x,this.y),e.scale(l,-l),e.lineWidth);e.lineWidth=e.lineWidth*t.fontFace.unitsPerEm/n,"italic"==i&&e.transform(1,0,.4,1,0,0),o.render(e),"italic"==i&&e.transform(1,0,-.4,1,0,0),e.lineWidth=h,e.scale(1/l,-1/l),e.translate(-this.x,-this.y),this.x+=n*(o.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm,void 0===s[r]||isNaN(s[r])||(this.x+=s[r])}else""!=e.fillStyle&&e.fillText(C.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(C.compressSpaces(this.getText()),this.x,this.y)},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),n=0;n<this.children.length;n++)t+=this.children[n].measureTextRecursive(e);return t},this.measureText=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t){for(var n=this.parent.style("font-size").numValueOrDefault(C.Font.Parse(C.ctx.font).fontSize),i=0,a=this.getText(),s=(t.isRTL&&(a=a.split("").reverse().join("")),C.ToNumberArray(this.parent.attribute("dx").value)),r=0;r<a.length;r++)i+=(this.getGlyph(t,a,r).horizAdvX||t.horizAdvX)*n/t.fontFace.unitsPerEm,void 0===s[r]||isNaN(s[r])||(i+=s[r]);return i}var o=C.compressSpaces(this.getText());if(!e.measureText)return 10*o.length;e.save(),this.setContext(e);o=e.measureText(o).width;return e.restore(),o}},C.Element.TextElementBase.prototype=new C.Element.RenderedElementBase,C.Element.tspan=function(e){this.captureTextNodes=!0,this.base=C.Element.TextElementBase,this.base(e),this.text=C.compressSpaces(e.value||e.text||e.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},C.Element.tspan.prototype=new C.Element.TextElementBase,C.Element.tref=function(e){this.base=C.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(null!=e)return e.children[0].getText()}},C.Element.tref.prototype=new C.Element.TextElementBase,C.Element.a=function(e){this.base=C.Element.TextElementBase,this.base(e),this.hasText=0<e.childNodes.length;for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){var t;this.hasText?(this.baseRenderChildren(e),t=new C.Property("fontSize",C.Font.Parse(C.ctx.font).fontSize),C.Mouse.checkBoundingBox(this,new C.BoundingBox(this.x,this.y-t.toPixels("y"),this.x+this.measureText(e),this.y))):0<this.children.length&&((t=new C.Element.g).children=this.children,t.parent=this,t.render(e))},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){C.ctx.canvas.style.cursor="pointer"}},C.Element.a.prototype=new C.Element.TextElementBase,C.Element.image=function(e){this.base=C.Element.RenderedElementBase,this.base(e);var s,t,n=this.getHrefAttribute().value;""!=n&&(s=n.match(/\.svg$/),C.Images.push(this),this.loaded=!1,s?(this.img=C.ajax(n),this.loaded=!0):(this.img=document.createElement("img"),1==C.opts.useCORS&&(this.img.crossOrigin="Anonymous"),(t=this).img.onload=function(){t.loaded=!0},this.img.onerror=function(){C.log('ERROR: image "'+n+'" not found'),t.loaded=!0},this.img.src=n),this.renderChildren=function(e){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=i&&0!=a&&(e.save(),s?e.drawSvg(this.img,t,n,i,a):(e.translate(t,n),C.AspectRatio(e,this.attribute("preserveAspectRatio").value,i,this.img.width,a,this.img.height,0,0),e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new C.BoundingBox(e,t,e+n,t+i)})},C.Element.image.prototype=new C.Element.RenderedElementBase,C.Element.g=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(){for(var e=new C.BoundingBox,t=0;t<this.children.length;t++)e.addBoundingBox(this.children[t].getBoundingBox());return e}},C.Element.g.prototype=new C.Element.RenderedElementBase,C.Element.symbol=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.render=function(e){}},C.Element.symbol.prototype=new C.Element.RenderedElementBase,C.Element.style=function(e){this.base=C.Element.ElementBase,this.base(e);for(var t="",n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].data;t=t.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");for(var i=(t=C.compressSpaces(t)).split("}"),n=0;n<i.length;n++)if(""!=C.trim(i[n]))for(var a=i[n].split("{"),s=a[0].split(","),r=a[1].split(";"),o=0;o<s.length;o++){var l=C.trim(s[o]);if(""!=l){for(var h={},c=0;c<r.length;c++){var u=r[c].indexOf(":"),d=r[c].substr(0,u),u=r[c].substr(u+1,r[c].length-u);null!=d&&null!=u&&(h[C.trim(d)]=new C.Property(C.trim(d),C.trim(u)))}if(C.Styles[l]=h,C.StylesSpecificity[l]=function(i){function e(e,t){var n=i.match(e);null!=n&&(a[t]+=n.length,i=i.replace(e," "))}var a=[0,0,0];return i=(i=i.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[^]*/gm," "),e(w,1),e(x,0),e(M,1),e(P,2),e(k,1),e(E,1),i=(i=i.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),e(R,2),a.join("")}(l),"@font-face"==l)for(var p=h["font-family"].value.replace(/"/g,""),g=h.src.value.split(","),f=0;f<g.length;f++)if(0<g[f].indexOf('format("svg")'))for(var m=g[f].indexOf("url"),v=g[f].indexOf(")",m),v=g[f].substr(m+5,v-m-6),b=C.parseXml(C.ajax(v)).getElementsByTagName("font"),y=0;y<b.length;y++){var _=C.CreateElement(b[y]);C.Definitions[p]=_}}}},C.Element.style.prototype=new C.Element.ElementBase,C.Element.use=function(e){this.base=C.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))};var i=this.getHrefAttribute().getDefinition();this.path=function(e){null!=i&&i.path(e)},this.getBoundingBox=function(){if(null!=i)return i.getBoundingBox()},this.renderChildren=function(e){var t,n;null!=i&&("symbol"==(t=i).type&&((t=new C.Element.svg).type="svg",t.attributes.viewBox=new C.Property("viewBox",i.attribute("viewBox").value),t.attributes.preserveAspectRatio=new C.Property("preserveAspectRatio",i.attribute("preserveAspectRatio").value),t.attributes.overflow=new C.Property("overflow",i.attribute("overflow").value),t.children=i.children),"svg"==t.type&&(this.attribute("width").hasValue()&&(t.attributes.width=new C.Property("width",this.attribute("width").value)),this.attribute("height").hasValue())&&(t.attributes.height=new C.Property("height",this.attribute("height").value)),n=t.parent,t.parent=null,t.render(e),t.parent=n)}},C.Element.use.prototype=new C.Element.RenderedElementBase,C.Element.mask=function(e){this.base=C.Element.ElementBase,this.base(e),this.apply=function(e,t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");if(0==a&&0==s){for(var r=new C.BoundingBox,o=0;o<this.children.length;o++)r.addBoundingBox(this.children[o].getBoundingBox());n=Math.floor(r.x1),i=Math.floor(r.y1),a=Math.floor(r.width()),s=Math.floor(r.height())}var l=t.attribute("mask").value,h=(t.attribute("mask").value="",document.createElement("canvas")),c=(h.width=n+a,h.height=i+s,h.getContext("2d")),u=(this.renderChildren(c),document.createElement("canvas")),d=(u.width=n+a,u.height=i+s,u.getContext("2d"));t.render(d),d.globalCompositeOperation="destination-in",d.fillStyle=c.createPattern(h,"no-repeat"),d.fillRect(0,0,n+a,i+s),e.fillStyle=d.createPattern(u,"no-repeat"),e.fillRect(0,0,n+a,i+s),t.attribute("mask").value=l},this.render=function(e){}},C.Element.mask.prototype=new C.Element.ElementBase,C.Element.clipPath=function(e){this.base=C.Element.ElementBase,this.base(e),this.apply=function(e){var t=CanvasRenderingContext2D.prototype.beginPath,n=(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath);CanvasRenderingContext2D.prototype.closePath=function(){},t.call(e);for(var i=0;i<this.children.length;i++){var a,s=this.children[i];void 0!==s.path&&(s.style("transform",!1,!(a=null)).hasValue()&&(a=new C.Transform(s.style("transform",!1,!0).value)).apply(e),s.path(e),CanvasRenderingContext2D.prototype.closePath=n,a)&&a.unapply(e)}n.call(e),e.clip(),CanvasRenderingContext2D.prototype.beginPath=t,CanvasRenderingContext2D.prototype.closePath=n},this.render=function(e){}},C.Element.clipPath.prototype=new C.Element.ElementBase,C.Element.filter=function(e){this.base=C.Element.ElementBase,this.base(e),this.apply=function(e,t){for(var n=t.getBoundingBox(),i=Math.floor(n.x1),a=Math.floor(n.y1),s=Math.floor(n.width()),r=Math.floor(n.height()),n=t.style("filter").value,o=(t.style("filter").value="",0),l=0,h=0;h<this.children.length;h++)var c=this.children[h].extraFilterDistance||0,o=Math.max(o,c),l=Math.max(l,c);var u=document.createElement("canvas"),d=(u.width=s+2*o,u.height=r+2*l,u.getContext("2d"));d.translate(-i+o,-a+l),t.render(d);for(h=0;h<this.children.length;h++)"function"==typeof this.children[h].apply&&this.children[h].apply(d,0,0,s+2*o,r+2*l);e.drawImage(u,0,0,s+2*o,r+2*l,i-o,a-l,s+2*o,r+2*l),t.style("filter",!0).value=n},this.render=function(e){}},C.Element.filter.prototype=new C.Element.ElementBase,C.Element.feMorphology=function(e){this.base=C.Element.ElementBase,this.base(e),this.apply=function(e,t,n,i,a){}},C.Element.feMorphology.prototype=new C.Element.ElementBase,C.Element.feComposite=function(e){this.base=C.Element.ElementBase,this.base(e),this.apply=function(e,t,n,i,a){}},C.Element.feComposite.prototype=new C.Element.ElementBase,C.Element.feColorMatrix=function(e){this.base=C.Element.ElementBase,this.base(e);var n=C.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var t=n[0],n=[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":function i(e,t,n){return e+Math.cos(a)*t+Math.sin(a)*n}var a=n[0]*Math.PI/180;n=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function c(e,t,n,i,a,s){return e[n*i*4+4*t+s]}function u(e,t,n,i,a,s,r){e[n*i*4+4*t+s]=r}function d(e,t){e=n[e];return e*(e<0?t-255:t)}this.apply=function(e,t,n,i,a){for(var s=e.getImageData(0,0,i,a),n=0;n<a;n++)for(t=0;t<i;t++){var r=c(s.data,t,n,i,0,0),o=c(s.data,t,n,i,0,1),l=c(s.data,t,n,i,0,2),h=c(s.data,t,n,i,0,3);u(s.data,t,n,i,0,0,d(0,r)+d(1,o)+d(2,l)+d(3,h)+d(4,1)),u(s.data,t,n,i,0,1,d(5,r)+d(6,o)+d(7,l)+d(8,h)+d(9,1)),u(s.data,t,n,i,0,2,d(10,r)+d(11,o)+d(12,l)+d(13,h)+d(14,1)),u(s.data,t,n,i,0,3,d(15,r)+d(16,o)+d(17,l)+d(18,h)+d(19,1))}e.clearRect(0,0,i,a),e.putImageData(s,0,0)}},C.Element.feColorMatrix.prototype=new C.Element.ElementBase,C.Element.feGaussianBlur=function(e){this.base=C.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,t,n,i,a){void 0===stackBlurCanvasRGBA?C.log("ERROR: StackBlur.js must be included for blur to work"):(e.canvas.id=C.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),stackBlurCanvasRGBA(e.canvas.id,t,n,i,a,this.blurRadius),document.body.removeChild(e.canvas))}},C.Element.feGaussianBlur.prototype=new C.Element.ElementBase,C.Element.title=function(e){},C.Element.title.prototype=new C.Element.ElementBase,C.Element.desc=function(e){},C.Element.desc.prototype=new C.Element.ElementBase,C.Element.MISSING=function(e){C.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},C.Element.MISSING.prototype=new C.Element.ElementBase,C.CreateElement=function(e){var t=(t=e.nodeName.replace(/^[^:]+:/,"")).replace(/\-/g,""),n=null;return(n=new(void 0!==C.Element[t]?C.Element[t]:C.Element.MISSING)(e)).type=e.nodeName,n},C.load=function(e,t){C.loadXml(e,C.ajax(t))},C.loadXml=function(e,t){C.loadXmlDoc(e,C.parseXml(t))},C.loadXmlDoc=function(s,r){C.init(s);function t(e){for(var t=s.canvas;t;)e.x-=t.offsetLeft,e.y-=t.offsetTop,t=t.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e}function n(){C.ViewPort.Clear(),s.canvas.parentNode&&C.ViewPort.SetCurrent(s.canvas.parentNode.clientWidth,s.canvas.parentNode.clientHeight),1!=C.opts.ignoreDimensions&&(o.style("width").hasValue()&&(s.canvas.width=o.style("width").toPixels("x"),s.canvas.style.width=s.canvas.width+"px"),o.style("height").hasValue())&&(s.canvas.height=o.style("height").toPixels("y"),s.canvas.style.height=s.canvas.height+"px");var e,t,n,i=s.canvas.clientWidth||s.canvas.width,a=s.canvas.clientHeight||s.canvas.height;1==C.opts.ignoreDimensions&&o.style("width").hasValue()&&o.style("height").hasValue()&&(i=o.style("width").toPixels("x"),a=o.style("height").toPixels("y")),C.ViewPort.SetCurrent(i,a),null!=C.opts.offsetX&&(o.attribute("x",!0).value=C.opts.offsetX),null!=C.opts.offsetY&&(o.attribute("y",!0).value=C.opts.offsetY),null==C.opts.scaleWidth&&null==C.opts.scaleHeight||(t=e=null,n=C.ToNumberArray(o.attribute("viewBox").value),null!=C.opts.scaleWidth&&(o.attribute("width").hasValue()?e=o.attribute("width").toPixels("x")/C.opts.scaleWidth:isNaN(n[2])||(e=n[2]/C.opts.scaleWidth)),null!=C.opts.scaleHeight&&(o.attribute("height").hasValue()?t=o.attribute("height").toPixels("y")/C.opts.scaleHeight:isNaN(n[3])||(t=n[3]/C.opts.scaleHeight)),null==e&&(e=t),null==t&&(t=e),o.attribute("width",!0).value=C.opts.scaleWidth,o.attribute("height",!0).value=C.opts.scaleHeight,o.style("transform",!0,!0).value+=" scale("+1/e+","+1/t+")"),1!=C.opts.ignoreClear&&s.clearRect(0,0,i,a),o.render(s),l&&(l=!1,"function"==typeof C.opts.renderCallback)&&C.opts.renderCallback(r)}1!=C.opts.ignoreMouse&&(s.canvas.onclick=function(e){e=t(new C.Point((null!=e?e:event).clientX,(null!=e?e:event).clientY));C.Mouse.onclick(e.x,e.y)},s.canvas.onmousemove=function(e){e=t(new C.Point((null!=e?e:event).clientX,(null!=e?e:event).clientY));C.Mouse.onmousemove(e.x,e.y)});var o=C.CreateElement(r.documentElement),l=(o.root=!0,o.addStylesFromStyleDefinition(),!0),i=!0;C.ImagesLoaded()&&(i=!1,n()),C.intervalID=setInterval(function(){var e=!1;if(i&&C.ImagesLoaded()&&(e=!(i=!1)),1!=C.opts.ignoreMouse&&(e|=C.Mouse.hasEvents()),1!=C.opts.ignoreAnimation)for(var t=0;t<C.Animations.length;t++)e|=C.Animations[t].update(1e3/C.FRAMERATE);(e="function"==typeof C.opts.forceRedraw&&1==C.opts.forceRedraw()?!0:e)&&(n(),C.Mouse.runEvents())},1e3/C.FRAMERATE)},C.stop=function(){C.intervalID&&clearInterval(C.intervalID)},C.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;n<this.events.length;n++){var i=this.events[n];t.isPointInPath&&t.isPointInPath(i.x,i.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;n<this.events.length;n++){var i=this.events[n];t.isPointInBox(i.x,i.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){C.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var t=this.events[e],n=this.eventElements[e];n;)t.run(n),n=n.parent;this.events=[],this.eventElements=[]}},C}(n||{}),e=(1==e.childNodes.length&&"OBJECT"==e.childNodes[0].nodeName||(e.svg=n),e.getContext("2d"));void 0!==t.documentElement?n.loadXmlDoc(e,t):"<"==t.substr(0,1)?n.loadXml(e,t):n.load(e,t)}},void 0!==Element.prototype.matches?h=function(e,t){return e.matches(t)}:void 0!==Element.prototype.webkitMatchesSelector?h=function(e,t){return e.webkitMatchesSelector(t)}:void 0!==Element.prototype.mozMatchesSelector?h=function(e,t){return e.mozMatchesSelector(t)}:void 0!==Element.prototype.msMatchesSelector?h=function(e,t){return e.msMatchesSelector(t)}:void 0!==Element.prototype.oMatchesSelector?h=function(e,t){return e.oMatchesSelector(t)}:void 0===(h="function"!=typeof jQuery&&"function"!=typeof Zepto?h:function(e,t){return $(e).is(t)})&&(h=Sizzle.matchesSelector);var h,w=/(\[[^\]]+\])/g,x=/(#[^\s\+>~\.\[:]+)/g,M=/(\.[^\s\+>~\.\[:]+)/g,P=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,k=/(:[\w-]+\([^\)]*\))/gi,E=/(:[^\s\+>~\.\[:]+)/g,R=/([^\s\+>~\.\[:]+)/g}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,i,a){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:i,scaleHeight:a})});var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function premultiplyAlpha(e){for(var t=e.data,n=e.width*e.height*4,i=0;i<n;i+=4){var a=t[i+3]/255;t[i]*=a,t[i+1]*=a,t[i+2]*=a}}function unpremultiplyAlpha(e){for(var t=e.data,n=e.width*e.height*4,i=0;i<n;i+=4){var a=t[i+3];0!=a&&(t[i]*=a=255/a,t[i+1]*=a,t[i+2]*=a)}}function stackBlurImage(e,t,n,i){var e=document.getElementById(e),a=e.naturalWidth,s=e.naturalHeight,r=document.getElementById(t),r=(r.style.width=a+"px",r.style.height=s+"px",r.width=a,r.height=s,r.getContext("2d"));r.clearRect(0,0,a,s),r.drawImage(e,0,0),isNaN(n)||n<1||(i?stackBlurCanvasRGBA:stackBlurCanvasRGB)(t,0,0,a,s,n)}function stackBlurCanvasRGBA(t,$,V,n,i,e){if(!(isNaN(e)||e<1)){e|=0;var a,t=document.getElementById(t).getContext("2d");try{try{a=t.getImageData($,V,n,i)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),a=t.getImageData($,V,n,i)}catch(e){throw alert("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw alert("Cannot access image"),new Error("unable to access image data: "+e)}premultiplyAlpha(a);for(var s,r,N,o,l,h,c,u,d,p,g,f,m,v,b,y,_,w,x,C,M,P=a.data,D=e+e+1,O=n-1,G=i-1,k=e+1,E=k*(k+1)/2,R=new BlurStack,L=R,A=1;A<D;A++){var z,L=L.next=new BlurStack;A==k&&(z=L)}L.next=R;for(var S=null,B=null,F=o=0,I=mul_table[e],q=shg_table[e],T=0;T<i;T++){for(m=v=b=y=l=h=c=u=0,d=k*(_=P[o]),p=k*(w=P[o+1]),g=k*(x=P[o+2]),f=k*(C=P[o+3]),l+=E*_,h+=E*w,c+=E*x,u+=E*C,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L.a=C,L=L.next;for(A=1;A<k;A++)l+=(L.r=_=P[r=o+((O<A?O:A)<<2)])*(M=k-A),h+=(L.g=w=P[r+1])*M,c+=(L.b=x=P[r+2])*M,u+=(L.a=C=P[r+3])*M,m+=_,v+=w,b+=x,y+=C,L=L.next;for(S=R,B=z,s=0;s<n;s++)P[o]=l*I>>q,P[o+1]=h*I>>q,P[o+2]=c*I>>q,P[o+3]=u*I>>q,l-=d,h-=p,c-=g,u-=f,d-=S.r,p-=S.g,g-=S.b,f-=S.a,r=F+((r=s+e+1)<O?r:O)<<2,l+=m+=S.r=P[r],h+=v+=S.g=P[r+1],c+=b+=S.b=P[r+2],u+=y+=S.a=P[r+3],S=S.next,d+=_=B.r,p+=w=B.g,g+=x=B.b,f+=C=B.a,m-=_,v-=w,b-=x,y-=C,B=B.next,o+=4;F+=n}for(s=0;s<n;s++){for(v=b=y=m=h=c=u=l=0,d=k*(_=P[o=s<<2]),p=k*(w=P[o+1]),g=k*(x=P[o+2]),f=k*(C=P[o+3]),l+=E*_,h+=E*w,c+=E*x,u+=E*C,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L.a=C,L=L.next;for(N=n,A=1;A<=e;A++)l+=(L.r=_=P[o=N+s<<2])*(M=k-A),h+=(L.g=w=P[o+1])*M,c+=(L.b=x=P[o+2])*M,u+=(L.a=C=P[o+3])*M,m+=_,v+=w,b+=x,y+=C,L=L.next,A<G&&(N+=n);for(o=s,S=R,B=z,T=0;T<i;T++)P[r=o<<2]=l*I>>q,P[r+1]=h*I>>q,P[r+2]=c*I>>q,P[r+3]=u*I>>q,l-=d,h-=p,c-=g,u-=f,d-=S.r,p-=S.g,g-=S.b,f-=S.a,r=s+((r=T+k)<G?r:G)*n<<2,l+=m+=S.r=P[r],h+=v+=S.g=P[r+1],c+=b+=S.b=P[r+2],u+=y+=S.a=P[r+3],S=S.next,d+=_=B.r,p+=w=B.g,g+=x=B.b,f+=C=B.a,m-=_,v-=w,b-=x,y-=C,B=B.next,o+=n}unpremultiplyAlpha(a),t.putImageData(a,$,V)}}function stackBlurCanvasRGB(t,n,i,a,s,e){if(!(isNaN(e)||e<1)){e|=0;var r,t=document.getElementById(t).getContext("2d");try{try{r=t.getImageData(n,i,a,s)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),r=t.getImageData(n,i,a,s)}catch(e){throw alert("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw alert("Cannot access image"),new Error("unable to access image data: "+e)}for(var o,l,h,c,u,d,p,g,f,m,v,b,y,_,w,x,C,M=r.data,$=e+e+1,P=a-1,V=s-1,k=e+1,E=k*(k+1)/2,R=new BlurStack,L=R,A=1;A<$;A++){var N,L=L.next=new BlurStack;A==k&&(N=L)}L.next=R;for(var S=null,B=null,D=c=0,I=mul_table[e],q=shg_table[e],T=0;T<s;T++){for(v=b=y=u=d=p=0,g=k*(_=M[c]),f=k*(w=M[c+1]),m=k*(x=M[c+2]),u+=E*_,d+=E*w,p+=E*x,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L=L.next;for(A=1;A<k;A++)u+=(L.r=_=M[l=c+((P<A?P:A)<<2)])*(C=k-A),d+=(L.g=w=M[l+1])*C,p+=(L.b=x=M[l+2])*C,v+=_,b+=w,y+=x,L=L.next;for(S=R,B=N,o=0;o<a;o++)M[c]=u*I>>q,M[c+1]=d*I>>q,M[c+2]=p*I>>q,u-=g,d-=f,p-=m,g-=S.r,f-=S.g,m-=S.b,l=D+((l=o+e+1)<P?l:P)<<2,u+=v+=S.r=M[l],d+=b+=S.g=M[l+1],p+=y+=S.b=M[l+2],S=S.next,g+=_=B.r,f+=w=B.g,m+=x=B.b,v-=_,b-=w,y-=x,B=B.next,c+=4;D+=a}for(o=0;o<a;o++){for(b=y=v=d=p=u=0,g=k*(_=M[c=o<<2]),f=k*(w=M[c+1]),m=k*(x=M[c+2]),u+=E*_,d+=E*w,p+=E*x,L=R,A=0;A<k;A++)L.r=_,L.g=w,L.b=x,L=L.next;for(h=a,A=1;A<=e;A++)u+=(L.r=_=M[c=h+o<<2])*(C=k-A),d+=(L.g=w=M[c+1])*C,p+=(L.b=x=M[c+2])*C,v+=_,b+=w,y+=x,L=L.next,A<V&&(h+=a);for(c=o,S=R,B=N,T=0;T<s;T++)M[l=c<<2]=u*I>>q,M[l+1]=d*I>>q,M[l+2]=p*I>>q,u-=g,d-=f,p-=m,g-=S.r,f-=S.g,m-=S.b,l=o+((l=T+k)<V?l:V)*a<<2,u+=v+=S.r=M[l],d+=b+=S.g=M[l+1],p+=y+=S.b=M[l+2],S=S.next,g+=_=B.r,f+=w=B.g,m+=x=B.b,v-=_,b-=w,y-=x,B=B.next,c+=a}t.putImageData(r,n,i)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}!function(e){"use strict";var c,u=e.Uint8Array,e=e.HTMLCanvasElement,t=e&&e.prototype,r=/\s*;\s*base64\s*(?:;|$)/i,o="toDataURL";u&&(c=new u([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!e||t.toBlob&&t.toBlobHD||(t.toBlob||(t.toBlob=function(e,t){var n,i,a,s;t=t||"image/png",this.mozGetAsFile?e(this.mozGetAsFile("canvas",t)):this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t)?e(this.msToBlob()):(a=Array.prototype.slice.call(arguments,1),n=(a=this[o].apply(this,a)).indexOf(","),i=a.substring(n+1),a=r.test(a.substring(0,n)),Blob.fake?((s=new Blob).encoding=a?"base64":"URI",s.data=i,s.size=i.length):u&&(s=a?new Blob([function(e){for(var t,n,i=e.length,a=new u(i/4*3|0),s=0,r=0,o=[0,0],l=0,h=0;i--;)n=e.charCodeAt(s++),255!==(t=c[n-43])&&void 0!==t&&(o[1]=o[0],o[0]=n,h=h<<6|t,4===++l)&&(a[r++]=h>>>16,61!==o[1]&&(a[r++]=h>>>8),61!==o[0]&&(a[r++]=h),l=0);return a}(i)],{type:t}):new Blob([decodeURIComponent(i)],{type:t})),e(s))}),!t.toBlobHD&&t.toDataURLHD?t.toBlobHD=function(){o="toDataURLHD";var e=this.toBlob();return o="toDataURL",e}:t.toBlobHD=t.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||function(o){"use strict";var l,h,c,u,d,p,t,g,f,i,e;if(!(void 0===o||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent)))return e=o.document,l=function(){return o.URL||o.webkitURL||o},h=e.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in h,u=/constructor/i.test(o.HTMLElement)||o.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),p=function(e){(o.setImmediate||o.setTimeout)(function(){throw e},0)},t=4e4,g=function(e){setTimeout(function(){"string"==typeof e?l().revokeObjectURL(e):e.remove()},t)},f=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},e=(i=function(e,n,t){t||(e=f(e));var i,a,s=this,t="application/octet-stream"===e.type,r=function(){for(var e=s,t="writestart progress write writeend".split(" "),n=void 0,i=(t=[].concat(t)).length;i--;){var a=e["on"+t[i]];if("function"==typeof a)try{a.call(e,n||e)}catch(e){p(e)}}};s.readyState=s.INIT,c?(i=l().createObjectURL(e),setTimeout(function(){var e,t;h.href=i,h.download=n,e=h,t=new MouseEvent("click"),e.dispatchEvent(t),r(),g(i),s.readyState=s.DONE})):(d||t&&u)&&o.FileReader?((a=new FileReader).onloadend=function(){var e=d?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");o.open(e,"_blank")||(o.location.href=e),s.readyState=s.DONE,r()},a.readAsDataURL(e),s.readyState=s.INIT):(i=i||l().createObjectURL(e),!t&&o.open(i,"_blank")||(o.location.href=i),s.readyState=s.DONE,r(),g(i))}).prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=f(e)),navigator.msSaveOrOpenBlob(e,t)}:(e.abort=function(){},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,function(e,t,n){return new i(e,t||e.name||"download",n)})}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);function svgToPNG(e,t){null==t&&(t="structure.png");var n=window.URL||window.webkitURL||window,e=(e=$("<div>").append($("[id="+e+"] svg:eq(0)").clone()).html()).replace('xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:xmlns:xlink="http://www.w3.org/1999/xlink"',""),e=new Blob([e],{type:"image/svg+xml"}),n=n.createObjectURL(e);$("body").append('<canvas display="none" id="tmpcanvas"></canvas>'),canvg("tmpcanvas",n,{renderCallback:function(){var e=document.getElementById("tmpcanvas");e.toBlob(function(e){saveAs(e,t)}),e.parentNode.removeChild(e)}})}function qmeanLocalColour(e,t){return.4<e?null==t?"rgb("+Math.round(255*(1-e)*(1/.6))+",80,"+Math.round(255*(e-.4)*(1/.6))+")":"rgba("+Math.round(255*(1-e)*(1/.6))+",80,"+Math.round(255*(e-.4)*(1/.6))+","+t+")":null==t?"rgb(255,80,0)":"rgba(255,80,0,"+t+")"}function drawQMEANLocal(e,v,b,y,t,_,w){var x=_?"qmb":"qm",C=["lq-chart"+(b?"-"+b:"")];if(t||!(0<$("#"+C[0]+" svg").length)){var M=chainMapping.structures[e];for(let e=0;e<Object.keys(M).length;e++){var n="lq-chart"+(b?"-"+b:"");if(0==e&&(0==$("#"+n).length?$("body").append("<div"+(b?' rel="'+b+'"':"")+' id="'+n+'" style="display:none"></div>'):$("#"+n).empty(),$("#"+n+"-thumb").empty()),1==Object.keys(M).length)break;n+="-"+Object.keys(M)[e],C.push(n),0==$("#"+n).length?$("body").append("<div"+(b?' rel="'+b+'"':"")+' id="'+n+'" style="display:none"></div>'):$("#"+n).empty(),0==$('a[href="#'+n+'"]').length&&$("body").append('<a href="#'+n+'" rel="lq-'+(b||"")+'" class="fancybox"/>')}let m=!0;w=w||200;for(let f=0;f<C.length;f++){let a,s,r,o=0,l=0,h=0,e=!1;if(m){if($("#"+C[f]+"-thumb").attr("title","Click to enlarge"),a=$("#"+C[f]+"-thumb").closest(":visible").width(),s=$("#"+C[f]+"-thumb").closest(":visible").height(),null==a||null==s)return;(s=0==s?Math.min(w,.5*a):s)>=w?(r=12,o=45,l=30,h=40,e=!0):(y&&(o=30,l=16),r=Math.max(15,s/10))}else r=20,o=45,l=30,h=40,a=.7*$(window).width()+o,s=.7*$(window).height()+h+l;var P=Raphael(C[f]+(m?"-thumb":""),a,s);let c=99999,u=0,n=0,i=0,d=999,p=0;var k=Object.keys(M);for(let t=0;t<k.length;t++)if(!(0<f&&f-1!=t))for(let e=0;e<M[k[t]].length;e++)M[k[t]][e]&&M[k[t]][e][x]&&(d=Math.min(d,M[k[t]][e][x]),p=Math.max(p,M[k[t]][e][x]),c=Math.min(M[k[t]][e].resno,c),u=Math.max(M[k[t]][e].resno,u),i+=1,n+=M[k[t]][e][x]);var E=p<=1;let g=1;d=E?Math.min(.3,d):(g=100,Math.min(70,d)),null==v&&(v=n/i),$("#avgLocalQMEAN,#avgLocalScore_"+b).html(isNaN(v)?"-":v.toFixed(2));var R=s-h-l,L=(a-o)/(u-c);if(P.rect(0,0,a,s).attr({fill:"#FFF",stroke:"#FFF"}),m&&!e)P.rect(o,l,a-o,R).attr({stroke:"#DDD"}),y&&(P.text(a/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,s/24)}),P.text(6,s/2+l/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,s/26)}).rotate(270,6,s/2+l/2),P.text(18,s/2+l/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,s/26)}).rotate(270,18,s/2+l/2));else{P.rect(o,l,a-o,R).attr({stroke:"#DDD"});let t=14,e="Local Quality Estimate",n=(_&&(e+=" (QMEANBrane) "),0==f?1==k.length?e+=" - Chain "+k[0]:e+=" - All Chains":e+=" - Chain "+k[f-1],P.text(a/2,10,e).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,s/26)}),m?(P.text(6,s/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,6,s/2),P.text(18,s/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,18,s/2),t=.8*r):P.text(10,s/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":r}).rotate(270,10,s/2),P.text(o+(a-o)/2,s-8,"Residue Number").attr({"text-anchor":"middle",fill:"#666","font-size":r}),null);for(let e=g;e>=d;e-=E?.1:10){P.path("M"+o+" "+(R/(g-d)*(g-e)+l)+"L"+(o-5)+" "+(R/(g-d)*(g-e)+l)).attr({stroke:"#CCC","stroke-width":1});var A=R/(g-d)*(g-e)+l;(!A||n+t<A)&&(P.text(o-12,A,e.toFixed(E?1:0)).attr({fill:"#444","font-size":t}),n=A)}var S,B,I=Math.floor((u-c)/8);I-=I%10,I=Math.max(10,I);let i=null;for(let e=c;e<u;e++)e%I==0&&(S=o+(e-c)/(u-c)*(a-o),i&&i>S||(B=P.text(S,s-h+12,e).attr({fill:"#444","font-size":t}),i=S+B.getBBox().width))}var q=["#999999","#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"];let t=0;for(let i=0;i<k.length;i++){let n=null;if(0==f||f-1==i){var T=R/(g-Math.min(d,v))*(g-v)+l;for(let t=0;t<M[k[i]].length;t++)if(M[k[i]][t]){var V=M[k[i]][t][x];if(null!=V){var N,D=o+L*(M[k[i]][t].resno-c);let e=T-R/(g-d)*(V-v);0==f&&1<k.length?(e=Math.min(e,R+l),null==n?n="M"+D+" "+e:n+="L"+D+" "+e,n+="L"+(D+L)+" "+e):(bar=v<V?P.rect(D,e,L,R/(g-d)*(V-v)):(N=R/(g-d)*(v-V),N=Math.min(N,R-T+l),P.rect(D,T,L,N)),D=qmeanLocalColour(E?V:V/100),bar.attr({stroke:D,"stroke-width":.7,fill:D,"fill-opacity":.4}))}}0==f&&1<k.length&&((n=P.path(n)).attr({stroke:q[t],"stroke-width":m?1:1.5}),m||$("#lq-chart"+(b?"-"+b:"")).append((0==i?"<br>Key: ":"")+' <span style="margin-right:4px; color:'+q[t]+'">Chain '+k[i]+";</span>"))}t=++t%q.length}m&&(m=!1,f--)}}}function drawQMEANGlobal(a,e,t,f,n){var s=$("#qn-chart"+(t?"-"+t:"")+"-thumb,#qn-chart"+(t?"-"+t:""));if(a){var r="qmeanGlobalTbl"+(t||"");if(n||!(0<$("#"+r+" tr").length)){s.empty(),$("#"+r+" tr").remove(),a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion),a.qmean4&&(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);var o=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C"],["interaction_z_score","All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];let t="";for(let e=0;e<o.length;e++)null!=a[o[e][0]]&&(t+='<tr><td width="1">'+o[e][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+r+"_"+o[e][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[o[e][0]].toFixed(2)+"</td></tr>");$("#"+r).append(t);let n=$("#"+r+"_"+o[0][0]).innerWidth(),i=$("#"+r+"_"+o[0][0]).parent().innerHeight();(n<1||i<1)&&(n=290,i=20);for(let e=0;e<o.length;e++)$("#"+r+"_"+o[e][0]).html("");var l=n/8;for(let e=0;e<o.length;e++)if(null!=a[o[e][0]]){var h,c=Raphael(r+"_"+o[e][0],n,i),u=(c.rect(0,0,n,i).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"}),i/4);for(let e=1;e<8;e++)c.path("M"+l*e+" 0L"+l*e+" "+u).attr({stroke:"#555"}),c.path("M"+l*e+" "+(i-u)+"L"+l*e+" "+i).attr({stroke:"#555"});a&&(h=a[o[e][0]],h=Math.min(h,1.95),h=Math.max(h,-5.95),c.path("M"+(l*h+6*l)+" 0L"+(l*h+6*l)+" "+i).attr({stroke:"#222","stroke-width":3}))}let d=a.qmean4_norm_score,p=Math.min(600,e),g=!0;s.each(function(e,t){let n,i,a,s=0,r=0,o=0;g?($(this).attr("title","Click to enlarge"),340<(n=$(this).closest(":visible").width())?(a=12,s=45,r=30,o=40,n-=s,i=400/620*n-o+r):(i=.5*n,f&&(s=15,r=30),a=Math.max(15,i/10))):(a=20,s=45,r=30,o=40,n=617+s,i=398+o+r);var l=Raphael($(this).attr("id"),n,i),h=i-o-r,c=p/600*(n-s)+s,u=h-h*(d/1.5)+r;l.rect(0,0,n,i).attr({fill:"#FFF",stroke:"#FFF"}),"undefined"==typeof localQMEANNormImage?l.image("/static/images/qmean_norm.png",s,r,n-s,h):l.image(localQMEANNormImage,s,r,n-s,h),l.rect(s,r,n-s,h).attr({stroke:"#DDD"}),l.text(c,u,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":a});if(g)f&&(l.text((n+s)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)}),l.text((n+s)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)}),l.text(6,i/2+r/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,n/32)}).rotate(270,6,i/2+r/2)),l.rect(s+1,i-Math.max(16,n/16),n-s-2,Math.max(16,n/16)).attr({fill:"#FFF","stroke-width":0}),l.text(n/2,i-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,n/32)});else{l.text((n+s)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":a}),l.text(10,i/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":a}).rotate(270,10,i/2),l.text(s+(n-s)/2,i-12,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#666","font-size":a});for(let e=100;e<600;e+=100)l.text(s+e*(n-s)/600,i-o+8,e).attr({fill:"#444","font-size":14});for(let e=1.5;0<=e;e-=.5)l.text(s-12,h*(e/1.5)+r,(1.5-e).toFixed(1)).attr({fill:"#444","font-size":14})}g=!1})}}}"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});